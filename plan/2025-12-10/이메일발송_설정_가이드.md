# 📧 이메일 발송 설정 가이드

**작성일**: 2025-12-10  
**목적**: 비밀번호 재설정 이메일 발송을 위한 설정 가이드

---

## 🔍 현재 문제 분석

### 발견된 오류
```
530 5.7.0 Authentication Required
발신자: noreply@example.com (기본값)
```

### 문제 원인
1. **MAIL_USERNAME 미설정** - Gmail 계정 주소가 설정되지 않음
2. **MAIL_PASSWORD 미설정** - Gmail 앱 비밀번호가 설정되지 않음
3. **MAIL_DEFAULT_SENDER가 기본값** - 실제 Gmail 계정과 일치하지 않음

---

## ✅ 해결 방법

### 1단계: Gmail 앱 비밀번호 생성

1. **Google 계정 접속**
   - https://myaccount.google.com 접속

2. **2단계 인증 활성화** (필수)
   - 보안 → 2단계 인증 → 활성화

3. **앱 비밀번호 생성**
   - 보안 → 2단계 인증 → 앱 비밀번호
   - 앱 선택: "메일"
   - 기기 선택: "기타(맞춤 이름)" → "급여명세서 앱" 입력
   - 생성 버튼 클릭
   - **16자리 비밀번호 복사** (예: `abcd efgh ijkl mnop`)

### 2단계: .env 파일 생성 및 설정

**프로젝트 루트에 `.env` 파일 생성:**

```bash
cd /Users/jisungs/Documents/dev/sideprojects/salary_cal
cp .env.example .env
```

**`.env` 파일 편집:**

```env
# Flask 설정
FLASK_ENV=development
FLASK_DEBUG=True
FLASK_RUN_PORT=5001

# 보안 설정
SECRET_KEY=your-secret-key-here-change-in-production

# 이메일 설정 (Gmail)
MAIL_SERVER=smtp.gmail.com
MAIL_PORT=587
MAIL_USE_TLS=True
MAIL_USERNAME=your-email@gmail.com          # 실제 Gmail 주소
MAIL_PASSWORD=your-app-password-16-digits  # 앱 비밀번호 (공백 제거)
MAIL_DEFAULT_SENDER=your-email@gmail.com   # MAIL_USERNAME과 동일하게

# 애플리케이션 URL
BASE_URL=http://localhost:5001
```

### 3단계: 설정 확인

**앱 재시작 후 확인:**

```bash
# 웹 서버 재시작
python app.py
```

**설정 확인 방법:**

브라우저에서 `/auth/reset_password_request` 접속하여 이메일 발송 테스트

---

## 📝 주의사항

### Gmail 앱 비밀번호 사용법

1. **공백 제거**: 앱 비밀번호는 공백 없이 입력
   - 예: `abcd efgh ijkl mnop` → `abcdefghijklmnop`

2. **MAIL_USERNAME과 MAIL_DEFAULT_SENDER 일치**
   - 두 값이 동일한 Gmail 주소여야 함

3. **보안**
   - `.env` 파일은 `.gitignore`에 포함되어 있음
   - 절대 Git에 커밋하지 마세요

### 개발 환경에서 테스트

**이메일 발송 없이 테스트하려면:**

`config.py`의 `DevelopmentConfig`에 추가:

```python
class DevelopmentConfig(Config):
    # ...
    MAIL_SUPPRESS_SEND = True  # 이메일 발송 억제 (콘솔에만 출력)
```

또는 테스트용 SMTP 서버 사용:
- **Mailtrap** (https://mailtrap.io) - 무료 계정 가능
- **MailHog** - 로컬 테스트용

---

## 🔧 설정 체크리스트

- [ ] Google 계정 2단계 인증 활성화
- [ ] Gmail 앱 비밀번호 생성
- [ ] `.env` 파일 생성
- [ ] `MAIL_USERNAME` 설정 (실제 Gmail 주소)
- [ ] `MAIL_PASSWORD` 설정 (앱 비밀번호, 공백 제거)
- [ ] `MAIL_DEFAULT_SENDER` 설정 (MAIL_USERNAME과 동일)
- [ ] `BASE_URL` 설정 (비밀번호 재설정 링크용)
- [ ] 웹 서버 재시작
- [ ] 이메일 발송 테스트

---

## 🚨 오류 해결

### 오류: "530 5.7.0 Authentication Required"

**원인**: Gmail 인증 실패
**해결**:
1. MAIL_USERNAME이 실제 Gmail 주소인지 확인
2. MAIL_PASSWORD가 앱 비밀번호인지 확인 (일반 비밀번호 아님)
3. 2단계 인증이 활성화되어 있는지 확인

### 오류: "The message does not specify a sender"

**원인**: MAIL_DEFAULT_SENDER 미설정
**해결**: `.env` 파일에 `MAIL_DEFAULT_SENDER` 추가

### 오류: "535 5.7.8 Username and Password not accepted"

**원인**: 잘못된 비밀번호 또는 앱 비밀번호 미사용
**해결**: 앱 비밀번호를 다시 생성하여 사용

---

## 📋 빠른 설정 예시

```env
# .env 파일 내용
MAIL_USERNAME=jisunswork@gmail.com
MAIL_PASSWORD=abcdefghijklmnop
MAIL_DEFAULT_SENDER=jisunswork@gmail.com
BASE_URL=http://localhost:5001
```

**주의**: 위 예시는 실제 값이 아닙니다. 실제 Gmail 주소와 앱 비밀번호를 사용하세요.

---

**작성자**: AI Assistant  
**작성일**: 2025-12-10

