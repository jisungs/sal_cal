# ğŸ“‹ app.py íŒŒì¼ ì ê²€ ë³´ê³ ì„œ

**ì ê²€ ì¼ì**: 2025-01-XX  
**íŒŒì¼**: `app.py`  
**ë¬¸ì œ**: ê°€ìƒí™˜ê²½ í™œì„±í™” í›„ Flask ëª¨ë“ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŒ

---

## ğŸ” ë¬¸ì œ ë¶„ì„

### ë°œê²¬ëœ ë¬¸ì œ

1. **ì˜ì¡´ì„± ë¯¸ì„¤ì¹˜**
   - ê°€ìƒí™˜ê²½ì— Flaskê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•Šì•˜ìŒ
   - `requirements-web.txt`ì— ëª…ì‹œë˜ì–´ ìˆìœ¼ë‚˜ ì„¤ì¹˜ë˜ì§€ ì•ŠìŒ

2. **í•´ê²° ë°©ë²•**
   - ê°€ìƒí™˜ê²½ í™œì„±í™” í›„ `pip install -r requirements-web.txt` ì‹¤í–‰
   - Flask 3.1.2 ë° ê´€ë ¨ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì™„ë£Œ

---

## âœ… ì½”ë“œ ì ê²€ ê²°ê³¼

### 1. Import ë¬¸ ê²€ì¦

```python
from flask import Flask, render_template, request, send_file, jsonify, session
from werkzeug.utils import secure_filename
from werkzeug.exceptions import RequestEntityTooLarge
from payroll_generator.calculator import PayrollCalculator
from payroll_generator.excel_handler import ExcelHandler
from payroll_generator.pdf_generator import PDFGenerator
from payroll_generator.logger import setup_logger
```

**ìƒíƒœ**: âœ… ëª¨ë“  import ë¬¸ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•¨

### 2. Flask ì•± ì„¤ì •

```python
app = Flask(__name__, 
            template_folder='web/templates',
            static_folder='web/static')
app.config['SECRET_KEY'] = os.environ.get('SECRET_KEY', 'dev-secret-key-change-in-production')
app.config['MAX_CONTENT_LENGTH'] = 16 * 1024 * 1024  # 16MB max file size
app.config['UPLOAD_FOLDER'] = 'web/uploads'
app.config['OUTPUT_FOLDER'] = 'outputs'
```

**ìƒíƒœ**: âœ… ì„¤ì •ì´ ì ì ˆí•¨
- í…œí”Œë¦¿ ë° ì •ì  íŒŒì¼ ê²½ë¡œ ì˜¬ë°”ë¦„
- ë³´ì•ˆ í‚¤ í™˜ê²½ ë³€ìˆ˜ ì§€ì›
- íŒŒì¼ í¬ê¸° ì œí•œ ì„¤ì •ë¨

### 3. ë¼ìš°íŠ¸ ì •ì˜

| ë¼ìš°íŠ¸ | ë©”ì„œë“œ | ê¸°ëŠ¥ | ìƒíƒœ |
|--------|--------|------|------|
| `/` | GET | ë©”ì¸ í˜ì´ì§€ | âœ… |
| `/upload` | POST | íŒŒì¼ ì—…ë¡œë“œ ë° ì²˜ë¦¬ | âœ… |
| `/result/<session_id>` | GET | ê²°ê³¼ í˜ì´ì§€ | âœ… |
| `/download/<format>/<employee_name>` | GET | ê°œë³„ íŒŒì¼ ë‹¤ìš´ë¡œë“œ | âœ… |
| `/batch_download/<format>` | GET | ì¼ê´„ ë‹¤ìš´ë¡œë“œ (ZIP) | âœ… |

**ìƒíƒœ**: âœ… ëª¨ë“  ë¼ìš°íŠ¸ê°€ ì˜¬ë°”ë¥´ê²Œ ì •ì˜ë¨

### 4. ì—ëŸ¬ í•¸ë“¤ëŸ¬

```python
@app.errorhandler(404)
def not_found(error):
    return render_template('error.html', message='í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'), 404

@app.errorhandler(500)
def internal_error(error):
    logger.exception("ì„œë²„ ì˜¤ë¥˜ ë°œìƒ")
    return render_template('error.html', message='ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'), 500
```

**ìƒíƒœ**: âœ… ì—ëŸ¬ í•¸ë“¤ëŸ¬ê°€ ì ì ˆíˆ êµ¬í˜„ë¨

### 5. ì‹¤í–‰ ë¶€ë¶„

```python
if __name__ == '__main__':
    debug_mode = os.environ.get('FLASK_DEBUG', 'False').lower() == 'true'
    app.run(debug=debug_mode, host='0.0.0.0', port=5000)
```

**ìƒíƒœ**: âœ… ì‹¤í–‰ ì½”ë“œê°€ ì •ìƒì ì„
- í™˜ê²½ ë³€ìˆ˜ë¡œ ë””ë²„ê·¸ ëª¨ë“œ ì œì–´ ê°€ëŠ¥
- ëª¨ë“  ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥ (0.0.0.0)
- í¬íŠ¸ 5000 ì‚¬ìš©

---

## âš ï¸ ë°œê²¬ëœ ì ì¬ì  ë¬¸ì œì 

### 1. Flask í™˜ê²½ ë³€ìˆ˜ (ê²½ê³ )

**ë¬¸ì œ**: `FLASK_ENV`ëŠ” Flask 2.2 ì´í›„ë¡œ deprecatedë¨

```python
# run_web.shì—ì„œ ì‚¬ìš© ì¤‘
export FLASK_ENV=development  # âš ï¸ Flask 3.xì—ì„œëŠ” ë¬´ì‹œë¨
```

**ì˜í–¥**: ì—ëŸ¬ëŠ” ë°œìƒí•˜ì§€ ì•Šì§€ë§Œ, í™˜ê²½ ë³€ìˆ˜ê°€ ë¬´ì‹œë¨

**ê¶Œì¥ ì¡°ì¹˜**: 
- `FLASK_ENV` ì œê±° ë˜ëŠ” ì£¼ì„ ì²˜ë¦¬
- `FLASK_DEBUG=True`ë§Œ ì‚¬ìš© (Flask 3.x ê¶Œì¥ ë°©ì‹)

### 2. ì„¸ì…˜ ê´€ë¦¬

**í˜„ì¬ êµ¬í˜„**:
```python
session_id = str(uuid.uuid4())
session['session_id'] = session_id
session['results'] = results
```

**ì ì¬ì  ë¬¸ì œ**:
- ì„¸ì…˜ ë§Œë£Œ ì‹œê°„ ì„¤ì • ì—†ìŒ
- ì„¸ì…˜ ë°ì´í„°ê°€ ë©”ëª¨ë¦¬ì— ì €ì¥ë¨ (ì„œë²„ ì¬ì‹œì‘ ì‹œ ì†ì‹¤)
- ë™ì‹œ ì‚¬ìš©ì ì²˜ë¦¬ ì‹œ ì„¸ì…˜ ì¶©ëŒ ê°€ëŠ¥ì„±

**ê¶Œì¥ ê°œì„ ** (v2.0):
- ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ì„¤ì •
- Redis ë˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ê¸°ë°˜ ì„¸ì…˜ ì €ì¥ì†Œ ê³ ë ¤

### 3. íŒŒì¼ ê²½ë¡œ ì²˜ë¦¬

**í˜„ì¬ êµ¬í˜„**:
```python
filepath = os.path.join(app.config['UPLOAD_FOLDER'], f"{session_id}_{filename}")
```

**ì ì¬ì  ë¬¸ì œ**:
- íŒŒì¼ëª…ì— íŠ¹ìˆ˜ë¬¸ì í¬í•¨ ì‹œ ë¬¸ì œ ê°€ëŠ¥ì„±
- `secure_filename` ì‚¬ìš©í•˜ì§€ë§Œ ì™„ë²½í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ

**ê¶Œì¥ ê°œì„ **:
- íŒŒì¼ëª… ê²€ì¦ ê°•í™”
- íŒŒì¼ í¬ê¸° ì‚¬ì „ ê²€ì¦ ì¶”ê°€

---

## âœ… ì½”ë“œ í’ˆì§ˆ í‰ê°€

### ê°•ì 

1. âœ… **ëª¨ë“ˆí™”**: ê¸°ì¡´ `payroll_generator` ëª¨ë“ˆ ì¬ì‚¬ìš©
2. âœ… **ì—ëŸ¬ ì²˜ë¦¬**: try-except ë¸”ë¡ìœ¼ë¡œ ì ì ˆí•œ ì—ëŸ¬ ì²˜ë¦¬
3. âœ… **ë¡œê¹…**: `setup_logger`ë¥¼ í†µí•œ ë¡œê¹… ì‹œìŠ¤í…œ í†µí•©
4. âœ… **ë³´ì•ˆ**: `secure_filename` ì‚¬ìš©, íŒŒì¼ í™•ì¥ì ê²€ì¦
5. âœ… **í…œí”Œë¦¿ ê¸°ë°˜**: `use_template=True`ë¡œ í…œí”Œë¦¿ ê¸°ë°˜ ìƒì„± ì‚¬ìš©

### ê°œì„  ê¶Œì¥ ì‚¬í•­

1. âš ï¸ **ì„¸ì…˜ ê´€ë¦¬ ê°•í™”**: íƒ€ì„ì•„ì›ƒ ì„¤ì •, ì„¸ì…˜ ì •ë¦¬ ë¡œì§ ì¶”ê°€
2. âš ï¸ **íŒŒì¼ ê²€ì¦ ê°•í™”**: MIME íƒ€ì… ê²€ì¦, íŒŒì¼ ë‚´ìš© ê²€ì¦
3. âš ï¸ **ì—ëŸ¬ ë©”ì‹œì§€ ê°œì„ **: ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€
4. âš ï¸ **ë¡œê¹… ê°•í™”**: ë” ìƒì„¸í•œ ë¡œê¹… (ìš”ì²­ ID, ì‚¬ìš©ì ì •ë³´ ë“±)

---

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### ë°©ë²• 1: ì§ì ‘ ì‹¤í–‰

```bash
# ê°€ìƒí™˜ê²½ í™œì„±í™”
source venv/bin/activate

# ì˜ì¡´ì„± í™•ì¸ (ì´ë¯¸ ì„¤ì¹˜ë¨)
pip list | grep flask

# ì•± ì‹¤í–‰
python app.py
```

### ë°©ë²• 2: ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©

```bash
# í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ
./web_scripts/run_web.sh
```

### ë°©ë²• 3: Flask CLI ì‚¬ìš©

```bash
source venv/bin/activate
export FLASK_APP=app.py
export FLASK_DEBUG=True
flask run --host=0.0.0.0 --port=5000
```

---

## ğŸ“ í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

- [ ] ì•± ì‹¤í–‰ í™•ì¸
- [ ] ë©”ì¸ í˜ì´ì§€ ì ‘ì† (`http://localhost:5000`)
- [ ] íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] ê¸‰ì—¬ ê³„ì‚° ê²°ê³¼ í™•ì¸
- [ ] ì—‘ì…€ ë‹¤ìš´ë¡œë“œ í…ŒìŠ¤íŠ¸
- [ ] PDF ë‹¤ìš´ë¡œë“œ í…ŒìŠ¤íŠ¸
- [ ] ì¼ê´„ ë‹¤ìš´ë¡œë“œ (ZIP) í…ŒìŠ¤íŠ¸

### ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸

- [ ] ì˜ëª»ëœ íŒŒì¼ í˜•ì‹ ì—…ë¡œë“œ
- [ ] í•„ìˆ˜ ì»¬ëŸ¼ ëˆ„ë½ëœ ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ
- [ ] ì„¸ì…˜ ë§Œë£Œ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
- [ ] 404 ì—ëŸ¬ í˜ì´ì§€ í™•ì¸
- [ ] 500 ì—ëŸ¬ í˜ì´ì§€ í™•ì¸

---

## ğŸ”§ ìˆ˜ì • ì‚¬í•­

### 1. run_web.sh ê°œì„  (ì„ íƒì‚¬í•­)

```bash
#!/bin/bash
# ì›¹ ì„œë²„ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ (Linux/Mac)

# í”„ë¡œì íŠ¸ ë£¨íŠ¸ë¡œ ì´ë™
cd "$(dirname "$0")/.."

# ê°€ìƒí™˜ê²½ í™œì„±í™”
if [ -d "venv" ]; then
    source venv/bin/activate
else
    echo "âŒ ê°€ìƒí™˜ê²½ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. venv í´ë”ë¥¼ í™•ì¸í•˜ì„¸ìš”."
    exit 1
fi

# ì˜ì¡´ì„± í™•ì¸
if ! python -c "import flask" 2>/dev/null; then
    echo "âš ï¸ Flaskê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤. ì„¤ì¹˜ ì¤‘..."
    pip install -r requirements-web.txt
fi

# Flask ì•± ì‹¤í–‰
export FLASK_APP=app.py
export FLASK_DEBUG=True
# FLASK_ENVëŠ” Flask 3.xì—ì„œ deprecatedë˜ì—ˆìœ¼ë¯€ë¡œ ì œê±°

python app.py
```

---

## âœ… ìµœì¢… í‰ê°€

### ì½”ë“œ ìƒíƒœ: **ì–‘í˜¸** (Good)

`app.py` íŒŒì¼ì€ **ì˜ êµ¬ì¡°í™”ë˜ì–´ ìˆìœ¼ë©°**, ëª¨ë“  í•µì‹¬ ê¸°ëŠ¥ì´ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

### í•´ê²°ëœ ë¬¸ì œ

1. âœ… Flask ëª¨ë“ˆ ì„¤ì¹˜ ì™„ë£Œ
2. âœ… ëª¨ë“  ì˜ì¡´ì„± ì„¤ì¹˜ ì™„ë£Œ
3. âœ… ì½”ë“œ êµ¬ì¡° ê²€ì¦ ì™„ë£Œ

### ì‹¤í–‰ ê°€ëŠ¥ ì—¬ë¶€

**âœ… ì‹¤í–‰ ê°€ëŠ¥**: ëª¨ë“  ì˜ì¡´ì„±ì´ ì„¤ì¹˜ë˜ì—ˆìœ¼ë©°, ì½”ë“œì— ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.

---

## ğŸ“‹ ë‹¤ìŒ ë‹¨ê³„

1. **ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥**
   ```bash
   source venv/bin/activate
   python app.py
   ```

2. **í…ŒìŠ¤íŠ¸ ì§„í–‰**
   - ìƒ˜í”Œ ì—‘ì…€ íŒŒì¼ë¡œ ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
   - ê° ì—”ë“œí¬ì¸íŠ¸ ë™ì‘ í™•ì¸

3. **ê°œì„  ì‚¬í•­ ì ìš©** (ì„ íƒì‚¬í•­)
   - ì„¸ì…˜ ê´€ë¦¬ ê°•í™”
   - íŒŒì¼ ê²€ì¦ ê°•í™”
   - ì—ëŸ¬ ë©”ì‹œì§€ ê°œì„ 

---

**ì‘ì„±ì**: AI Assistant  
**ì ê²€ ì¼ì**: 2025-01-XX  
**ìƒíƒœ**: âœ… ë¬¸ì œ í•´ê²° ì™„ë£Œ

