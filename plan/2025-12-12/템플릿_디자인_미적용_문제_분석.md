# í…œí”Œë¦¿ ë””ìì¸ ë¯¸ì ìš© ë¬¸ì œ ë¶„ì„

**ì‘ì„±ì¼**: 2025-12-12  
**ë¬¸ì œ**: ë©”ë‰´ë°”ì˜ [ë‹¨ì¼ì§ì›]ì—ì„œ "í…œí”Œë¦¿1: ê¸‰ì—¬ëª…ì„¸ì„œ" ì„ íƒ ì‹œ ê¸°ë³¸ ë””ìì¸ìœ¼ë¡œ ìƒì„±ë¨

---

## ğŸ” ë¬¸ì œ ë¶„ì„

### ì½”ë“œ íë¦„ í™•ì¸

#### 1. í¼ ì œì¶œ ë° ì„¸ì…˜ ì €ì¥ (`app/routes/payroll.py`)
```python
# 64-65ì¤„
design_name_value = form.design_name.data if hasattr(form, 'design_name') and form.design_name.data else None
session['design_name'] = design_name_value if design_name_value != 'default' else None
```

**í™•ì¸ ì‚¬í•­**:
- `form.design_name.data`ê°€ `'template_sample1'`ì¸ì§€ í™•ì¸ í•„ìš”
- ì„¸ì…˜ì— ì˜¬ë°”ë¥´ê²Œ ì €ì¥ë˜ëŠ”ì§€ í™•ì¸ í•„ìš”

#### 2. ë‹¤ìš´ë¡œë“œ ì‹œ ì„¸ì…˜ì—ì„œ ì½ê¸° (`app/routes/main.py`)
```python
# 214-216ì¤„
design_name = session.get('design_name', None)
if design_name == 'default':
    design_name = None
```

**í™•ì¸ ì‚¬í•­**:
- ì„¸ì…˜ì—ì„œ `design_name`ì´ ì˜¬ë°”ë¥´ê²Œ ì½íˆëŠ”ì§€ í™•ì¸ í•„ìš”
- `'template_sample1'`ì´ ê·¸ëŒ€ë¡œ ì „ë‹¬ë˜ëŠ”ì§€ í™•ì¸ í•„ìš”

#### 3. ExcelHandlerì—ì„œ ë””ìì¸ ì²˜ë¦¬ (`payroll_generator/excel_handler.py`)
```python
# 64-74ì¤„
if design_name:
    try:
        from .templates.designs.design_factory import DesignFactory
        design = DesignFactory.get_design(design_name)
        if design:
            logger.info(f"ë””ìì¸ '{design_name}' ì‚¬ìš©í•˜ì—¬ ì—‘ì…€ ìƒì„±")
            return design.generate_excel(payroll_data, employee_data, output_path, period)
        else:
            logger.warning(f"ë””ìì¸ '{design_name}'ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ë°©ì‹ ì‚¬ìš©")
    except Exception as e:
        logger.warning(f"ë””ìì¸ ìƒì„± ì‹¤íŒ¨ ({design_name}), ê¸°ë³¸ ë°©ì‹ ì‚¬ìš©: {e}")
```

**í™•ì¸ ì‚¬í•­**:
- `DesignFactory.get_design('template_sample1')`ì´ ì˜¬ë°”ë¥¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•˜ëŠ”ì§€ í™•ì¸ í•„ìš”
- ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ”ì§€ í™•ì¸ í•„ìš”

#### 4. DesignFactoryì—ì„œ ë””ìì¸ ê°€ì ¸ì˜¤ê¸° (`payroll_generator/templates/designs/design_factory.py`)
```python
# 52-75ì¤„
@classmethod
def get_design(cls, design_name='default'):
    if design_name == 'default' or design_name is None:
        return None
    
    if design_name not in cls._designs:
        logger.warning(f"ì•Œ ìˆ˜ ì—†ëŠ” ë””ìì¸: {design_name}, ê¸°ë³¸ ë°©ì‹ ì‚¬ìš©")
        return None
    
    design_class = cls._designs.get(design_name)
    if design_class is None:
        return None
    
    # ì‹±ê¸€í†¤ íŒ¨í„´ìœ¼ë¡œ ì¸ìŠ¤í„´ìŠ¤ ì¬ì‚¬ìš©
    if design_name not in cls._instances:
        try:
            cls._instances[design_name] = design_class()
            logger.info(f"ë””ìì¸ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì™„ë£Œ: {design_name}")
        except Exception as e:
            logger.error(f"ë””ìì¸ ìƒì„± ì‹¤íŒ¨: {design_name}, {e}")
            return None
    
    return cls._instances[design_name]
```

**í™•ì¸ ì‚¬í•­**:
- `TemplateSample1`ì´ `None`ì¸ì§€ í™•ì¸ í•„ìš” (Import ì‹¤íŒ¨ ì‹œ)
- ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì‹œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ”ì§€ í™•ì¸ í•„ìš”

---

## ğŸ› ê°€ëŠ¥í•œ ì›ì¸

### ì›ì¸ 1: TemplateSample1/TemplateSample2 Import ì‹¤íŒ¨

**ì¦ìƒ**: `TemplateSample1` ë˜ëŠ” `TemplateSample2`ê°€ `None`ìœ¼ë¡œ ì„¤ì •ë¨

**í™•ì¸ ë°©ë²•**:
```python
from payroll_generator.templates.designs.design_factory import DesignFactory
print(DesignFactory._designs)
# {'template_sample1': None, ...} ì´ë©´ Import ì‹¤íŒ¨
```

**í•´ê²° ë°©ë²•**:
- Import ê²½ë¡œ í™•ì¸
- `template_sample1.py`, `template_sample2.py` íŒŒì¼ì´ ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì— ìˆëŠ”ì§€ í™•ì¸
- `template_design.py`ì˜ Import ê²½ë¡œ í™•ì¸

### ì›ì¸ 2: í…œí”Œë¦¿ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ

**ì¦ìƒ**: `TemplateSample1()` ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì‹œ `FileNotFoundError` ë°œìƒ

**í™•ì¸ ë°©ë²•**:
- ë¡œê·¸ì—ì„œ "í…œí”Œë¦¿ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" ì—ëŸ¬ í™•ì¸
- `payroll_generator/templates/designs/template_sample1.xlsx` íŒŒì¼ ì¡´ì¬ í™•ì¸

**í•´ê²° ë°©ë²•**:
- í…œí”Œë¦¿ íŒŒì¼ì´ ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì— ìˆëŠ”ì§€ í™•ì¸
- `resource_path()` í•¨ìˆ˜ê°€ ì˜¬ë°”ë¥´ê²Œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸

### ì›ì¸ 3: ì…€ ë§¤í•‘ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ

**ì¦ìƒ**: ì…€ ë§¤í•‘ì´ ë¹„ì–´ìˆì–´ ê¸°ë³¸ ë§¤í•‘ ì‚¬ìš©

**í™•ì¸ ë°©ë²•**:
- ë¡œê·¸ì—ì„œ "ì…€ ë§¤í•‘ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" ê²½ê³  í™•ì¸
- `payroll_generator/templates/designs/configs/template_sample1_mapping.json` íŒŒì¼ ì¡´ì¬ í™•ì¸

**í•´ê²° ë°©ë²•**:
- ì…€ ë§¤í•‘ JSON íŒŒì¼ì´ ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì— ìˆëŠ”ì§€ í™•ì¸
- íŒŒì¼ì´ ë¹„ì–´ìˆì§€ ì•Šì€ì§€ í™•ì¸

### ì›ì¸ 4: í¼ ë°ì´í„°ê°€ ì„¸ì…˜ì— ì €ì¥ë˜ì§€ ì•ŠìŒ

**ì¦ìƒ**: ì„¸ì…˜ì— `design_name`ì´ ì—†ê±°ë‚˜ ì˜ëª»ëœ ê°’

**í™•ì¸ ë°©ë²•**:
- ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€í•˜ì—¬ `form.design_name.data` ê°’ í™•ì¸
- ì„¸ì…˜ì— ì €ì¥ëœ ê°’ í™•ì¸

**í•´ê²° ë°©ë²•**:
- í¼ í•„ë“œ ì´ë¦„ í™•ì¸ (`name="design_name"`)
- í¼ ì œì¶œ ì‹œ ê°’ì´ ì „ë‹¬ë˜ëŠ”ì§€ í™•ì¸

---

## ğŸ”§ ë””ë²„ê¹… ë°©ë²•

### 1. ë¡œê·¸ í™•ì¸

ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ì—ì„œ ë‹¤ìŒ ë©”ì‹œì§€ í™•ì¸:
- `ë””ìì¸ 'template_sample1' ì‚¬ìš©í•˜ì—¬ ì—‘ì…€ ìƒì„±` (ì„±ê³µ)
- `ë””ìì¸ 'template_sample1'ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ë°©ì‹ ì‚¬ìš©` (ì‹¤íŒ¨)
- `ë””ìì¸ ìƒì„± ì‹¤íŒ¨ (template_sample1), ê¸°ë³¸ ë°©ì‹ ì‚¬ìš©: ...` (ì˜ˆì™¸ ë°œìƒ)

### 2. ë””ë²„ê¹… ì½”ë“œ ì¶”ê°€

`app/routes/payroll.py`ì— ë””ë²„ê¹… ì½”ë“œ ì¶”ê°€:
```python
# 64-65ì¤„ ìˆ˜ì •
design_name_value = form.design_name.data if hasattr(form, 'design_name') and form.design_name.data else None
print(f"DEBUG: form.design_name.data = {form.design_name.data}")
print(f"DEBUG: design_name_value = {design_name_value}")
session['design_name'] = design_name_value if design_name_value != 'default' else None
print(f"DEBUG: session['design_name'] = {session['design_name']}")
```

`app/routes/main.py`ì— ë””ë²„ê¹… ì½”ë“œ ì¶”ê°€:
```python
# 214-216ì¤„ ìˆ˜ì •
design_name = session.get('design_name', None)
print(f"DEBUG: session design_name = {design_name}")
if design_name == 'default':
    design_name = None
print(f"DEBUG: final design_name = {design_name}")
```

`payroll_generator/excel_handler.py`ì— ë””ë²„ê¹… ì½”ë“œ ì¶”ê°€:
```python
# 64ì¤„ ìˆ˜ì •
if design_name:
    print(f"DEBUG: excel_handler design_name = {design_name}")
    try:
        from .templates.designs.design_factory import DesignFactory
        print(f"DEBUG: DesignFactory._designs = {DesignFactory._designs}")
        design = DesignFactory.get_design(design_name)
        print(f"DEBUG: design = {design}")
        if design:
            logger.info(f"ë””ìì¸ '{design_name}' ì‚¬ìš©í•˜ì—¬ ì—‘ì…€ ìƒì„±")
            return design.generate_excel(payroll_data, employee_data, output_path, period)
```

### 3. ì§ì ‘ í…ŒìŠ¤íŠ¸

Python ì½˜ì†”ì—ì„œ ì§ì ‘ í…ŒìŠ¤íŠ¸:
```python
from payroll_generator.templates.designs.design_factory import DesignFactory

# ë””ìì¸ ëª©ë¡ í™•ì¸
print(DesignFactory.list_available_designs())

# TemplateSample1 ê°€ì ¸ì˜¤ê¸°
design = DesignFactory.get_design('template_sample1')
print(f"design = {design}")
print(f"type = {type(design)}")

# í…œí”Œë¦¿ íŒŒì¼ í™•ì¸
if design:
    print(f"template_filename = {design.template_filename}")
    print(f"cell_mapping = {design.cell_mapping}")
```

---

## ğŸ” ì¦‰ì‹œ í™•ì¸ ê°€ëŠ¥í•œ ì›ì¸

### ê°€ì¥ ê°€ëŠ¥ì„± ë†’ì€ ì›ì¸: TemplateSample1/TemplateSample2 Import ì‹¤íŒ¨

**ì¦ìƒ**: `DesignFactory._designs['template_sample1']`ì´ `None`

**í™•ì¸ ë°©ë²•**:
ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ì—ì„œ ë‹¤ìŒ ë©”ì‹œì§€ í™•ì¸:
```
ë””ìì¸ í´ë˜ìŠ¤ê°€ Noneì…ë‹ˆë‹¤: template_sample1. Import ì‹¤íŒ¨ ê°€ëŠ¥ì„±.
```

**ì›ì¸**:
- `template_sample1.py` ë˜ëŠ” `template_sample2.py`ì˜ Import ê²½ë¡œ ë¬¸ì œ
- `template_design.py`ì˜ Import ê²½ë¡œ ë¬¸ì œ
- ìˆœí™˜ ì°¸ì¡° ë¬¸ì œ

**í•´ê²° ë°©ë²•**:
1. `template_sample1.py`ì˜ Import ê²½ë¡œ í™•ì¸:
   ```python
   from .template_design import TemplateDesign
   ```
   ì´ ê²½ë¡œê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸

2. `template_design.py`ì˜ Import ê²½ë¡œ í™•ì¸:
   ```python
   from .base_design import BaseDesign
   ```
   ì´ ê²½ë¡œê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸

3. `design_factory.py`ì˜ Import ê²½ë¡œ í™•ì¸:
   ```python
   try:
       from .template_sample1 import TemplateSample1
   except ImportError:
       try:
           from payroll_generator.templates.designs.template_sample1 import TemplateSample1
       except ImportError:
           TemplateSample1 = None
   ```

---

## âœ… í•´ê²° ë°©ë²•

### í•´ê²° 1: Import ê²½ë¡œ í™•ì¸ ë° ìˆ˜ì •

`design_factory.py`ì˜ Import ê²½ë¡œê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸:
```python
try:
    from .template_sample1 import TemplateSample1
except ImportError as e:
    print(f"Import error: {e}")
    try:
        from payroll_generator.templates.designs.template_sample1 import TemplateSample1
    except ImportError as e2:
        print(f"Import error 2: {e2}")
        TemplateSample1 = None
```

### í•´ê²° 2: í…œí”Œë¦¿ íŒŒì¼ ê²½ë¡œ í™•ì¸

í…œí”Œë¦¿ íŒŒì¼ì´ ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì— ìˆëŠ”ì§€ í™•ì¸:
```bash
ls -la payroll_generator/templates/designs/template_sample*.xlsx
```

### í•´ê²° 3: ì…€ ë§¤í•‘ íŒŒì¼ í™•ì¸

ì…€ ë§¤í•‘ JSON íŒŒì¼ì´ ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì— ìˆëŠ”ì§€ í™•ì¸:
```bash
ls -la payroll_generator/templates/designs/configs/template_sample*.json
```

### í•´ê²° 4: ë¡œê¹… ê°•í™”

ë” ìƒì„¸í•œ ë¡œê·¸ë¥¼ ì¶”ê°€í•˜ì—¬ ë¬¸ì œ ì§€ì  íŒŒì•…:
- í¼ ë°ì´í„° ë¡œê·¸
- ì„¸ì…˜ ë°ì´í„° ë¡œê·¸
- DesignFactory ë™ì‘ ë¡œê·¸
- í…œí”Œë¦¿ íŒŒì¼ ë¡œë“œ ë¡œê·¸

---

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ì²´í¬ë¦¬ìŠ¤íŠ¸:

- [ ] `form.design_name.data`ê°€ `'template_sample1'`ì¸ì§€ í™•ì¸
- [ ] ì„¸ì…˜ì— `design_name`ì´ ì˜¬ë°”ë¥´ê²Œ ì €ì¥ë˜ëŠ”ì§€ í™•ì¸
- [ ] `DesignFactory._designs['template_sample1']`ì´ `None`ì´ ì•„ë‹Œì§€ í™•ì¸
- [ ] `DesignFactory.get_design('template_sample1')`ì´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•˜ëŠ”ì§€ í™•ì¸
- [ ] í…œí”Œë¦¿ íŒŒì¼ì´ ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì— ìˆëŠ”ì§€ í™•ì¸
- [ ] ì…€ ë§¤í•‘ JSON íŒŒì¼ì´ ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì— ìˆëŠ”ì§€ í™•ì¸
- [ ] ë¡œê·¸ì—ì„œ ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸

---

**ì‘ì„±ì**: AI Assistant  
**ì‘ì„±ì¼**: 2025-12-12  
**ìƒíƒœ**: ğŸ” ë¬¸ì œ ë¶„ì„ ì™„ë£Œ
