# í…œí”Œë¦¿ ë””ìì¸ ë¯¸ì ìš© ë¬¸ì œ ì›ì¸ ë° í•´ê²°ë°©ì•ˆ

**ì‘ì„±ì¼**: 2025-12-12  
**ë¬¸ì œ**: í…œí”Œë¦¿1 ì„ íƒ ì‹œ ê¸°ë³¸ ë””ìì¸ìœ¼ë¡œ PDF ìƒì„±ë¨  
**ëª©í‘œ**: `sample/ê¸‰ì—¬ëª…ì„¸ì„œ_template.xlsx`ì™€ ë™ì¼í•œ ë””ìì¸ìœ¼ë¡œ ì¶œë ¥

---

## ğŸ” ë¬¸ì œ ì›ì¸ ë¶„ì„

### í•µì‹¬ ë¬¸ì œ ë°œê²¬

#### ë¬¸ì œ 1: `TemplateDesign.generate_pdf()` ë©”ì„œë“œì˜ í•˜ë“œì½”ë”©ëœ ê¸°ë³¸ ë””ìì¸ ì‚¬ìš©

**ìœ„ì¹˜**: `payroll_generator/templates/designs/template_design.py:235-251`

**í˜„ì¬ ì½”ë“œ**:
```python
def generate_pdf(self, payroll_data, employee_data, output_path, period):
    """PDF ìƒì„± (ê¸°ë³¸ ë””ìì¸ ì‚¬ìš© ë˜ëŠ” ì—‘ì…€ ë³€í™˜)"""
    # ì´ˆê¸° ë²„ì „: ê¸°ë³¸ PDF ìƒì„± ë°©ì‹ ì‚¬ìš©
    # í–¥í›„: í…œí”Œë¦¿ ìŠ¤íƒ€ì¼ì„ ë°˜ì˜í•œ PDF ìƒì„± êµ¬í˜„ ê°€ëŠ¥
    try:
        from ...pdf_generator import PDFGenerator
    except ImportError:
        try:
            from payroll_generator.pdf_generator import PDFGenerator
        except ImportError:
            from pdf_generator import PDFGenerator
    
    pdf_gen = PDFGenerator()
    return pdf_gen.generate_payslip(
        payroll_data, employee_data, output_path, period,
        use_template=False, design_name=None  # âŒ ë¬¸ì œ: í•­ìƒ None!
    )
```

**ë¬¸ì œì **:
- `design_name=None`ìœ¼ë¡œ í•˜ë“œì½”ë”©ë˜ì–´ ìˆì–´ í•­ìƒ ê¸°ë³¸ ë””ìì¸ ì‚¬ìš©
- í…œí”Œë¦¿ ì—‘ì…€ íŒŒì¼ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ì½”ë“œ ê¸°ë°˜ PDF ìƒì„±
- í…œí”Œë¦¿ì˜ ë””ìì¸(ë ˆì´ì•„ì›ƒ, ìŠ¤íƒ€ì¼)ì´ ì „í˜€ ë°˜ì˜ë˜ì§€ ì•ŠìŒ

#### ë¬¸ì œ 2: PDF ìƒì„± ì‹œ í…œí”Œë¦¿ ì—‘ì…€ íŒŒì¼ ë¯¸ì‚¬ìš©

**í˜„ì¬ ë™ì‘**:
1. `TemplateDesign.generate_pdf()` í˜¸ì¶œ
2. ë‚´ë¶€ì—ì„œ `PDFGenerator.generate_payslip(design_name=None)` í˜¸ì¶œ
3. ê¸°ë³¸ ì½”ë“œ ê¸°ë°˜ PDF ìƒì„± ì‹¤í–‰
4. í…œí”Œë¦¿ ì—‘ì…€ íŒŒì¼(`template_sample1.xlsx`)ì„ ì „í˜€ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ

**ê¸°ëŒ€ ë™ì‘**:
1. í…œí”Œë¦¿ ì—‘ì…€ íŒŒì¼ ë¡œë“œ
2. ë°ì´í„° ì±„ìš°ê¸°
3. ì—‘ì…€ íŒŒì¼ì„ PDFë¡œ ë³€í™˜ ë˜ëŠ” ì—‘ì…€ ìŠ¤íƒ€ì¼ì„ ë°˜ì˜í•œ PDF ìƒì„±

---

## ğŸ¯ í•´ê²° ë°©ì•ˆ

### í•´ê²° ë°©ì•ˆ 1: ì—‘ì…€ ìƒì„± í›„ PDF ë³€í™˜ (ê¶Œì¥)

í…œí”Œë¦¿ ì—‘ì…€ íŒŒì¼ì„ ìƒì„±í•œ í›„ PDFë¡œ ë³€í™˜í•˜ëŠ” ë°©ì‹:

**ì¥ì **:
- í…œí”Œë¦¿ì˜ ëª¨ë“  ìŠ¤íƒ€ì¼(í°íŠ¸, ìƒ‰ìƒ, ë ˆì´ì•„ì›ƒ)ì´ ê·¸ëŒ€ë¡œ ìœ ì§€ë¨
- êµ¬í˜„ì´ ë¹„êµì  ê°„ë‹¨í•¨

**ë‹¨ì **:
- ì—‘ì…€â†’PDF ë³€í™˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•„ìš”
- í”Œë«í¼ ì˜ì¡´ì„± ê°€ëŠ¥ì„±

**êµ¬í˜„ ë°©ë²•**:
```python
def generate_pdf(self, payroll_data, employee_data, output_path, period):
    """í…œí”Œë¦¿ ì—‘ì…€ íŒŒì¼ì„ ìƒì„±í•œ í›„ PDFë¡œ ë³€í™˜"""
    import tempfile
    
    # 1. ì„ì‹œ ì—‘ì…€ íŒŒì¼ ìƒì„±
    with tempfile.NamedTemporaryFile(suffix='.xlsx', delete=False) as tmp:
        temp_excel_path = tmp.name
    
    try:
        # 2. í…œí”Œë¦¿ ê¸°ë°˜ ì—‘ì…€ ìƒì„±
        self.generate_excel(payroll_data, employee_data, temp_excel_path, period)
        
        # 3. ì—‘ì…€ì„ PDFë¡œ ë³€í™˜
        # ì˜µì…˜ A: xlsx2pdf ì‚¬ìš© (í”Œë«í¼ ë…ë¦½ì )
        try:
            from xlsx2pdf import convert_xlsx_to_pdf
            convert_xlsx_to_pdf(temp_excel_path, output_path)
            return output_path
        except ImportError:
            pass
        
        # ì˜µì…˜ B: LibreOffice ì‚¬ìš© (í¬ë¡œìŠ¤ í”Œë«í¼)
        try:
            import subprocess
            subprocess.run([
                'libreoffice', '--headless', '--convert-to', 'pdf',
                '--outdir', os.path.dirname(output_path),
                temp_excel_path
            ], check=True)
            # ì¶œë ¥ íŒŒì¼ëª… ë³€ê²½
            pdf_name = os.path.basename(temp_excel_path).replace('.xlsx', '.pdf')
            pdf_path = os.path.join(os.path.dirname(output_path), pdf_name)
            if os.path.exists(pdf_path) and pdf_path != output_path:
                os.rename(pdf_path, output_path)
            return output_path
        except (subprocess.CalledProcessError, FileNotFoundError):
            pass
        
        # ì˜µì…˜ C: Windows COM ê°ì²´ ì‚¬ìš© (Windows ì „ìš©)
        try:
            import win32com.client
            excel = win32com.client.Dispatch("Excel.Application")
            excel.Visible = False
            workbook = excel.Workbooks.Open(temp_excel_path)
            workbook.ExportAsFixedFormat(0, output_path)  # 0 = PDF
            workbook.Close()
            excel.Quit()
            return output_path
        except ImportError:
            pass
        
        # í´ë°±: ì—‘ì…€ íŒŒì¼ì„ ì—´ì–´ì„œ ìˆ˜ë™ ë³€í™˜ ì•ˆë‚´
        logger.warning("ì—‘ì…€â†’PDF ë³€í™˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        logger.warning(f"ì—‘ì…€ íŒŒì¼ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤: {temp_excel_path}")
        logger.warning("ìˆ˜ë™ìœ¼ë¡œ PDFë¡œ ë³€í™˜í•˜ê±°ë‚˜, ì—‘ì…€ íŒŒì¼ì„ ì‚¬ìš©í•˜ì„¸ìš”.")
        raise NotImplementedError("ì—‘ì…€â†’PDF ìë™ ë³€í™˜ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.")
        
    finally:
        # ì„ì‹œ ì—‘ì…€ íŒŒì¼ ì‚­ì œ (ì„ íƒì‚¬í•­)
        if os.path.exists(temp_excel_path):
            os.unlink(temp_excel_path)
```

### í•´ê²° ë°©ì•ˆ 2: ì—‘ì…€ ìŠ¤íƒ€ì¼ì„ ì½ì–´ì„œ reportlabìœ¼ë¡œ PDF ìƒì„± (í˜„ì‹¤ì )

í…œí”Œë¦¿ ì—‘ì…€ íŒŒì¼ì˜ ìŠ¤íƒ€ì¼ì„ ì½ì–´ì„œ reportlabìœ¼ë¡œ ë™ì¼í•œ ìŠ¤íƒ€ì¼ì˜ PDF ìƒì„±:

**ì¥ì **:
- í”Œë«í¼ ë…ë¦½ì 
- ì¶”ê°€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¶ˆí•„ìš” (openpyxl, reportlabë§Œ ì‚¬ìš©)

**ë‹¨ì **:
- êµ¬í˜„ì´ ë³µì¡í•¨
- ëª¨ë“  ìŠ¤íƒ€ì¼ì„ ì™„ë²½í•˜ê²Œ ì¬í˜„í•˜ê¸° ì–´ë ¤ì›€

**êµ¬í˜„ ë°©ë²•**:
```python
def generate_pdf(self, payroll_data, employee_data, output_path, period):
    """í…œí”Œë¦¿ ì—‘ì…€ íŒŒì¼ì˜ ìŠ¤íƒ€ì¼ì„ ì½ì–´ì„œ PDF ìƒì„±"""
    import openpyxl
    from reportlab.lib.pagesizes import A4
    from reportlab.pdfgen import canvas
    from reportlab.lib.units import mm
    
    # 1. í…œí”Œë¦¿ íŒŒì¼ ë¡œë“œ
    template_path = self._get_template_path()
    wb = openpyxl.load_workbook(template_path)
    ws = wb.active
    
    # 2. ìŠ¤íƒ€ì¼ ì •ë³´ ì½ê¸°
    styles = {}
    for row in ws.iter_rows():
        for cell in row:
            if cell.value:
                styles[cell.coordinate] = {
                    'font': cell.font,
                    'fill': cell.fill,
                    'alignment': cell.alignment,
                    'border': cell.border,
                }
    
    # 3. ë°ì´í„° ì±„ìš°ê¸° (ë©”ëª¨ë¦¬ìƒì—ì„œë§Œ)
    self._fill_template_data(ws, payroll_data, employee_data, period)
    
    # 4. reportlabìœ¼ë¡œ PDF ìƒì„± (í…œí”Œë¦¿ ìŠ¤íƒ€ì¼ ë°˜ì˜)
    c = canvas.Canvas(output_path, pagesize=A4)
    # ... í…œí”Œë¦¿ ìŠ¤íƒ€ì¼ì„ ë°˜ì˜í•˜ì—¬ PDF ê·¸ë¦¬ê¸° ...
    c.save()
    
    wb.close()
    return output_path
```

### í•´ê²° ë°©ì•ˆ 3: ì—‘ì…€ íŒŒì¼ ì œê³µ + PDFëŠ” ê¸°ë³¸ ë””ìì¸ (ì„ì‹œ)

PDFëŠ” ê¸°ë³¸ ë””ìì¸ì„ ì‚¬ìš©í•˜ë˜, ì—‘ì…€ íŒŒì¼ì€ í…œí”Œë¦¿ ë””ìì¸ìœ¼ë¡œ ì œê³µ:

**ì¥ì **:
- ì¦‰ì‹œ êµ¬í˜„ ê°€ëŠ¥
- í…œí”Œë¦¿ ë””ìì¸ì„ ì—‘ì…€ë¡œ í™•ì¸ ê°€ëŠ¥

**ë‹¨ì **:
- PDFëŠ” ì—¬ì „íˆ ê¸°ë³¸ ë””ìì¸
- ì‚¬ìš©ì ìš”êµ¬ì‚¬í•­ì„ ì™„ì „íˆ ì¶©ì¡±í•˜ì§€ ëª»í•¨

---

## âœ… ê¶Œì¥ í•´ê²° ë°©ì•ˆ: í•´ê²° ë°©ì•ˆ 1 (ì—‘ì…€â†’PDF ë³€í™˜)

### êµ¬í˜„ ë‹¨ê³„

#### Phase 1: ì—‘ì…€ ìƒì„± í›„ PDF ë³€í™˜ êµ¬í˜„

1. **xlsx2pdf ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© (1ìˆœìœ„)**
   ```bash
   pip install xlsx2pdf
   ```
   
   **ì¥ì **: í”Œë«í¼ ë…ë¦½ì , Python ë„¤ì´í‹°ë¸Œ
   **ë‹¨ì **: ìŠ¤íƒ€ì¼ ì¼ë¶€ ì†ì‹¤ ê°€ëŠ¥

2. **LibreOffice ì‚¬ìš© (2ìˆœìœ„)**
   - ì‹œìŠ¤í…œì— LibreOffice ì„¤ì¹˜ í•„ìš”
   - ëª…ë ¹ì¤„ ì¸í„°í˜ì´ìŠ¤ ì‚¬ìš©
   - ìŠ¤íƒ€ì¼ ì™„ë²½ ìœ ì§€

3. **Windows COM ê°ì²´ (Windows ì „ìš©)**
   - Windows í™˜ê²½ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥
   - ìŠ¤íƒ€ì¼ ì™„ë²½ ìœ ì§€

#### Phase 2: ì½”ë“œ ìˆ˜ì •

**íŒŒì¼**: `payroll_generator/templates/designs/template_design.py`

```python
def generate_pdf(self, payroll_data, employee_data, output_path, period):
    """í…œí”Œë¦¿ ì—‘ì…€ íŒŒì¼ì„ ìƒì„±í•œ í›„ PDFë¡œ ë³€í™˜"""
    import tempfile
    import os
    
    # 1. ì„ì‹œ ì—‘ì…€ íŒŒì¼ ìƒì„±
    with tempfile.NamedTemporaryFile(suffix='.xlsx', delete=False) as tmp:
        temp_excel_path = tmp.name
    
    try:
        # 2. í…œí”Œë¦¿ ê¸°ë°˜ ì—‘ì…€ ìƒì„±
        self.generate_excel(payroll_data, employee_data, temp_excel_path, period)
        
        # 3. ì—‘ì…€ì„ PDFë¡œ ë³€í™˜
        # ì˜µì…˜ 1: xlsx2pdf ì‚¬ìš©
        try:
            from xlsx2pdf import convert_xlsx_to_pdf
            convert_xlsx_to_pdf(temp_excel_path, output_path)
            logger.info(f"í…œí”Œë¦¿ ê¸°ë°˜ PDF ìƒì„± ì™„ë£Œ (xlsx2pdf): {output_path}")
            return output_path
        except ImportError:
            logger.debug("xlsx2pdfë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        except Exception as e:
            logger.warning(f"xlsx2pdf ë³€í™˜ ì‹¤íŒ¨: {e}")
        
        # ì˜µì…˜ 2: LibreOffice ì‚¬ìš©
        try:
            import subprocess
            output_dir = os.path.dirname(output_path)
            subprocess.run([
                'libreoffice', '--headless', '--convert-to', 'pdf',
                '--outdir', output_dir,
                temp_excel_path
            ], check=True, capture_output=True)
            
            # ì¶œë ¥ íŒŒì¼ëª… í™•ì¸ ë° ì´ë™
            pdf_name = os.path.basename(temp_excel_path).replace('.xlsx', '.pdf')
            pdf_path = os.path.join(output_dir, pdf_name)
            if os.path.exists(pdf_path) and pdf_path != output_path:
                os.rename(pdf_path, output_path)
            logger.info(f"í…œí”Œë¦¿ ê¸°ë°˜ PDF ìƒì„± ì™„ë£Œ (LibreOffice): {output_path}")
            return output_path
        except (subprocess.CalledProcessError, FileNotFoundError) as e:
            logger.debug(f"LibreOfficeë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {e}")
        except Exception as e:
            logger.warning(f"LibreOffice ë³€í™˜ ì‹¤íŒ¨: {e}")
        
        # í´ë°±: ì—‘ì…€ íŒŒì¼ì„ ê·¸ëŒ€ë¡œ ì œê³µí•˜ê±°ë‚˜ ê¸°ë³¸ PDF ìƒì„±
        logger.warning("ì—‘ì…€â†’PDF ìë™ ë³€í™˜ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.")
        logger.warning(f"í…œí”Œë¦¿ ì—‘ì…€ íŒŒì¼: {temp_excel_path}")
        raise NotImplementedError(
            "ì—‘ì…€â†’PDF ìë™ ë³€í™˜ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. "
            "xlsx2pdf ë˜ëŠ” LibreOfficeë¥¼ ì„¤ì¹˜í•˜ì„¸ìš”."
        )
        
    finally:
        # ì„ì‹œ ì—‘ì…€ íŒŒì¼ì€ ìœ ì§€ (ë””ë²„ê¹…ìš©)
        # í•„ìš”ì‹œ ì‚­ì œ: os.unlink(temp_excel_path)
        pass
```

---

## ğŸ”§ ì¦‰ì‹œ ì ìš© ê°€ëŠ¥í•œ ì„ì‹œ í•´ê²°ì±…

PDF ìƒì„±ì´ ë³µì¡í•˜ë¯€ë¡œ, ìš°ì„  ì—‘ì…€ íŒŒì¼ì´ ì˜¬ë°”ë¥´ê²Œ ìƒì„±ë˜ëŠ”ì§€ í™•ì¸:

### 1. ì—‘ì…€ ìƒì„± í…ŒìŠ¤íŠ¸

```bash
python scripts/test_template_generation.py
```

ìƒì„±ëœ ì—‘ì…€ íŒŒì¼ì„ ì—´ì–´ì„œ í…œí”Œë¦¿ ë””ìì¸ì´ ì ìš©ë˜ì—ˆëŠ”ì§€ í™•ì¸

### 2. PDFëŠ” ì—‘ì…€ íŒŒì¼ ì œê³µ

PDF ëŒ€ì‹  ì—‘ì…€ íŒŒì¼ì„ ì œê³µí•˜ë„ë¡ UI ìˆ˜ì • (ì„ì‹œ)

---

## ğŸ“Š ë¬¸ì œ ìš”ì•½

| í•­ëª© | í˜„ì¬ ìƒíƒœ | ê¸°ëŒ€ ìƒíƒœ |
|------|----------|----------|
| ì—‘ì…€ ìƒì„± | âœ… í…œí”Œë¦¿ ë””ìì¸ ì‚¬ìš© ê°€ëŠ¥ | âœ… í…œí”Œë¦¿ ë””ìì¸ ì‚¬ìš© |
| PDF ìƒì„± | âŒ í•­ìƒ ê¸°ë³¸ ë””ìì¸ | âœ… í…œí”Œë¦¿ ë””ìì¸ ì‚¬ìš© |
| ì›ì¸ | `generate_pdf()`ì—ì„œ `design_name=None` í•˜ë“œì½”ë”© | í…œí”Œë¦¿ ì—‘ì…€â†’PDF ë³€í™˜ í•„ìš” |

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

### ì¦‰ì‹œ í•´ê²° (ì„ì‹œ)
1. PDF ìƒì„± ì‹œ ì—‘ì…€ íŒŒì¼ë„ í•¨ê»˜ ì œê³µ
2. ì‚¬ìš©ìì—ê²Œ ì—‘ì…€ íŒŒì¼ì„ PDFë¡œ ë³€í™˜í•˜ë„ë¡ ì•ˆë‚´

### ê·¼ë³¸ì  í•´ê²°
1. `xlsx2pdf` ë˜ëŠ” `LibreOffice` ì„¤ì¹˜
2. `TemplateDesign.generate_pdf()` ë©”ì„œë“œ ìˆ˜ì •
3. ì—‘ì…€â†’PDF ë³€í™˜ ë¡œì§ êµ¬í˜„
4. í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

---

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `TemplateDesign.generate_pdf()` ë©”ì„œë“œ ìˆ˜ì •
- [ ] ì—‘ì…€â†’PDF ë³€í™˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ íƒ ë° ì„¤ì¹˜
- [ ] ë³€í™˜ ë¡œì§ êµ¬í˜„
- [ ] ì—ëŸ¬ ì²˜ë¦¬ ë° í´ë°± ì „ëµ êµ¬í˜„
- [ ] í…ŒìŠ¤íŠ¸ ë° ê²€ì¦
- [ ] ë¬¸ì„œ ì—…ë°ì´íŠ¸

---

**ì‘ì„±ì**: AI Assistant  
**ì‘ì„±ì¼**: 2025-12-12  
**ìƒíƒœ**: ğŸ” ì›ì¸ ë¶„ì„ ì™„ë£Œ, í•´ê²° ë°©ì•ˆ ì œì‹œ
