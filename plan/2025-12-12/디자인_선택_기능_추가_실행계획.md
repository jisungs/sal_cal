# 🎨 급여명세서 디자인 선택 기능 추가 실행계획 (v2.0 - 실현 가능 버전)

**작성일**: 2025-12-12  
**버전**: 2.0 (프로 개발자 관점 개선)  
**목표**: 사용자가 두 가지 급여명세서 디자인 중 선택하여 출력할 수 있는 기능 추가  
**원칙**: 기존 기능에 영향을 주지 않고 기능 업그레이드, 실현 가능한 기술 스택 사용

> **⚠️ 중요**: 이 문서는 v2.0으로 업그레이드되었습니다. 엑셀 템플릿 기반 방법의 복잡성을 제거하고, 설정 파일 기반 + reportlab 직접 구현 방식으로 변경되었습니다.

---

## 📋 프로젝트 개요

### 목표
사용자가 제공된 두 가지 급여명세서 디자인 샘플(`급여명세서_sample.png`, `급여명세서_sample2.png`) 중 하나를 선택하여 급여명세서를 출력할 수 있도록 기능 추가

### 제약 사항
- ✅ **기존 기능 보존**: 현재 동작하는 모든 기능은 그대로 유지
- ✅ **하위 호환성**: 디자인 선택 없이도 기존 방식으로 동작 가능
- ✅ **점진적 개선**: 기존 코드를 최소한으로 수정하여 확장

---

## 📊 현재 상태 분석

### 현재 구현된 기능

#### 1. PDF 생성 (`payroll_generator/pdf_generator.py`)
- **클래스**: `PDFGenerator`
- **메인 메서드**: `generate_payslip()`
- **현재 방식**: 
  - `use_template` 파라미터로 템플릿/코드 기반 선택
  - `_generate_payslip_code_based()`: 코드 기반 PDF 생성 (하드코딩된 레이아웃)
  - `generate_payslip_from_template()`: 엑셀 템플릿 기반 생성

#### 2. 엑셀 생성 (`payroll_generator/excel_handler.py`)
- **클래스**: `ExcelHandler`
- **메인 메서드**: `write_payroll()`
- **현재 방식**:
  - `use_template` 파라미터로 템플릿/코드 기반 선택
  - `_write_payroll_from_template()`: 템플릿 기반 엑셀 생성
  - `_write_payroll_code_based()`: 코드 기반 엑셀 생성

#### 3. 웹 인터페이스 (`app/routes/payroll.py`, `app/routes/main.py`)
- 파일 업로드 및 처리
- 결과 확인 및 다운로드
- 웹 직접 입력 기능

#### 4. 데스크톱 인터페이스 (`main.py`)
- GUI 기반 파일 선택 및 처리
- 대시보드 기능
- 출력 형식 선택 (엑셀/PDF/둘 다)

### 현재 호출 구조
```
사용자 입력
  ↓
[웹] app/routes/payroll.py 또는 app/routes/main.py
[데스크톱] main.py
  ↓
payroll_generator/calculator.py (급여 계산)
  ↓
payroll_generator/excel_handler.py (엑셀 생성)
payroll_generator/pdf_generator.py (PDF 생성)
```

---

## 🎯 구현 목표

### 핵심 기능
1. **디자인 템플릿 시스템 구축**
   - 디자인 1: `급여명세서_sample.png` 기반
   - 디자인 2: `급여명세서_sample2.png` 기반
   - 각 디자인별 PDF/엑셀 생성 로직 구현

2. **사용자 인터페이스 개선**
   - 웹: 디자인 선택 드롭다운/라디오 버튼 추가
   - 데스크톱: 디자인 선택 옵션 추가

3. **기존 기능 호환성 유지**
   - 디자인 선택 없으면 기본 디자인 사용
   - 기존 API 호출 방식 그대로 동작

---

## 🔍 현재 기술 스택 분석

### 사용 중인 라이브러리
- **PDF 생성**: `reportlab` (이미 사용 중) ✅
- **엑셀 처리**: `openpyxl` (이미 사용 중) ✅
- **데이터 처리**: `pandas` (이미 사용 중) ✅

### 현재 PDF 생성 방식
- `reportlab`의 `canvas.Canvas`를 사용한 코드 기반 생성
- 레이아웃, 색상, 폰트 등이 코드에 하드코딩됨
- 한글 폰트 지원 (NanumGothic)

### 제약 사항 및 해결 방안

#### ❌ 문제: 엑셀→PDF 변환의 복잡성
- **문제점**: 
  - 플랫폼 의존성 (Windows: win32com, macOS/Linux: LibreOffice)
  - 추가 라이브러리 설치 필요
  - 배포 환경에서 외부 프로그램 의존성

#### ✅ 해결: reportlab 직접 구현 (권장)
- **장점**:
  - 현재 사용 중인 라이브러리만 사용
  - 플랫폼 독립적
  - 완전한 제어 가능
  - 배포 시 추가 의존성 없음

---

## 🎯 실현 가능한 구현 전략

### 전략: Strategy 패턴 + 설정 기반 디자인 관리

#### 1. 디자인 스펙을 설정 파일로 관리
- YAML 또는 JSON으로 디자인 스펙 정의
- 색상, 폰트, 레이아웃 위치 등을 설정 파일로 관리
- 코드 수정 없이 디자인 수정 가능

#### 2. reportlab으로 직접 구현
- 엑셀 템플릿 대신 reportlab으로 직접 구현
- 설정 파일의 스펙을 읽어서 PDF 생성
- 엑셀도 동일한 설정으로 생성

#### 3. 점진적 구현
- Phase 1: 기본 구조 구축
- Phase 2: 디자인 1 구현
- Phase 3: 디자인 2 구현
- 각 단계별로 테스트 및 검증

---

## 📐 아키텍처 설계 (실현 가능 버전)

### 1. 디렉토리 구조

```
payroll_generator/
├── templates/
│   ├── designs/
│   │   ├── __init__.py
│   │   ├── base_design.py          # 기본 디자인 클래스
│   │   ├── design_1.py             # 디자인 1 구현
│   │   ├── design_2.py             # 디자인 2 구현
│   │   ├── design_factory.py       # 팩토리 클래스
│   │   └── configs/                # 디자인 설정 파일
│   │       ├── design_1.yaml       # 디자인 1 스펙
│   │       └── design_2.yaml       # 디자인 2 스펙
│   └── payroll_template.xlsx       # 기존 템플릿 (유지)
```

### 2. 설정 기반 디자인 스펙 구조

#### design_1.yaml 예시
```yaml
design_name: "디자인 1"
description: "급여명세서_sample.png 기반"

# 페이지 설정
page:
  size: "A4"
  margins:
    top: 30
    bottom: 20
    left: 30
    right: 30
    unit: "mm"

# 폰트 설정
fonts:
  title:
    name: "NanumGothic"
    size: 22
    bold: true
    color: [0, 0, 0]
  header:
    name: "NanumGothic"
    size: 12
    bold: true
    color: [1, 1, 1]  # 흰색
  body:
    name: "NanumGothic"
    size: 10
    bold: false
    color: [0, 0, 0]

# 색상 설정 (RGB 0-1 범위)
colors:
  title_bg: [0.95, 0.95, 0.95]  # 연한 회색
  header_bg: [0.2, 0.4, 0.8]    # 파란색
  total_bg: [0.9, 0.95, 1.0]     # 연한 파란색
  border: [0.7, 0.7, 0.7]        # 회색 테두리

# 레이아웃 설정 (mm 단위, 상단에서)
layout:
  title:
    y: 30
    height: 20
    align: "center"
  employee_info:
    y: 70
    height: 50
    fields:
      - name: "이름"
        y_offset: 0
      - name: "주민번호"
        y_offset: -12
      - name: "입사일"
        y_offset: -24
  payment_section:
    y: 130
    header_height: 8
    row_height: 10
    fields:
      - name: "기본급"
        y_offset: 0
      - name: "연장근무수당"
        y_offset: -10
      - name: "상여금"
        y_offset: -20
      - name: "총지급액"
        y_offset: -30
        is_total: true
  # ... 나머지 섹션
```

### 3. 클래스 구조 (실제 구현 가능)

```python
# base_design.py
from abc import ABC, abstractmethod
import yaml
from pathlib import Path

class BaseDesign(ABC):
    """디자인 템플릿 기본 클래스"""
    
    def __init__(self, config_path):
        """설정 파일 로드"""
        self.config = self._load_config(config_path)
        self.font_name = 'NanumGothic'  # 기본 폰트
    
    def _load_config(self, config_path):
        """YAML 설정 파일 로드"""
        with open(config_path, 'r', encoding='utf-8') as f:
            return yaml.safe_load(f)
    
    @abstractmethod
    def generate_pdf(self, payroll_data, employee_data, output_path, period):
        """PDF 생성"""
        pass
    
    @abstractmethod
    def generate_excel(self, payroll_data, employee_data, output_path, period):
        """엑셀 생성"""
        pass
    
    def format_currency(self, amount):
        """통화 포맷팅"""
        return f"{amount:,}원"
    
    def mask_resident_number(self, rrn):
        """주민번호 마스킹"""
        from ..utils import mask_resident_number as mask_rrn
        return mask_rrn(rrn)

# design_1.py
from reportlab.lib.pagesizes import A4
from reportlab.pdfgen import canvas
from reportlab.lib.units import mm
from .base_design import BaseDesign

class Design1(BaseDesign):
    """디자인 1: 급여명세서_sample.png 기반"""
    
    def __init__(self):
        config_path = Path(__file__).parent / 'configs' / 'design_1.yaml'
        super().__init__(config_path)
    
    def generate_pdf(self, payroll_data, employee_data, output_path, period):
        """디자인 1 스타일로 PDF 생성"""
        # 설정에서 레이아웃 정보 읽기
        # reportlab으로 구현
        # ...
    
    def generate_excel(self, payroll_data, employee_data, output_path, period):
        """디자인 1 스타일로 엑셀 생성"""
        # 설정에서 스타일 정보 읽기
        # openpyxl로 구현
        # ...

# design_factory.py
from .design_1 import Design1
from .design_2 import Design2

class DesignFactory:
    """디자인 팩토리 클래스"""
    
    _designs = {
        'default': None,
        'design_1': Design1,
        'design_2': Design2,
    }
    
    @classmethod
    def get_design(cls, design_name='default'):
        """디자인 인스턴스 반환"""
        if design_name == 'default' or design_name is None:
            return None
        
        design_class = cls._designs.get(design_name)
        if design_class:
            return design_class()
        return None  # 폴백
```

---

## 🔧 구현 단계

### Phase 0: 준비 작업 (1-2시간)

#### 0.0 Git 브랜치 설정
- [ ] 현재 변경사항 커밋
  ```bash
  git add plan/2025-12-12/ sample/
  git commit -m "docs: 디자인 선택 기능 실행계획 추가"
  ```
- [ ] develop 브랜치 생성 및 전환
  ```bash
  git checkout -b develop
  git push -u origin develop
  ```
- [ ] 기능 브랜치 생성
  ```bash
  git checkout -b feature/design-selection
  git push -u origin feature/design-selection
  ```
- [ ] Phase 0 브랜치 생성
  ```bash
  git checkout -b feature/design-selection-phase-0
  ```

#### 0.1 샘플 이미지 분석 및 스펙 정의
- [ ] `급여명세서_sample.png` 상세 분석
  - 레이아웃 구조 파악
  - 색상 코드 추출 (RGB 값)
  - 폰트 크기 측정
  - 간격 및 여백 측정
- [ ] `급여명세서_sample2.png` 상세 분석
  - 동일한 방식으로 분석
- [ ] 디자인 스펙 문서 작성
  - 각 디자인의 레이아웃 구조도
  - 색상 팔레트
  - 폰트 스펙
  - 간격 및 여백 값

#### 0.2 설정 파일 생성
- [ ] `configs/design_1.yaml` 생성
  - 샘플 이미지 분석 결과를 YAML 형식으로 작성
  - 레이아웃 위치, 색상, 폰트 등 모든 스펙 정의
- [ ] `configs/design_2.yaml` 생성
  - 동일한 방식으로 작성

#### 0.3 Phase 0 커밋 및 병합
- [ ] 변경사항 커밋
  ```bash
  git add payroll_generator/templates/designs/configs/
  git commit -m "feat(design): Phase 0 - 디자인 설정 파일 작성"
  git push -u origin feature/design-selection-phase-0
  ```
- [ ] feature/design-selection에 병합
  ```bash
  git checkout feature/design-selection
  git merge feature/design-selection-phase-0 --no-ff -m "merge: Phase 0 완료"
  git push origin feature/design-selection
  ```

**산출물**:
- `design_1_spec.md`: 디자인 1 상세 스펙 문서
- `design_2_spec.md`: 디자인 2 상세 스펙 문서
- `configs/design_1.yaml`: 디자인 1 설정 파일
- `configs/design_2.yaml`: 디자인 2 설정 파일

---

### Phase 1: 기본 구조 구축 (2-3시간)

#### 1.0 Git 브랜치 설정
- [ ] Phase 1 브랜치 생성
  ```bash
  git checkout feature/design-selection
  git checkout -b feature/design-selection-phase-1
  ```

#### 1.1 디렉토리 구조 생성
```bash
mkdir -p payroll_generator/templates/designs/configs
touch payroll_generator/templates/designs/__init__.py
```

#### 1.2 기본 클래스 구현
- [ ] `base_design.py` 생성
  - `BaseDesign` 추상 클래스 구현
  - 설정 파일 로드 기능 (`_load_config()`)
  - 공통 유틸리티 메서드 (`format_currency()`, `mask_resident_number()`)
  - 추상 메서드 정의 (`generate_pdf()`, `generate_excel()`)
  - 설정 값 가져오기 메서드 (`get_config_value()`)

#### 1.3 디자인 팩토리 구현
- [ ] `design_factory.py` 생성
  - `DesignFactory` 클래스 구현
  - 디자인 등록 및 조회 기능
  - 싱글톤 패턴으로 인스턴스 재사용
  - 기본값 처리 로직 (None 반환)

#### 1.4 의존성 추가
- [ ] `requirements.txt`에 `PyYAML` 추가
  ```bash
  pip install PyYAML
  ```

#### 1.5 Phase 1 커밋 및 병합
- [ ] 변경사항 커밋
  ```bash
  git add payroll_generator/templates/designs/
  git add requirements.txt
  git commit -m "feat(design): Phase 1 - 디자인 시스템 기본 구조 구축"
  git push -u origin feature/design-selection-phase-1
  ```
- [ ] 테스트 실행 (테스트 파일이 있다면)
  ```bash
  python -m pytest tests/test_base_design.py -v
  ```
- [ ] feature/design-selection에 병합
  ```bash
  git checkout feature/design-selection
  git merge feature/design-selection-phase-1 --no-ff -m "merge: Phase 1 완료"
  git push origin feature/design-selection
  ```

**예상 소요 시간**: 2-3시간

---

### Phase 2: 디자인 1 구현 (4-6시간)

#### 2.0 Git 브랜치 설정
- [ ] Phase 2 브랜치 생성
  ```bash
  git checkout feature/design-selection
  git checkout -b feature/design-selection-phase-2
  ```

#### 2.1 설정 파일 작성
- [ ] `configs/design_1.yaml` 작성
  - 샘플 이미지 분석 결과를 YAML 형식으로 작성
  - 모든 레이아웃, 색상, 폰트 정보 포함
  - 상세한 레이아웃 구조는 위 "설정 기반 디자인 스펙 구조" 참조

#### 2.2 디자인 1 클래스 구현
- [ ] `design_1.py` 생성
- [ ] `Design1` 클래스 구현
  - `BaseDesign` 상속
  - 설정 파일 로드 (`design_1.yaml`)
  - `generate_pdf()` 메서드 구현
    - reportlab을 사용한 레이아웃 구현
    - 설정 파일의 스펙을 읽어서 동적으로 생성
    - 공통 메서드 활용 (`_draw_title()`, `_draw_employee_info()` 등)
  - `generate_excel()` 메서드 구현
    - openpyxl을 사용한 레이아웃 구현
    - 설정 파일의 스펙을 읽어서 동적으로 생성

**구현 전략**:
1. **공통 레이아웃 메서드 추출**
   - `_draw_title()`: 제목 영역
   - `_draw_employee_info()`: 직원 정보 영역
   - `_draw_payment_section()`: 지급 항목 영역
   - `_draw_deduction_section()`: 공제 항목 영역
   - `_draw_net_pay()`: 실수령액 영역

2. **설정 기반 렌더링**
   - 설정 파일의 좌표, 색상, 폰트 정보를 읽어서 동적으로 그리기
   - 하드코딩 최소화

**코드 구조 예시** (상세 코드는 v2.0 문서 참조):
```python
class Design1(BaseDesign):
    def __init__(self):
        config_path = self._find_config_path('design_1.yaml')
        super().__init__(config_path)
    
    def generate_pdf(self, payroll_data, employee_data, output_path, period):
        """설정 파일 기반 PDF 생성"""
        # 설정에서 레이아웃 정보 읽기
        # reportlab으로 구현
        # ...
    
    def generate_excel(self, payroll_data, employee_data, output_path, period):
        """설정 파일 기반 엑셀 생성"""
        # 설정에서 스타일 정보 읽기
        # openpyxl로 구현
        # ...
```

#### 2.3 단위 테스트 작성
- [ ] `tests/test_design_1.py` 생성
  - PDF 생성 테스트
  - 엑셀 생성 테스트
  - 설정 파일 로드 테스트

#### 2.4 Phase 2 커밋 및 병합
- [ ] 변경사항 커밋
  ```bash
  git add payroll_generator/templates/designs/design_1.py
  git add tests/test_design_1.py
  git commit -m "feat(design): Phase 2 - 디자인 1 구현 완료"
  git push -u origin feature/design-selection-phase-2
  ```
- [ ] 테스트 실행
  ```bash
  python -m pytest tests/test_design_1.py -v
  ```
- [ ] feature/design-selection에 병합
  ```bash
  git checkout feature/design-selection
  git merge feature/design-selection-phase-2 --no-ff -m "merge: Phase 2 완료"
  git push origin feature/design-selection
  ```

**예상 소요 시간**: 4-6시간

---

### Phase 3: 디자인 2 구현 (3-4시간)

#### 3.0 Git 브랜치 설정
- [ ] Phase 3 브랜치 생성
  ```bash
  git checkout feature/design-selection
  git checkout -b feature/design-selection-phase-3
  ```

#### 3.1 설정 파일 작성
- [ ] `configs/design_2.yaml` 작성
  - 디자인 2 분석 결과를 YAML 형식으로 작성
  - 디자인 1과의 차이점 반영

#### 3.2 디자인 2 클래스 구현
- [ ] `design_2.py` 생성
- [ ] `Design2` 클래스 구현
  - `Design1`의 코드를 복사하여 생성
  - 설정 파일만 `design_2.yaml`로 변경
  - 공통 로직은 `BaseDesign`에 있으므로 중복 최소화

**구현 전략**:
- `Design1`의 코드를 복사하여 `Design2` 생성
- 설정 파일만 `design_2.yaml`로 변경
- 공통 로직은 `BaseDesign`에 있으므로 중복 최소화

#### 3.3 단위 테스트 작성
- [ ] `tests/test_design_2.py` 생성

#### 3.4 Phase 3 커밋 및 병합
- [ ] 변경사항 커밋 및 병합 (Phase 2와 동일한 패턴)

**예상 소요 시간**: 3-4시간 (Design1 기반으로 빠르게 구현 가능)

---

### Phase 4: 기존 코드 통합 (최소 수정)

#### 4.1 PDFGenerator 수정
- [ ] `pdf_generator.py` 수정
  - `generate_payslip()` 메서드에 `design_name` 파라미터 추가 (기본값: None)
  - 디자인 선택 시 `DesignFactory`를 통해 디자인 인스턴스 가져오기
  - 디자인이 있으면 디자인 클래스 사용, 없으면 기존 방식 사용

```python
def generate_payslip(self, payroll_data, employee_data, output_path, period, 
                     use_template=True, design_name=None):
    """급여명세서 PDF 생성
    
    Args:
        ...
        design_name (str): 디자인 이름 ('design_1', 'design_2', None)
    """
    if design_name:
        design = DesignFactory.get_design(design_name)
        if design:
            return design.generate_pdf(payroll_data, employee_data, output_path, period)
    
    # 기존 로직 (변경 없음)
    if use_template:
        ...
```

#### 4.2 ExcelHandler 수정
- [ ] `excel_handler.py` 수정
  - `write_payroll()` 메서드에 `design_name` 파라미터 추가 (기본값: None)
  - 디자인 선택 시 `DesignFactory`를 통해 디자인 인스턴스 가져오기
  - 디자인이 있으면 디자인 클래스 사용, 없으면 기존 방식 사용

```python
def write_payroll(self, payroll_data, output_path, employee_data, 
                 period=None, use_template=True, design_name=None):
    """급여명세서 엑셀 생성
    
    Args:
        ...
        design_name (str): 디자인 이름 ('design_1', 'design_2', None)
    """
    if design_name:
        design = DesignFactory.get_design(design_name)
        if design:
            return design.generate_excel(payroll_data, employee_data, output_path, period)
    
    # 기존 로직 (변경 없음)
    if use_template:
        ...
```

**예상 소요 시간**: 1-2시간

---

### Phase 5: 웹 인터페이스 개선

#### 5.1 폼 수정
- [ ] `app/forms/payroll_forms.py` 수정
  - 디자인 선택 필드 추가 (SelectField)
  - 선택 옵션: '기본', '디자인 1', '디자인 2'

#### 5.2 라우트 수정
- [ ] `app/routes/payroll.py` 수정
  - 폼에서 `design_name` 값 받기
  - `PDFGenerator.generate_payslip()` 호출 시 `design_name` 전달
  - `ExcelHandler.write_payroll()` 호출 시 `design_name` 전달

#### 5.3 템플릿 수정
- [ ] `web/templates/payroll/input_form.html` 수정
  - 디자인 선택 드롭다운/라디오 버튼 추가
  - 디자인 미리보기 이미지 표시 (선택사항)

- [ ] `web/templates/payroll/multiple_input.html` 수정
  - 디자인 선택 드롭다운/라디오 버튼 추가

**예상 소요 시간**: 2-3시간

---

### Phase 6: 데스크톱 인터페이스 개선

#### 6.1 GUI 수정
- [ ] `main.py` 수정
  - 디자인 선택 옵션 추가 (Combobox 또는 Radiobutton)
  - 출력 형식 선택 옵션과 함께 배치

#### 6.2 생성 로직 수정
- [ ] `generate_payroll()` 메서드 수정
  - 선택된 디자인 값 가져오기
  - `PDFGenerator.generate_payslip()` 호출 시 `design_name` 전달
  - `ExcelHandler.write_payroll()` 호출 시 `design_name` 전달

**예상 소요 시간**: 1-2시간

---

### Phase 7: 테스트 및 검증

#### 7.1 단위 테스트
- [ ] 디자인 팩토리 테스트
- [ ] 각 디자인 클래스 테스트
- [ ] 기존 기능 호환성 테스트

#### 7.2 통합 테스트
- [ ] 웹 인터페이스 테스트
  - 디자인 선택 없이 생성 (기본 동작 확인)
  - 디자인 1 선택하여 생성
  - 디자인 2 선택하여 생성

- [ ] 데스크톱 인터페이스 테스트
  - 디자인 선택 없이 생성 (기본 동작 확인)
  - 디자인 1 선택하여 생성
  - 디자인 2 선택하여 생성

#### 7.3 출력 파일 검증
- [ ] 각 디자인별 PDF 출력 확인
- [ ] 각 디자인별 엑셀 출력 확인
- [ ] 샘플 이미지와 비교 검증

#### 7.4 Phase 7 커밋 및 최종 병합
- [ ] 모든 테스트 통과 확인
- [ ] 변경사항 커밋 및 병합
- [ ] feature/design-selection → develop 병합
  ```bash
  git checkout develop
  git merge feature/design-selection --no-ff -m "merge: 디자인 선택 기능 완료"
  git push origin develop
  ```
- [ ] develop → master 병합 (모든 검증 완료 후)
  ```bash
  git checkout master
  git merge develop --no-ff -m "release: 디자인 선택 기능 v1.0"
  git tag -a v1.0 -m "디자인 선택 기능 추가"
  git push origin master --tags
  ```

**예상 소요 시간**: 3-4시간

---

## 📁 파일 구조 (최종)

```
salary_cal/
├── payroll_generator/
│   ├── templates/
│   │   ├── designs/
│   │   │   ├── __init__.py
│   │   │   ├── base_design.py          # 신규
│   │   │   ├── design_1.py             # 신규
│   │   │   ├── design_2.py             # 신규
│   │   │   └── design_factory.py       # 신규
│   │   └── payroll_template.xlsx        # 기존 (유지)
│   ├── pdf_generator.py                 # 수정 (design_name 파라미터 추가)
│   ├── excel_handler.py                 # 수정 (design_name 파라미터 추가)
│   └── ...
├── app/
│   ├── forms/
│   │   └── payroll_forms.py             # 수정 (디자인 선택 필드 추가)
│   ├── routes/
│   │   └── payroll.py                   # 수정 (design_name 전달)
│   └── ...
├── web/
│   └── templates/
│       └── payroll/
│           ├── input_form.html           # 수정 (디자인 선택 UI 추가)
│           └── multiple_input.html       # 수정 (디자인 선택 UI 추가)
├── main.py                               # 수정 (디자인 선택 UI 추가)
└── sample/
    ├── 급여명세서_sample.png             # 참고용
    └── 급여명세서_sample2.png            # 참고용
```

---

## 🔄 기존 기능 호환성 보장

### 호환성 전략

#### 1. 기본값 처리
- `design_name` 파라미터의 기본값은 `None`
- `None`이면 기존 로직 그대로 동작
- 기존 코드 수정 없이 동작 가능

#### 2. 점진적 적용
- 기존 API 호출은 그대로 동작
- 새로운 기능은 선택적으로 사용 가능
- 기존 사용자에게 영향 없음

#### 3. 폴백 메커니즘
- 디자인 클래스가 없거나 오류 발생 시 기존 방식으로 폴백
- 사용자 경험 저하 방지

---

## 🎯 핵심 개선 사항 (v1.0 → v2.0)

### 1. 엑셀→PDF 변환 제거
- **v1.0**: 엑셀 템플릿 → 엑셀 생성 → PDF 변환 (복잡, 플랫폼 의존)
- **v2.0**: 설정 파일 → reportlab 직접 구현 (단순, 플랫폼 독립)

### 2. 설정 기반 디자인 관리
- **v1.0**: 엑셀 템플릿 파일 의존
- **v2.0**: YAML 설정 파일로 디자인 스펙 관리 (코드 수정 없이 디자인 변경)

### 3. 코드 재사용성 향상
- **v1.0**: 각 디자인별로 독립적인 코드
- **v2.0**: 공통 로직을 `BaseDesign`에 추출, 설정만 다름

### 4. 테스트 가능성 향상
- **v1.0**: 엑셀 파일 의존으로 테스트 복잡
- **v2.0**: 설정 파일 기반으로 단위 테스트 용이

---

## 📝 구현 상세 사항

### 1. 설정 파일 구조 상세 (실제 구현 가능)

#### 1.1 템플릿 파일 위치
- 디자인 1: `payroll_generator/templates/designs/design_1_template.xlsx`
- 디자인 2: `payroll_generator/templates/designs/design_2_template.xlsx`

#### 1.2 템플릿 구조 요구사항

**필수 포함 항목**:

1. **제목 영역**
   - "급여명세서" 제목
   - 지급기간 표시 (예: `지급기간: {PERIOD}` 또는 특정 셀)

2. **직원 정보 영역**
   - 성명: `{이름}` 또는 특정 셀 (예: B4)
   - 주민번호: `{주민번호}` 또는 특정 셀 (예: B5) - 마스킹 처리됨
   - 입사일: `{입사일}` 또는 특정 셀 (예: B6)

3. **지급 항목 영역**
   - 기본급: `{기본급}` 또는 특정 셀
   - 연장근무수당: `{연장근무수당}` 또는 특정 셀
   - 상여금: `{상여금}` 또는 특정 셀
   - 총 지급액: `{총지급액}` 또는 특정 셀

4. **공제 항목 영역**
   - 국민연금: `{국민연금}` 또는 특정 셀
   - 건강보험: `{건강보험}` 또는 특정 셀
   - 장기요양: `{장기요양}` 또는 특정 셀
   - 고용보험: `{고용보험}` 또는 특정 셀
   - 소득세: `{소득세}` 또는 특정 셀
   - 지방소득세: `{지방소득세}` 또는 특정 셀
   - 총 공제액: `{총공제액}` 또는 특정 셀

5. **실수령액 영역**
   - 실수령액: `{실수령액}` 또는 특정 셀

#### 1.3 템플릿 제작 시 주의사항

**플레이스홀더 방식 (선택사항)**:
- 셀에 `{이름}`, `{기본급}` 등의 플레이스홀더를 직접 입력
- 코드에서 플레이스홀더를 찾아 교체

**셀 위치 지정 방식 (권장)**:
- 특정 셀 위치에 데이터를 채우도록 약속
- 예: B4에 이름, B9에 기본급 등
- 더 정확하고 유연함

**스타일 적용**:
- 샘플 이미지와 동일한 색상, 폰트, 테두리 적용
- 셀 병합, 정렬, 숫자 포맷 설정
- 행 높이, 열 너비 조정

#### 1.4 템플릿 예시 구조

```
셀 위치    | 내용                    | 데이터 소스
-----------|------------------------|------------------
A1         | 급여명세서              | 고정
A2         | 지급기간: 2025-01       | period 파라미터
A4         | 성명:                   | 고정
B4         | 홍길동                  | employee_data['이름']
A5         | 주민번호:               | 고정
B5         | 123456-1*****           | employee_data['주민번호'] (마스킹)
A7         | 지급 항목               | 고정
B8         | 기본급                  | 고정
C8         | 3,000,000               | payroll_data['기본급']
B9         | 연장근무수당            | 고정
C9         | 250,000                 | payroll_data['연장근무수당']
...
```

### 2. 엑셀→PDF 변환 방법

#### 2.1 플랫폼별 변환 도구

**Windows**:
```python
# win32com 사용 (Excel 설치 필요)
import win32com.client

def excel_to_pdf_windows(excel_path, pdf_path):
    excel = win32com.client.Dispatch("Excel.Application")
    excel.Visible = False
    wb = excel.Workbooks.Open(excel_path)
    wb.ExportAsFixedFormat(0, pdf_path)  # 0 = PDF
    wb.Close()
    excel.Quit()
```

**macOS/Linux**:
```python
# LibreOffice 사용 (LibreOffice 설치 필요)
import subprocess

def excel_to_pdf_libreoffice(excel_path, pdf_path):
    output_dir = os.path.dirname(pdf_path)
    subprocess.run([
        'libreoffice', '--headless', '--convert-to', 'pdf',
        '--outdir', output_dir, excel_path
    ])
```

**크로스 플랫폼 대안**:
```python
# xlsx2pdf 라이브러리 (제한적)
from xlsx2pdf import xlsx2pdf

def excel_to_pdf_xlsx2pdf(excel_path, pdf_path):
    xlsx2pdf(excel_path, pdf_path)
```

#### 2.2 폴백 전략

엑셀→PDF 변환이 불가능한 경우:
1. 엑셀 파일 생성 (항상 가능)
2. reportlab으로 레이아웃 재현하여 PDF 생성
3. 또는 엑셀 파일만 제공하고 PDF는 기본 디자인 사용

### 3. 디자인 스펙 정의 (코드 기반 대안)

코드 기반으로 구현하는 경우:

```python
# design_1.py 예시
class Design1(BaseDesign):
    """디자인 1: 급여명세서_sample.png 기반"""
    
    # 레이아웃 설정
    PAGE_SIZE = A4
    MARGIN_TOP = 20*mm
    MARGIN_BOTTOM = 20*mm
    MARGIN_LEFT = 20*mm
    MARGIN_RIGHT = 20*mm
    
    # 폰트 설정
    TITLE_FONT = ('NanumGothic', 20, 'bold')
    HEADER_FONT = ('NanumGothic', 12, 'bold')
    BODY_FONT = ('NanumGothic', 10, 'normal')
    
    # 색상 설정 (샘플 이미지 분석 결과)
    HEADER_BG_COLOR = '#E3F2FD'
    TOTAL_BG_COLOR = '#BBDEFB'
    BORDER_COLOR = '#000000'
    
    # 간격 설정
    ROW_HEIGHT = 15*mm
    COLUMN_SPACING = 5*mm
    
    def generate_pdf(self, payroll_data, employee_data, output_path, period):
        """디자인 1 스타일로 PDF 생성"""
        # reportlab으로 레이아웃 구현
        # 샘플 이미지 분석 결과를 코드로 재현
        # ...
```

### 2. 공통 유틸리티 함수

`base_design.py`에 공통 함수 정의:

```python
class BaseDesign(ABC):
    """디자인 템플릿 기본 클래스"""
    
    def format_currency(self, amount):
        """통화 포맷팅"""
        return f"{amount:,}원"
    
    def mask_resident_number(self, rrn):
        """주민번호 마스킹"""
        # 기존 utils 함수 사용
        pass
    
    def get_period_display(self, period):
        """기간 표시 형식 변환"""
        # "2025-01" -> "2025년 1월"
        pass
```

### 3. 에러 처리

```python
class DesignFactory:
    @classmethod
    def get_design(cls, design_name='default'):
        """디자인 인스턴스 반환"""
        try:
            if design_name == 'default' or design_name is None:
                return None
            
            design_class = cls.DESIGNS.get(design_name)
            if not design_class:
                logger.warning(f"알 수 없는 디자인: {design_name}, 기본 방식 사용")
                return None
            
            return design_class()
        except Exception as e:
            logger.error(f"디자인 생성 실패: {e}, 기본 방식 사용")
            return None
```

---

## 🧪 테스트 계획

### 단위 테스트

#### 1. 디자인 팩토리 테스트
```python
def test_design_factory_default():
    """기본값 테스트"""
    design = DesignFactory.get_design()
    assert design is None

def test_design_factory_design_1():
    """디자인 1 테스트"""
    design = DesignFactory.get_design('design_1')
    assert isinstance(design, Design1)

def test_design_factory_invalid():
    """잘못된 디자인명 테스트"""
    design = DesignFactory.get_design('invalid')
    assert design is None
```

#### 2. 디자인 클래스 테스트
```python
def test_design_1_pdf_generation():
    """디자인 1 PDF 생성 테스트"""
    design = Design1()
    # 테스트 데이터 생성
    payroll_data = {...}
    employee_data = {...}
    # PDF 생성 및 검증
    design.generate_pdf(payroll_data, employee_data, 'test.pdf', '2025-01')
    assert os.path.exists('test.pdf')
```

### 통합 테스트

#### 1. 웹 인터페이스 테스트
- 디자인 선택 없이 생성 → 기본 방식 동작 확인
- 디자인 1 선택하여 생성 → 디자인 1 스타일 확인
- 디자인 2 선택하여 생성 → 디자인 2 스타일 확인

#### 2. 데스크톱 인터페이스 테스트
- 동일한 시나리오로 테스트

---

## 📊 예상 소요 시간 (실현 가능 버전)

| Phase | 작업 내용 | 예상 시간 |
|-------|----------|----------|
| Phase 0 | 준비 작업 (이미지 분석, 설정 파일 작성) | 2-3시간 |
| Phase 1 | 기본 구조 구축 | 2-3시간 |
| Phase 2 | 디자인 1 구현 | 4-6시간 |
| Phase 3 | 디자인 2 구현 | 3-4시간 |
| Phase 4 | 기존 코드 통합 | 1-2시간 |
| Phase 5 | 웹 인터페이스 개선 | 2-3시간 |
| Phase 6 | 데스크톱 인터페이스 개선 | 1-2시간 |
| Phase 7 | 테스트 및 검증 | 3-4시간 |
| **총계** | | **18-27시간** |

**참고**: 
- 엑셀 템플릿 제작 불필요 (설정 파일로 대체)
- 현재 사용 중인 라이브러리만 사용 (추가 의존성 최소화)

---

## ⚠️ 주의사항

### 1. 기존 기능 보존
- 기존 API 호출 방식은 그대로 유지
- `design_name` 파라미터는 선택사항 (기본값: None)
- 기존 코드 수정 최소화

### 2. 샘플 이미지 분석
- 샘플 이미지를 정확히 분석하여 레이아웃 재현
- 색상, 폰트, 간격 등 세부 스타일 일치 확인
- 실제 출력 파일과 샘플 이미지 비교 검증

### 3. 성능 고려
- 디자인 클래스 인스턴스는 재사용 가능하도록 설계
- 불필요한 객체 생성 방지

### 4. 확장성 고려
- 향후 디자인 3, 4 추가 시 쉽게 확장 가능하도록 설계
- 팩토리 패턴으로 디자인 추가 용이

---

## 🎯 성공 기준

### 기능적 요구사항
- ✅ 사용자가 두 가지 디자인 중 선택 가능
- ✅ 선택한 디자인으로 PDF/엑셀 생성 가능
- ✅ 디자인 선택 없이도 기존 방식으로 동작
- ✅ 웹 및 데스크톱 인터페이스 모두 지원

### 품질 요구사항
- ✅ 기존 기능 정상 동작 (회귀 테스트 통과)
- ✅ 생성된 파일이 샘플 이미지와 유사한 스타일
- ✅ 에러 발생 시 적절한 폴백 처리
- ✅ 코드 가독성 및 유지보수성 유지

---

## 📚 참고 자료

### 샘플 이미지
- `sample/급여명세서_sample.png`: 디자인 1 참고용
- `sample/급여명세서_sample2.png`: 디자인 2 참고용

### 관련 문서
- `payroll_generator/pdf_generator.py`: 현재 PDF 생성 로직
- `payroll_generator/excel_handler.py`: 현재 엑셀 생성 로직
- `plan/이전파일/엑셀템플릿기반PDF생성_구현계획.md`: 템플릿 기반 생성 관련 문서

---

## ✅ 체크리스트

### 사전 준비
- [ ] 구현 방법 선택 (엑셀 템플릿 기반 / 코드 기반)
- [ ] 샘플 이미지 분석 및 스펙 문서 작성
- [ ] 엑셀 템플릿 제작 (방법 A 선택 시)
  - [ ] `design_1_template.xlsx` 제작
  - [ ] `design_2_template.xlsx` 제작
- [ ] 셀 위치 매핑 정의

### Phase 1: 디자인 템플릿 시스템 구축
- [ ] 디렉토리 구조 생성
- [ ] 기본 클래스 구현
- [ ] 디자인 팩토리 구현

### Phase 2: 디자인 1 구현
- [ ] 디자인 1 분석 및 스펙 정의
- [ ] 디자인 1 엑셀 생성 구현
  - [ ] 템플릿 기반: 템플릿 로드 및 데이터 채우기
  - [ ] 코드 기반: openpyxl로 레이아웃 구현
- [ ] 디자인 1 PDF 생성 구현
  - [ ] 엑셀→PDF 변환 또는 reportlab 직접 구현

### Phase 3: 디자인 2 구현
- [ ] 디자인 2 분석 및 스펙 정의
- [ ] 디자인 2 엑셀 생성 구현
  - [ ] 템플릿 기반: 템플릿 로드 및 데이터 채우기
  - [ ] 코드 기반: openpyxl로 레이아웃 구현
- [ ] 디자인 2 PDF 생성 구현
  - [ ] 엑셀→PDF 변환 또는 reportlab 직접 구현

### Phase 4: 기존 코드 통합
- [ ] PDFGenerator 수정
- [ ] ExcelHandler 수정

### Phase 5: 웹 인터페이스 개선
- [ ] 폼 수정
- [ ] 라우트 수정
- [ ] 템플릿 수정

### Phase 6: 데스크톱 인터페이스 개선
- [ ] GUI 수정
- [ ] 생성 로직 수정

### Phase 7: 테스트 및 검증
- [ ] 단위 테스트
- [ ] 통합 테스트
- [ ] 출력 파일 검증

---

## 📌 다음 단계

### 즉시 시작 가능

#### 1. Git 브랜치 설정 (먼저 실행)
```bash
# 현재 변경사항 커밋
git add plan/2025-12-12/ sample/
git commit -m "docs: 디자인 선택 기능 실행계획 추가"

# develop 브랜치 생성
git checkout -b develop
git push -u origin develop

# 기능 브랜치 생성
git checkout -b feature/design-selection
git push -u origin feature/design-selection
```

#### 2. 구현 방법 결정 ✅
- **방법: 설정 파일 기반 + reportlab 직접 구현** (v2.0)
  - 엑셀 템플릿 불필요
  - 설정 파일(YAML)로 디자인 스펙 관리
  - reportlab으로 직접 구현

#### 3. 준비 작업

**즉시 시작 가능한 작업**:
1. **Phase 0 브랜치 생성**
   ```bash
   git checkout -b feature/design-selection-phase-0
   ```
2. **샘플 이미지 분석**: 두 샘플 이미지를 상세히 분석
3. **설정 파일 작성**: 분석 결과를 YAML 형식으로 작성
   - `configs/design_1.yaml`
   - `configs/design_2.yaml`
4. **Phase 0 완료**: 준비 작업 완료 후 Phase 1 시작

### 구현 시작 전 준비

1. **샘플 이미지 분석**: 두 샘플 이미지를 상세히 분석하여 디자인 스펙 문서 작성
2. **설정 파일 작성**: 분석 결과를 YAML 형식으로 작성
3. **Phase 1 시작**: 디자인 템플릿 시스템 구축부터 시작
4. **단계별 구현**: 각 Phase를 순차적으로 진행하며 테스트

### 핵심 변경사항 요약

- ❌ **제거**: 엑셀 템플릿 제작 (불필요)
- ✅ **추가**: YAML 설정 파일 작성
- ✅ **개선**: reportlab 직접 구현 (플랫폼 독립)
- ✅ **개선**: 설정 기반 디자인 관리 (유지보수 용이)

---

## 💡 엑셀 템플릿 제작 필요 여부

### 답변: **아니요, 필요 없습니다!** ✅

### 이유 (v2.0 개선)

1. **설정 파일 기반 접근**
   - 엑셀 템플릿 대신 YAML 설정 파일 사용
   - 샘플 이미지 분석 결과를 설정 파일로 작성
   - 코드에서 설정 파일을 읽어서 동적으로 생성

2. **플랫폼 독립성**
   - 엑셀→PDF 변환 라이브러리 불필요
   - 현재 사용 중인 reportlab만 사용
   - 배포 시 추가 의존성 없음

3. **유지보수 용이성**
   - 설정 파일만 수정하면 디자인 변경 가능
   - 코드 수정 불필요
   - 버전 관리 용이 (텍스트 파일)

### 대신 필요한 작업

1. **설정 파일 작성** (YAML 형식)
   - 샘플 이미지 분석 결과를 YAML로 작성
   - 레이아웃, 색상, 폰트 정보 포함
   - 상세한 예시는 위 "설정 기반 디자인 스펙 구조" 참조

2. **코드 구현**
   - 설정 파일을 읽어서 reportlab/openpyxl로 직접 생성
   - 엑셀 템플릿 파일 불필요

### 장점

- ✅ 플랫폼 독립적 (Windows, macOS, Linux 모두 동일)
- ✅ 추가 라이브러리 불필요
- ✅ 배포 시 의존성 최소화
- ✅ 설정 파일만 수정하여 디자인 변경 가능
- ✅ 버전 관리 용이 (텍스트 파일)

---

**작성자**: AI Assistant  
**작성일**: 2025-12-12  
**버전**: 2.1 (Git 브랜치 전략 포함)  
**최종 업데이트**: 2025-12-12  
**상태**: ✅ Git 브랜치 전략 포함 실행계획 작성 완료

**주요 변경사항 (v2.1)**:
- ✅ Git 브랜치 전략 추가 (Feature Branch 전략)
- ✅ 각 Phase별 브랜치 전략 명시
- ✅ 병합 전략 및 롤백 계획 포함
- ✅ 커밋 메시지 규칙 정의

**주요 변경사항 (v2.0)**:
- ✅ 엑셀 템플릿 기반 방법 제거 → 설정 파일(YAML) 기반으로 변경
- ✅ 엑셀→PDF 변환 제거 → reportlab 직접 구현
- ✅ 플랫폼 독립적 접근 채택
- ✅ 실제 구현 가능한 코드 예시 포함
- ✅ 테스트 가능한 구조 설계

**참고 문서**:
- **상세 구현 코드**: `디자인_선택_기능_추가_실행계획_v2.md`
- **Git 브랜치 전략 상세**: `Git_브랜치_전략_포함_실행계획.md`
