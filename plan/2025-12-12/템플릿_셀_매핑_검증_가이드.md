# 템플릿 셀 매핑 검증 가이드

**작성일**: 2025-12-12  
**목적**: 템플릿 디자인의 셀 매핑을 정확하게 검증하고 수정하는 방법 안내

---

## 📋 개요

템플릿 디자인이 제대로 작동하려면 실제 템플릿 파일의 셀 구조와 셀 매핑 JSON 파일이 일치해야 합니다. 현재는 기본 매핑으로 설정되어 있으므로, 실제 템플릿 파일을 확인하여 정확한 셀 위치를 찾아야 합니다.

---

## 🔍 셀 매핑 검증 방법

### 방법 1: 자동 분석 스크립트 사용 (권장)

#### 1. 필요한 패키지 설치
```bash
pip install openpyxl
# 또는
pip install -r requirements.txt
```

#### 2. 템플릿 분석 실행
```bash
# 템플릿 1 분석
python scripts/analyze_template_cells.py \
    payroll_generator/templates/designs/template_sample1.xlsx \
    payroll_generator/templates/designs/configs/template_sample1_mapping.json

# 템플릿 2 분석
python scripts/analyze_template_cells.py \
    payroll_generator/templates/designs/template_sample2.xlsx \
    payroll_generator/templates/designs/configs/template_sample2_mapping.json
```

#### 3. 생성된 JSON 파일 확인 및 수정
분석 스크립트가 자동으로 셀 매핑을 생성하지만, 정확성을 위해 수동 검증이 필요합니다.

---

### 방법 2: 수동 검증 (정확도 높음)

#### 1. 템플릿 파일 열기
- `payroll_generator/templates/designs/template_sample1.xlsx` 엑셀로 열기
- `payroll_generator/templates/designs/template_sample2.xlsx` 엑셀로 열기

#### 2. 각 데이터 항목의 셀 위치 확인

다음 항목들의 실제 셀 위치를 확인하세요:

**직원 정보:**
- [ ] 이름 (employee_name)
- [ ] 주민번호 (resident_number)
- [ ] 입사일 (join_date)
- [ ] 기간 (period)

**지급 항목:**
- [ ] 기본급 (basic_salary)
- [ ] 연장근무수당 (overtime)
- [ ] 상여금 (bonus)
- [ ] 총지급액 (total_payment)

**공제 항목:**
- [ ] 국민연금 (national_pension)
- [ ] 건강보험 (health_insurance)
- [ ] 장기요양 (long_term_care)
- [ ] 고용보험 (employment_insurance)
- [ ] 소득세 (income_tax)
- [ ] 지방소득세 (local_income_tax)
- [ ] 총공제액 (total_deduction)

**실수령액:**
- [ ] 실수령액 (net_pay)

#### 3. 셀 매핑 JSON 파일 수정

`payroll_generator/templates/designs/configs/template_sample1_mapping.json` 파일을 열어서 확인한 셀 위치로 수정:

```json
{
  "cell_mapping": {
    "period": "A2",              // 실제 셀 위치로 수정
    "employee_name": "B4",        // 실제 셀 위치로 수정
    "resident_number": "B5",      // 실제 셀 위치로 수정
    "join_date": "B6",           // 실제 셀 위치로 수정
    "basic_salary": "B9",        // 실제 셀 위치로 수정
    "overtime": "B10",           // 실제 셀 위치로 수정
    "bonus": "B11",              // 실제 셀 위치로 수정
    "total_payment": "B12",      // 실제 셀 위치로 수정
    "national_pension": "B15",    // 실제 셀 위치로 수정
    "health_insurance": "B16",   // 실제 셀 위치로 수정
    "long_term_care": "B17",     // 실제 셀 위치로 수정
    "employment_insurance": "B18", // 실제 셀 위치로 수정
    "income_tax": "B19",         // 실제 셀 위치로 수정
    "local_income_tax": "B20",   // 실제 셀 위치로 수정
    "total_deduction": "B21",    // 실제 셀 위치로 수정
    "net_pay": "A23"             // 실제 셀 위치로 수정
  }
}
```

**주의사항:**
- 셀 주소는 대문자로 작성 (예: "A2", "B4")
- 데이터가 들어갈 셀의 위치를 지정 (라벨이 아닌 값 셀)
- 병합된 셀의 경우 첫 번째 셀 주소 사용

---

## 🧪 실제 생성 테스트

### 1. 테스트 스크립트 실행

```bash
# 필요한 패키지 설치
pip install -r requirements.txt

# 테스트 실행
python scripts/test_template_generation.py
```

### 2. 생성된 파일 확인

테스트 스크립트가 생성한 엑셀 파일을 열어서 다음을 확인:

- [ ] 이름이 올바른 위치에 있는가?
- [ ] 주민번호가 올바른 위치에 있는가? (마스킹 처리 확인)
- [ ] 입사일이 올바른 위치에 있는가?
- [ ] 기본급이 올바른 위치에 있는가?
- [ ] 실수령액이 올바른 위치에 있는가?
- [ ] 모든 지급/공제 항목이 올바른 위치에 있는가?

### 3. 셀 위치가 맞지 않으면

1. 템플릿 파일을 다시 열어서 실제 셀 위치 확인
2. 셀 매핑 JSON 파일 수정
3. 테스트 다시 실행

---

## 📝 셀 매핑 예시

### 템플릿 1 (급여명세서_template.xlsx)

예상되는 셀 구조 (실제와 다를 수 있음):

```
A1: [제목] 급여명세서
A2: 지급기간: {period}
A3: [빈 행]
A4: 이름:
B4: {employee_name}
A5: 주민번호:
B5: {resident_number}
A6: 입사일:
B6: {join_date}
A7: [빈 행]
A8: [지급 항목]
A9: 기본급:
B9: {basic_salary}
...
```

### 템플릿 2 (임금명세서양식_template3.xlsx)

임금명세서는 법적 요구사항이 더 많을 수 있습니다:
- 연장·야간·휴일근로수당 상세 정보
- 계산 방법 기재
- 추가 항목들

---

## 🔧 문제 해결

### 문제 1: 셀 매핑 파일을 찾을 수 없음

**증상**: `셀 매핑 파일을 찾을 수 없습니다` 경고 메시지

**해결**:
1. JSON 파일이 올바른 위치에 있는지 확인
   - `payroll_generator/templates/designs/configs/template_sample1_mapping.json`
2. 파일 이름이 정확한지 확인
3. 기본 매핑이 사용되므로 기능은 작동하지만, 정확한 셀 위치를 위해 JSON 파일 생성 필요

### 문제 2: 데이터가 잘못된 위치에 들어감

**증상**: 생성된 엑셀 파일에서 데이터가 예상과 다른 위치에 있음

**해결**:
1. 템플릿 파일을 열어서 실제 셀 위치 확인
2. 셀 매핑 JSON 파일 수정
3. 다시 테스트

### 문제 3: 템플릿 파일을 찾을 수 없음

**증상**: `템플릿 파일을 찾을 수 없습니다` 에러

**해결**:
1. 템플릿 파일이 올바른 위치에 있는지 확인
   - `payroll_generator/templates/designs/template_sample1.xlsx`
2. 파일 이름이 정확한지 확인
3. PyInstaller 빌드 환경에서는 `resource_path()` 함수가 자동으로 찾음

---

## 📊 검증 체크리스트

### 템플릿 1 검증
- [ ] 템플릿 파일 열기 및 셀 구조 확인
- [ ] 셀 매핑 JSON 파일 수정
- [ ] 테스트 스크립트 실행
- [ ] 생성된 파일 확인
- [ ] 모든 데이터가 올바른 위치에 있는지 확인

### 템플릿 2 검증
- [ ] 템플릿 파일 열기 및 셀 구조 확인
- [ ] 셀 매핑 JSON 파일 수정
- [ ] 테스트 스크립트 실행
- [ ] 생성된 파일 확인
- [ ] 모든 데이터가 올바른 위치에 있는지 확인

---

## 🎯 다음 단계

1. **셀 매핑 검증 완료 후**:
   - 웹/데스크톱 인터페이스에서 실제로 사용해보기
   - 다양한 데이터로 테스트

2. **추가 개선 사항**:
   - PDF 생성 지원 (현재는 기본 PDF 생성 사용)
   - 추가 템플릿 지원
   - 템플릿 미리보기 기능

---

**작성자**: AI Assistant  
**작성일**: 2025-12-12  
**상태**: 📋 가이드 작성 완료
