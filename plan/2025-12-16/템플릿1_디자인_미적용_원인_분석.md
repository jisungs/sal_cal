# í…œí”Œë¦¿1 ë””ìì¸ ë¯¸ì ìš© ì›ì¸ ë¶„ì„ ë³´ê³ ì„œ

**ì‘ì„±ì¼**: 2025-12-16  
**ë¬¸ì œ**: í…œí”Œë¦¿1 ì„ íƒ ì‹œ ê¸°ë³¸ ë””ìì¸ìœ¼ë¡œ ê¸‰ì—¬ëª…ì„¸ì„œê°€ ìƒì„±ë¨  
**ìƒíƒœ**: ğŸ” ì›ì¸ ë¶„ì„ ì™„ë£Œ

---

## ğŸ” ë¬¸ì œ ë¶„ì„

### í•µì‹¬ ë¬¸ì œ ë°œê²¬

**ë¬¸ì œ 1: ë©”ì¸ í˜ì´ì§€(ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ)ì— ë””ìì¸ ì„ íƒ UIê°€ ì—†ìŒ**

**ìœ„ì¹˜**: `web/templates/index.html`

**í˜„ì¬ ìƒíƒœ**:
- ë©”ì¸ í˜ì´ì§€ì—ëŠ” `period`, `format` (ì¶œë ¥ í˜•ì‹)ë§Œ ì„ íƒí•  ìˆ˜ ìˆìŒ
- **`design_name` ì„ íƒ UIê°€ ì „í˜€ ì—†ìŒ**
- ì‚¬ìš©ìê°€ í…œí”Œë¦¿ì„ ì„ íƒí•  ë°©ë²•ì´ ì—†ìŒ

**ë¬¸ì œ 2: `/upload` ë¼ìš°íŠ¸ì—ì„œ `design_name`ì„ ì„¸ì…˜ì— ì €ì¥í•˜ì§€ ì•ŠìŒ**

**ìœ„ì¹˜**: `app/routes/main.py:60-124`

**í˜„ì¬ ì½”ë“œ**:
```python
@main_bp.route('/upload', methods=['POST'])
def upload_file():
    """íŒŒì¼ ì—…ë¡œë“œ ë° ì²˜ë¦¬"""
    try:
        file = request.files['file']
        period = request.form.get('period', datetime.now().strftime('%Y-%m'))
        output_format = request.form.get('format', 'both')
        # âŒ design_nameì„ ì½ì§€ ì•ŠìŒ!
        
        # ... íŒŒì¼ ì²˜ë¦¬ ...
        
        # ì„¸ì…˜ì— ê²°ê³¼ ì €ì¥
        session['results'] = results
        session['period'] = period
        session['output_format'] = output_format
        session['filepath'] = filepath
        # âŒ session['design_name']ì„ ì €ì¥í•˜ì§€ ì•ŠìŒ!
```

**ë¬¸ì œì **:
- `request.form.get('design_name')`ì„ ì½ì§€ ì•ŠìŒ
- ì„¸ì…˜ì— `design_name`ì„ ì €ì¥í•˜ì§€ ì•ŠìŒ
- ë”°ë¼ì„œ ë‹¤ìš´ë¡œë“œ ì‹œ í•­ìƒ `None`ì´ ë¨

**ë¬¸ì œ 3: ë‹¤ìš´ë¡œë“œ ì‹œ ì„¸ì…˜ì—ì„œ `design_name`ì„ ì½ì§€ë§Œ í•­ìƒ `None`**

**ìœ„ì¹˜**: `app/routes/main.py:214-242`

**í˜„ì¬ ì½”ë“œ**:
```python
@main_bp.route('/download/<format>/<employee_name>')
def download_file(format, employee_name):
    # ...
    design_name = session.get('design_name', None)  # âŒ í•­ìƒ None!
    logger.info(f"[ë‹¤ìš´ë¡œë“œ-Excel] ì„¸ì…˜ì—ì„œ ì½ì€ design_name: '{design_name}'")
    
    if design_name == 'default':
        design_name = None
    
    # design_nameì´ Noneì´ë¯€ë¡œ í•­ìƒ ê¸°ë³¸ ë””ìì¸ ì‚¬ìš©
    excel_handler.write_payroll(
        # ...
        design_name=design_name  # âŒ í•­ìƒ None!
    )
```

---

## ğŸ“Š ì½”ë“œ íë¦„ ë¶„ì„

### í˜„ì¬ íë¦„ (ë¬¸ì œ ìˆìŒ)

```
1. ì‚¬ìš©ìê°€ ë©”ì¸ í˜ì´ì§€ ì ‘ì†
   â””â”€ index.html (ë””ìì¸ ì„ íƒ UI ì—†ìŒ)

2. ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ
   â””â”€ /upload ë¼ìš°íŠ¸
      â”œâ”€ period ì½ê¸° âœ…
      â”œâ”€ format ì½ê¸° âœ…
      â””â”€ design_name ì½ê¸° âŒ (ì—†ìŒ)

3. ì„¸ì…˜ì— ì €ì¥
   â”œâ”€ session['results'] âœ…
   â”œâ”€ session['period'] âœ…
   â”œâ”€ session['output_format'] âœ…
   â””â”€ session['design_name'] âŒ (ì €ì¥ ì•ˆ í•¨)

4. ê²°ê³¼ í˜ì´ì§€ í‘œì‹œ
   â””â”€ result.html

5. ë‹¤ìš´ë¡œë“œ ì‹œë„
   â””â”€ /download/<format>/<employee_name>
      â”œâ”€ session.get('design_name', None) âŒ (í•­ìƒ None)
      â””â”€ excel_handler.write_payroll(design_name=None) âŒ (ê¸°ë³¸ ë””ìì¸)
```

### ê¸°ëŒ€ íë¦„ (ìˆ˜ì • í•„ìš”)

```
1. ì‚¬ìš©ìê°€ ë©”ì¸ í˜ì´ì§€ ì ‘ì†
   â””â”€ index.html (ë””ìì¸ ì„ íƒ UI ì¶”ê°€ í•„ìš”)

2. ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ
   â””â”€ /upload ë¼ìš°íŠ¸
      â”œâ”€ period ì½ê¸° âœ…
      â”œâ”€ format ì½ê¸° âœ…
      â””â”€ design_name ì½ê¸° âœ… (ì¶”ê°€ í•„ìš”)

3. ì„¸ì…˜ì— ì €ì¥
   â”œâ”€ session['results'] âœ…
   â”œâ”€ session['period'] âœ…
   â”œâ”€ session['output_format'] âœ…
   â””â”€ session['design_name'] âœ… (ì¶”ê°€ í•„ìš”)

4. ê²°ê³¼ í˜ì´ì§€ í‘œì‹œ
   â””â”€ result.html

5. ë‹¤ìš´ë¡œë“œ ì‹œë„
   â””â”€ /download/<format>/<employee_name>
      â”œâ”€ session.get('design_name', None) âœ… (ì˜¬ë°”ë¥¸ ê°’)
      â””â”€ excel_handler.write_payroll(design_name='template_sample1') âœ… (í…œí”Œë¦¿ ì ìš©)
```

---

## ğŸ”— ê´€ë ¨ íŒŒì¼ ë¹„êµ

### ì§ì ‘ ì…ë ¥ ê¸°ëŠ¥ (ì •ìƒ ì‘ë™)

**ìœ„ì¹˜**: `app/routes/payroll.py`

**ì‘ë™ ë°©ì‹**:
```python
# 66-94ë²ˆì§¸ ì¤„
design_name_value = form.design_name.data  # âœ… í¼ì—ì„œ ì½ê¸°
# ... ê²€ì¦ ...
session['design_name'] = design_name_value  # âœ… ì„¸ì…˜ì— ì €ì¥
```

**í…œí”Œë¦¿**: `web/templates/payroll/input_form.html`
- ë””ìì¸ ì„ íƒ ë“œë¡­ë‹¤ìš´ì´ ìˆìŒ âœ…
- `template_sample1`, `template_sample2` ì„ íƒ ê°€ëŠ¥ âœ…

### ë©”ì¸ í˜ì´ì§€ ì—…ë¡œë“œ (ë¬¸ì œ ìˆìŒ)

**ìœ„ì¹˜**: `app/routes/main.py`

**ì‘ë™ ë°©ì‹**:
```python
# 68-69ë²ˆì§¸ ì¤„
period = request.form.get('period', ...)  # âœ… ì½ê¸°
output_format = request.form.get('format', 'both')  # âœ… ì½ê¸°
# âŒ design_name ì½ê¸° ì—†ìŒ!

# 121-124ë²ˆì§¸ ì¤„
session['results'] = results  # âœ… ì €ì¥
session['period'] = period  # âœ… ì €ì¥
session['output_format'] = output_format  # âœ… ì €ì¥
# âŒ session['design_name'] ì €ì¥ ì—†ìŒ!
```

**í…œí”Œë¦¿**: `web/templates/index.html`
- ë””ìì¸ ì„ íƒ UI ì—†ìŒ âŒ

---

## ğŸ¯ í•´ê²° ë°©ì•ˆ

### í•´ê²° ë°©ì•ˆ 1: ë©”ì¸ í˜ì´ì§€ì— ë””ìì¸ ì„ íƒ UI ì¶”ê°€ (ê¶Œì¥)

**ìˆ˜ì • í•„ìš” íŒŒì¼**:
1. `web/templates/index.html` - ë””ìì¸ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì¶”ê°€
2. `app/routes/main.py` - `design_name` ì½ê¸° ë° ì„¸ì…˜ ì €ì¥ ì¶”ê°€

**êµ¬í˜„ ë‚´ìš©**:
- ë©”ì¸ í˜ì´ì§€ì— ë””ìì¸ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì¶”ê°€
  - ê¸°ë³¸ ë””ìì¸ (default)
  - í…œí”Œë¦¿1: ê¸‰ì—¬ëª…ì„¸ì„œ (template_sample1)
  - í…œí”Œë¦¿2: ì„ê¸ˆëª…ì„¸ì„œ (template_sample2)
- `/upload` ë¼ìš°íŠ¸ì—ì„œ `request.form.get('design_name')` ì½ê¸°
- ì„¸ì…˜ì— `session['design_name']` ì €ì¥
- ì§ì ‘ ì…ë ¥ ê¸°ëŠ¥ê³¼ ë™ì¼í•œ ê²€ì¦ ë¡œì§ ì ìš©

### í•´ê²° ë°©ì•ˆ 2: ê¸°ë³¸ê°’ìœ¼ë¡œ í…œí”Œë¦¿1 ì‚¬ìš©

**ìˆ˜ì • í•„ìš” íŒŒì¼**:
- `app/routes/main.py` - ê¸°ë³¸ê°’ìœ¼ë¡œ `'template_sample1'` ì„¤ì •

**ì¥ì **: ë¹ ë¥¸ ìˆ˜ì • ê°€ëŠ¥  
**ë‹¨ì **: ì‚¬ìš©ìê°€ ì„ íƒí•  ìˆ˜ ì—†ìŒ

---

## ğŸ“‹ ìˆ˜ì • ì²´í¬ë¦¬ìŠ¤íŠ¸

### 1. ë©”ì¸ í˜ì´ì§€ í…œí”Œë¦¿ ìˆ˜ì •
- [ ] `index.html`ì— ë””ìì¸ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì¶”ê°€
- [ ] ì§ì ‘ ì…ë ¥ í¼ê³¼ ë™ì¼í•œ ë””ìì¸ ì„ íƒ UI êµ¬í˜„

### 2. ì—…ë¡œë“œ ë¼ìš°íŠ¸ ìˆ˜ì •
- [ ] `request.form.get('design_name')` ì½ê¸° ì¶”ê°€
- [ ] `design_name` ê²€ì¦ ë¡œì§ ì¶”ê°€ (ì§ì ‘ ì…ë ¥ê³¼ ë™ì¼)
- [ ] `session['design_name']` ì €ì¥ ì¶”ê°€
- [ ] ë¡œê¹… ì¶”ê°€ (ë””ë²„ê¹…ìš©)

### 3. ê²€ì¦ ë° í…ŒìŠ¤íŠ¸
- [ ] ë©”ì¸ í˜ì´ì§€ì—ì„œ í…œí”Œë¦¿1 ì„ íƒ í›„ ì—…ë¡œë“œ
- [ ] ë‹¤ìš´ë¡œë“œ ì‹œ í…œí”Œë¦¿1ì´ ì ìš©ë˜ëŠ”ì§€ í™•ì¸
- [ ] ë¡œê·¸ì—ì„œ `design_name`ì´ ì˜¬ë°”ë¥´ê²Œ ì „ë‹¬ë˜ëŠ”ì§€ í™•ì¸

---

## ğŸ” ì¶”ê°€ í™•ì¸ ì‚¬í•­

### ë””ìì¸ íŒ©í† ë¦¬ ì •ìƒ ì‘ë™ í™•ì¸

**ìœ„ì¹˜**: `payroll_generator/templates/designs/design_factory.py`

**í™•ì¸ í•„ìš”**:
- `DesignFactory.get_design('template_sample1')`ì´ ì˜¬ë°”ë¥¸ ì¸ìŠ¤í„´ìŠ¤ ë°˜í™˜í•˜ëŠ”ì§€
- í…œí”Œë¦¿ íŒŒì¼ì´ ì¡´ì¬í•˜ëŠ”ì§€ (`template_sample1.xlsx`, `template_sample1_mapping.json`)

### ì—‘ì…€ í•¸ë“¤ëŸ¬ ì •ìƒ ì‘ë™ í™•ì¸

**ìœ„ì¹˜**: `payroll_generator/excel_handler.py`

**í™•ì¸ í•„ìš”**:
- `design_name`ì´ ì „ë‹¬ë˜ë©´ ë””ìì¸ íŒ©í† ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ”ì§€
- ì˜ˆì™¸ ë°œìƒ ì‹œ ê¸°ë³¸ ë””ìì¸ìœ¼ë¡œ í´ë°±í•˜ëŠ”ì§€

---

## ğŸ“ ìš”ì•½

**í•µì‹¬ ë¬¸ì œ**:
1. ë©”ì¸ í˜ì´ì§€ì— ë””ìì¸ ì„ íƒ UIê°€ ì—†ìŒ
2. `/upload` ë¼ìš°íŠ¸ì—ì„œ `design_name`ì„ ì½ì§€ ì•ŠìŒ
3. ì„¸ì…˜ì— `design_name`ì„ ì €ì¥í•˜ì§€ ì•ŠìŒ
4. ê²°ê³¼ì ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ ì‹œ í•­ìƒ `design_name=None`ì´ ë˜ì–´ ê¸°ë³¸ ë””ìì¸ ì‚¬ìš©

**í•´ê²° ë°©ë²•**:
- ë©”ì¸ í˜ì´ì§€ì— ë””ìì¸ ì„ íƒ UI ì¶”ê°€
- ì—…ë¡œë“œ ë¼ìš°íŠ¸ì—ì„œ `design_name` ì½ê¸° ë° ì„¸ì…˜ ì €ì¥ ì¶”ê°€
- ì§ì ‘ ì…ë ¥ ê¸°ëŠ¥ê³¼ ë™ì¼í•œ ê²€ì¦ ë¡œì§ ì ìš©

**ì˜ˆìƒ ì‘ì—… ì‹œê°„**: 30ë¶„-1ì‹œê°„

