# 📊 엑셀 템플릿 기반 디자인 업그레이드 실행계획

**작성일**: 2025-12-15 (업데이트)  
**목표**: `sample` 폴더의 엑셀 템플릿을 활용하여 사용자가 디자인을 선택하여 출력할 수 있도록 업그레이드  
**현재 상태**: 기본 디자인만 출력됨, 템플릿 디자인이 제대로 작동하지 않음  
**변경사항**: YAML 기반 디자인(design_1, design_2) 삭제, 템플릿 디자인만 사용

---

## 📋 목차

1. [현재 상태 분석](#현재-상태-분석)
2. [목표 및 요구사항](#목표-및-요구사항)
3. [실행 계획](#실행-계획)
4. [기술적 구현 상세](#기술적-구현-상세)
5. [테스트 계획](#테스트-계획)
6. [예상 소요 시간](#예상-소요-시간)

---

## 🔍 현재 상태 분석

### 1. 템플릿 파일 위치

**현재 구조**:
```
payroll_generator/templates/designs/
├── template_sample1.xlsx  # 현재 사용 중인 템플릿
└── template_sample2.xlsx  # 현재 사용 중인 템플릿
```

**목표 구조**:
```
sample/
├── 급여명세서_template.xlsx          # → template_sample1로 사용
└── 임금명세서양식_template3.xlsx     # → template_sample2로 사용
```

### 2. 현재 디자인 시스템

**구현된 디자인**:
- ❌ `design_1`: YAML 설정 기반, reportlab 직접 생성 (삭제 예정)
- ❌ `design_2`: YAML 설정 기반, reportlab 직접 생성 (삭제 예정)
- ⚠️ `template_sample1`: 엑셀 템플릿 기반 (경로 문제)
- ⚠️ `template_sample2`: 엑셀 템플릿 기반 (경로 문제)

**문제점**:
1. YAML 기반 디자인(design_1, design_2)이 사용되지 않아 삭제 필요
2. 템플릿 파일이 `payroll_generator/templates/designs/`에 하드코딩됨
3. `sample` 폴더의 템플릿을 사용하지 않음
4. 템플릿 분석이 완료되지 않아 매핑 파일이 기본값만 있음
5. PDF 생성 시 엑셀 템플릿을 사용하지 않고 기본 디자인으로 생성됨

### 3. 현재 코드 구조

**템플릿 디자인 클래스**:
- `TemplateDesign`: 기본 클래스 (엑셀 템플릿 기반)
- `TemplateSample1`: 급여명세서 템플릿
- `TemplateSample2`: 임금명세서 템플릿

**템플릿 경로 찾기**:
- `TemplateDesign._get_template_path()`: 현재 `payroll_generator/templates/designs/`에서만 찾음

**셀 매핑**:
- `template_sample1_mapping.json`: 기본 매핑만 있음 (실제 분석 필요)
- `template_sample2_mapping.json`: 기본 매핑만 있음 (실제 분석 필요)

---

## 🎯 목표 및 요구사항

### 목표

1. **템플릿 파일 경로 변경**
   - `sample` 폴더의 엑셀 템플릿을 사용하도록 변경
   - `급여명세서_template.xlsx` → `template_sample1`
   - `임금명세서양식_template3.xlsx` → `template_sample2`

2. **템플릿 분석 및 매핑 업데이트**
   - 실제 템플릿 파일의 셀 구조 분석
   - 매핑 파일 업데이트
   - 병합 셀, 수식 등 확인

3. **PDF 생성 개선**
   - 엑셀 템플릿 기반 PDF 생성 지원
   - 엑셀→PDF 변환 또는 엑셀 스타일 반영

4. **사용자 인터페이스 개선**
   - 웹/데스크톱에서 템플릿 디자인 선택 옵션 추가
   - 템플릿 미리보기 기능 (선택사항)

### 요구사항

- ✅ 기존 기능 보존 (하위 호환성)
- ✅ YAML 기반 디자인(`design_1`, `design_2`) 삭제
- ✅ 템플릿 디자인만 사용 (`template_sample1`, `template_sample2`)
- ✅ 에러 처리 및 폴백 메커니즘
- ✅ 기존 코드에서 design_1, design_2 참조 제거

---

## 📅 실행 계획

### Phase 0: YAML 기반 디자인 삭제 및 코드 정리 (2-3시간) ✅ **완료**

#### 0.1 DesignFactory에서 design_1, design_2 제거 ✅

**파일**: `payroll_generator/templates/designs/design_factory.py`

**변경사항**:
- Design1, Design2 import 코드 제거
- `_designs` 딕셔너리에서 `design_1`, `design_2` 제거
- docstring 업데이트

**구현 예시**:
```python
# Design1, Design2 import 코드 삭제
# try:
#     from .design_1 import Design1
#     ...
# except:
#     Design1 = None
# 위 코드 전체 삭제

# try:
#     from .design_2 import Design2
#     ...
# except:
#     Design2 = None
# 위 코드 전체 삭제

class DesignFactory:
    """디자인 팩토리 클래스"""
    
    _designs = {
        'default': None,  # 기존 방식
        # 'design_1': Design1,  # 삭제됨
        # 'design_2': Design2,  # 삭제됨
        'template_sample1': TemplateSample1,  # 템플릿 샘플 1
        'template_sample2': TemplateSample2,  # 템플릿 샘플 2
    }
    
    @classmethod
    def get_design(cls, design_name='default'):
        """디자인 인스턴스 반환
        
        Args:
            design_name: 디자인 이름 ('default', 'template_sample1', 'template_sample2')
            
        Returns:
            디자인 인스턴스 또는 None (기본 방식 사용)
        """
        # ... 기존 코드 유지
```

#### 0.2 웹 인터페이스에서 design_1, design_2 제거 ✅

**파일**: `web/templates/payroll/input_form.html`, `web/templates/payroll/multiple_input.html`

**변경사항**:
- design_1, design_2 관련 카드 및 라디오 버튼 제거
- template_sample1, template_sample2만 남기기
- JavaScript에서 design_1, design_2 관련 코드 제거 (있는 경우)

**구현 예시**:
```html
<!-- input_form.html, multiple_input.html -->
<!-- 기존 코드 (삭제할 부분) -->
<!-- 
<div class="col-md-6 col-lg-4">
    <div class="card design-card h-100" data-design="design_1" ...>
        <div class="card-body text-center">
            <div class="mb-2">
                <input type="radio" name="design_radio" value="design_1" id="design_1" ...>
                <div style="font-size: 2.5rem; color: #0d6efd;">🎨</div>
            </div>
            <h6 class="card-title mb-1">디자인 1</h6>
            <p class="card-text small text-muted mb-0">YAML 기반 디자인</p>
        </div>
    </div>
</div>
위 코드 전체 삭제
-->

<!-- 
<div class="col-md-6 col-lg-4">
    <div class="card design-card h-100" data-design="design_2" ...>
        <div class="card-body text-center">
            <div class="mb-2">
                <input type="radio" name="design_radio" value="design_2" id="design_2" ...>
                <div style="font-size: 2.5rem; color: #198754;">🖌️</div>
            </div>
            <h6 class="card-title mb-1">디자인 2</h6>
            <p class="card-text small text-muted mb-0">YAML 기반 디자인</p>
        </div>
    </div>
</div>
위 코드 전체 삭제
-->

<!-- 유지할 부분: default, template_sample1, template_sample2만 -->
<div class="col-md-6 col-lg-4">
    <div class="card design-card h-100" data-design="default" ...>
        <!-- 기본 디자인 카드 -->
    </div>
</div>
<div class="col-md-6 col-lg-4">
    <div class="card design-card h-100" data-design="template_sample1" ...>
        <!-- 템플릿 1 카드 -->
    </div>
</div>
<div class="col-md-6 col-lg-4">
    <div class="card design-card h-100" data-design="template_sample2" ...>
        <!-- 템플릿 2 카드 -->
    </div>
</div>
```

**주의사항**:
- JavaScript 파일(`web/static/js/payroll_input.js`, `web/static/js/multiple_payroll_input.js`)에서도 design_1, design_2 관련 코드가 있는지 확인하고 제거

#### 0.3 데스크톱 인터페이스에서 design_1, design_2 제거 ✅

**파일**: `main.py`

**변경사항**:
- 디자인 선택 Combobox에서 design_1, design_2 제거
- 디자인 이름 매핑에서 design_1, design_2 제거
- 디자인 선택 관련 주석 업데이트

**구현 예시**:
```python
# main.py - PayrollApp 클래스

# 기존 코드 (삭제)
# design_combo['values'] = ('default', 'design_1', 'design_2', 'template_sample1', 'template_sample2')

# 변경 후
design_combo['values'] = ('default', 'template_sample1', 'template_sample2')

# 기존 코드 (삭제)
# design_names = {
#     'default': '기본 디자인',
#     'design_1': '디자인 1',
#     'design_2': '디자인 2',
#     'template_sample1': '급여명세서 템플릿',
#     'template_sample2': '임금명세서 템플릿'
# }

# 변경 후
design_names = {
    'default': '기본 디자인',
    'template_sample1': '급여명세서 템플릿',
    'template_sample2': '임금명세서 템플릿'
}

# generate_payroll() 메서드에서도 확인
# design_name_value = self.design_name.get() if self.design_name.get() != 'default' else None
# 위 코드는 그대로 유지 (design_1, design_2는 이미 UI에서 제거되었으므로 선택 불가)
```

**주의사항**:
- `generate_payroll()` 메서드에서 design_1, design_2를 처리하는 코드가 있다면 제거하거나 폴백 처리 추가

#### 0.4 관련 파일 삭제 ✅

**삭제할 파일**:
- [x] `payroll_generator/templates/designs/design_1.py` ✅
- [x] `payroll_generator/templates/designs/design_2.py` ✅
- [x] `payroll_generator/templates/designs/configs/design_1.yaml` ✅
- [x] `payroll_generator/templates/designs/configs/design_2.yaml` ✅

**주의사항**:
- 삭제 전에 Git 커밋하여 백업
- 삭제 후 테스트하여 다른 기능에 영향 없는지 확인

#### 0.5 코드 문서 및 주석 업데이트 ✅

**파일**: `payroll_generator/excel_handler.py`, `payroll_generator/pdf_generator.py`

**변경사항**:
- docstring에서 `design_1`, `design_2` 언급 제거
- 디자인 이름 설명 업데이트

**구현 예시**:
```python
# excel_handler.py - write_payroll() 메서드
def write_payroll(self, payroll_data, output_path, employee_data, period=None, use_template=True, design_name=None):
    """급여명세서 엑셀 생성
    
    Args:
        ...
        design_name (str, optional): 디자인 이름 ('template_sample1', 'template_sample2', None)
            # 기존: ('design_1', 'design_2', None)
            # 변경: ('template_sample1', 'template_sample2', None)
    """
    # ... 기존 코드 유지
```

```python
# pdf_generator.py - generate_payslip() 메서드
def generate_payslip(self, payroll_data, employee_data, output_path, period, use_template=True, design_name=None):
    """급여명세서 PDF 생성
    
    Args:
        ...
        design_name (str, optional): 디자인 이름 ('template_sample1', 'template_sample2', None)
            # 기존: ('design_1', 'design_2', None)
            # 변경: ('template_sample1', 'template_sample2', None)
    """
    # ... 기존 코드 유지
```

#### 0.6 에러 처리 및 폴백 로직 추가

**파일**: `payroll_generator/excel_handler.py`, `payroll_generator/pdf_generator.py`

**변경사항**:
- `design_1`, `design_2` 선택 시 경고 메시지 표시 및 기본 디자인으로 폴백
- 로깅 메시지 업데이트

**구현 예시**:
```python
# excel_handler.py - write_payroll() 메서드
if design_name:
    # design_1, design_2는 더 이상 지원하지 않음
    if design_name in ['design_1', 'design_2']:
        logger.warning(
            f"[Excel 생성] '{design_name}'는 더 이상 지원하지 않습니다. "
            f"기본 디자인으로 폴백합니다. "
            f"템플릿 디자인(template_sample1, template_sample2)을 사용하세요."
        )
        design_name = None  # 기본 디자인으로 폴백
    
    if design_name:  # template_sample1, template_sample2만 처리
        # ... 기존 디자인 처리 로직
```

```python
# pdf_generator.py - generate_payslip() 메서드
if design_name:
    # design_1, design_2는 더 이상 지원하지 않음
    if design_name in ['design_1', 'design_2']:
        logger.warning(
            f"[PDF 생성] '{design_name}'는 더 이상 지원하지 않습니다. "
            f"기본 디자인으로 폴백합니다. "
            f"템플릿 디자인(template_sample1, template_sample2)을 사용하세요."
        )
        design_name = None  # 기본 디자인으로 폴백
    
    if design_name:  # template_sample1, template_sample2만 처리
        # ... 기존 디자인 처리 로직
```

#### 0.7 웹 라우트에서 design_1, design_2 검증 제거

**파일**: `app/routes/payroll.py`

**변경사항**:
- design_1, design_2 검증 로직 제거 (이미 폴백 처리됨)
- 로깅 메시지 업데이트

**구현 예시**:
```python
# app/routes/payroll.py - input_form() 메서드
if design_name_value == 'default' or design_name_value == '':
    design_name_value = None
elif design_name_value in ['design_1', 'design_2']:
    # design_1, design_2는 더 이상 지원하지 않음
    logger.warning(f"[디자인 선택] '{design_name_value}'는 더 이상 지원하지 않습니다. 기본 디자인으로 폴백합니다.")
    design_name_value = None
elif design_name_value:
    # template_sample1, template_sample2만 검증
    # ... 기존 검증 로직
```

#### 0.8 테스트 파일 정리

**파일**: `tests/test_template_design.py` 및 기타 테스트 파일

**변경사항**:
- design_1, design_2 관련 테스트 제거 또는 주석 처리
- 테스트 파일에서 design_1, design_2 import 제거

**구현 예시**:
```python
# tests/test_template_design.py
# 기존 코드
# from payroll_generator.templates.designs.design_1 import Design1
# from payroll_generator.templates.designs.design_2 import Design2
# 위 코드 삭제

# design_1, design_2 관련 테스트 메서드 제거 또는 주석 처리
# def test_design_1_init(self):
#     ...
# 위 테스트 메서드 삭제

# def test_design_2_init(self):
#     ...
# 위 테스트 메서드 삭제
```

#### 0.9 README 및 문서 업데이트

**파일**: `README.md`, `payroll_generator/docs/사용자_매뉴얼.md`

**변경사항**:
- design_1, design_2 언급 제거
- 템플릿 디자인만 설명

**구현 예시**:
```markdown
# README.md
## 디자인 선택 기능
- 기본 디자인: 기존 방식과 동일
- 템플릿 디자인:
  - template_sample1: 급여명세서 템플릿 (sample/급여명세서_template.xlsx)
  - template_sample2: 임금명세서 템플릿 (sample/임금명세서양식_template3.xlsx)

# 기존 내용 삭제
# - design_1: YAML 기반 디자인 1
# - design_2: YAML 기반 디자인 2
```

#### 0.10 테스트 ✅
- [x] DesignFactory에서 design_1, design_2 제거 확인 ✅
- [x] 웹 인터페이스에서 design_1, design_2 옵션 제거 확인 ✅
- [x] 데스크톱 인터페이스에서 design_1, design_2 옵션 제거 확인 ✅
- [x] docstring 업데이트 확인 ✅
- [x] 에러 처리 및 폴백 로직 테스트 ✅
- [x] design_1, design_2 선택 시 경고 메시지 및 폴백 확인 ✅
- [x] 기존 기능(기본 디자인, 템플릿 디자인) 정상 작동 확인 ✅
- [x] 테스트 파일 정리 확인 ✅

#### 0.11 Phase 0 작업 요약

**삭제할 파일**:
- `payroll_generator/templates/designs/design_1.py`
- `payroll_generator/templates/designs/design_2.py`
- `payroll_generator/templates/designs/configs/design_1.yaml`
- `payroll_generator/templates/designs/configs/design_2.yaml`

**수정할 파일**:
- `payroll_generator/templates/designs/design_factory.py` - import 및 _designs 딕셔너리 수정
- `web/templates/payroll/input_form.html` - design_1, design_2 카드 제거
- `web/templates/payroll/multiple_input.html` - design_1, design_2 카드 제거
- `web/static/js/payroll_input.js` - design_1, design_2 관련 코드 제거 (있는 경우)
- `web/static/js/multiple_payroll_input.js` - design_1, design_2 관련 코드 제거 (있는 경우)
- `main.py` - 디자인 선택 Combobox 및 매핑 수정
- `payroll_generator/excel_handler.py` - docstring 및 에러 처리 수정
- `payroll_generator/pdf_generator.py` - docstring 및 에러 처리 수정
- `app/routes/payroll.py` - design_1, design_2 검증 제거
- `tests/test_template_design.py` - design_1, design_2 테스트 제거
- `README.md` - design_1, design_2 언급 제거
- `payroll_generator/docs/사용자_매뉴얼.md` - design_1, design_2 언급 제거

**검증 사항**:
- [x] 모든 파일에서 design_1, design_2 참조 제거 확인 ✅
- [x] Git 커밋 전 전체 기능 테스트 ✅
- [x] 기본 디자인, 템플릿 디자인 정상 작동 확인 ✅

---

### Phase 1: 준비 작업 (1-2시간) ✅ **완료**

#### 1.1 템플릿 파일 확인 및 검증 ✅

**작업**:
- [x] `sample/급여명세서_template.xlsx` 파일 존재 확인 ✅
- [x] `sample/임금명세서양식_template3.xlsx` 파일 존재 확인 ✅
- [x] 템플릿 파일 구조 확인 (Excel로 열어서 구조 파악) ✅
- [x] 템플릿 파일 무결성 확인 (손상되지 않았는지) ✅
- [x] 템플릿 파일 크기 확인 (비정상적으로 큰 파일인지) ✅

**검증 스크립트**:
```python
# scripts/verify_templates.py (신규 생성)
import os
from pathlib import Path
import openpyxl

def verify_template(template_path):
    """템플릿 파일 검증"""
    if not os.path.exists(template_path):
        print(f"❌ 파일이 존재하지 않습니다: {template_path}")
        return False
    
    try:
        wb = openpyxl.load_workbook(template_path)
        ws = wb.active
        print(f"✓ 파일 로드 성공: {template_path}")
        print(f"  시트 이름: {ws.title}")
        print(f"  최대 행: {ws.max_row}")
        print(f"  최대 열: {ws.max_column}")
        wb.close()
        return True
    except Exception as e:
        print(f"❌ 파일 검증 실패: {e}")
        return False

if __name__ == '__main__':
    project_root = Path(__file__).parent.parent
    templates = [
        project_root / 'sample' / '급여명세서_template.xlsx',
        project_root / 'sample' / '임금명세서양식_template3.xlsx'
    ]
    
    for template in templates:
        verify_template(template)
```

#### 1.2 템플릿 분석 스크립트 확인 및 개선 ✅

**작업**:
- [x] `scripts/analyze_template_cells.py` 스크립트 실행 가능 여부 확인 ✅
- [x] 필요한 의존성 설치 확인 (`openpyxl`) ✅
- [x] 스크립트 출력 형식 확인 ✅
- [x] 스크립트 에러 처리 확인 ✅

**테스트 실행**:
```bash
# 스크립트 테스트 실행
python scripts/analyze_template_cells.py --help

# 실제 분석 실행 (테스트)
python scripts/analyze_template_cells.py \
  sample/급여명세서_template.xlsx \
  /tmp/test_mapping.json
```

#### 1.3 개발 환경 설정 ✅

**작업**:
- [x] Git 브랜치 생성 ✅
- [x] 가상환경 활성화 확인 ✅
- [x] 필수 의존성 설치 확인 ✅

**명령어**:
```bash
# Git 브랜치 생성
git checkout -b feature/excel-template-upgrade

# 가상환경 활성화 (이미 활성화되어 있다면 생략)
source venv/bin/activate  # Linux/Mac
# 또는
venv\Scripts\activate  # Windows

# 필수 의존성 확인
pip list | grep -E "openpyxl|pandas|reportlab"

# 선택적 의존성 설치 (테스트용)
pip install xlsx2pdf  # 선택사항
```

#### 1.4 백업 및 체크포인트 생성

**작업**:
- [ ] 현재 상태 Git 커밋 (안전한 체크포인트)
- [ ] 중요 파일 백업 (선택사항)

**명령어**:
```bash
# 현재 변경사항 커밋
git add .
git commit -m "chore: 엑셀 템플릿 업그레이드 작업 시작 전 체크포인트"

# 또는 현재 상태를 별도 브랜치로 백업
git branch backup-before-template-upgrade
```

---

### Phase 2: 템플릿 분석 및 매핑 파일 업데이트 (2-3시간) ✅ **완료**

#### 2.1 템플릿 분석 스크립트 실행 ✅

**전제 조건 확인**:
- [x] `scripts/analyze_template_cells.py` 스크립트가 정상 작동하는지 확인 ✅
- [x] 출력 디렉토리(`payroll_generator/templates/designs/configs/`) 존재 확인 ✅
- [x] 기존 매핑 파일 백업 (있는 경우) ✅

**템플릿 1 분석**:
```bash
# 기존 매핑 파일 백업 (있는 경우)
cp payroll_generator/templates/designs/configs/template_sample1_mapping.json \
   payroll_generator/templates/designs/configs/template_sample1_mapping.json.bak

# 템플릿 분석 실행
python scripts/analyze_template_cells.py \
  sample/급여명세서_template.xlsx \
  payroll_generator/templates/designs/configs/template_sample1_mapping.json

# 결과 확인
cat payroll_generator/templates/designs/configs/template_sample1_mapping.json
```

**템플릿 2 분석**:
```bash
# 기존 매핑 파일 백업 (있는 경우)
cp payroll_generator/templates/designs/configs/template_sample2_mapping.json \
   payroll_generator/templates/designs/configs/template_sample2_mapping.json.bak

# 템플릿 분석 실행
python scripts/analyze_template_cells.py \
  sample/임금명세서양식_template3.xlsx \
  payroll_generator/templates/designs/configs/template_sample2_mapping.json

# 결과 확인
cat payroll_generator/templates/designs/configs/template_sample2_mapping.json
```

**에러 처리**:
- 스크립트 실행 실패 시: 수동으로 템플릿 분석
- 매핑 파일 형식 오류 시: JSON 유효성 검사 및 수정

#### 1.2 매핑 파일 검증 및 수정 ✅
- [x] 분석 결과 확인 ✅
- [x] 매핑 파일 수동 검증 및 수정 (필요 시) ✅
- [x] 병합 셀, 수식 등 추가 정보 확인 ✅

#### 1.3 추가 필드 매핑 (선택사항)
- [ ] 은행명 (`bank_name`)
- [ ] 계좌번호 (`account_number`)
- [ ] 부양가족수 (`dependents`)
- [ ] 공제사항 메모 (`deduction_note`)
- [ ] 연장근로수당 계산 방법 (`overtime_calculation`) - 임금명세서용

**예상 결과**:
- `template_sample1_mapping.json`: 실제 셀 위치 반영
- `template_sample2_mapping.json`: 실제 셀 위치 반영

---

### Phase 3: 템플릿 경로 변경 (1-2시간) ✅ **완료**

#### 2.1 TemplateDesign 클래스 수정 ✅

**파일**: `payroll_generator/templates/designs/template_design.py`

**변경사항**:
- `_get_template_path()` 메서드 수정
- `sample` 폴더 경로 추가
- 경로 해결 로직 개선 (Path 객체 사용)
- 에러 처리 강화

**구현 예시**:
```python
def _get_template_path(self):
    """템플릿 파일 경로 찾기
    
    우선순위:
    1. sample 폴더의 실제 템플릿 파일
    2. PyInstaller 환경의 리소스 경로
    3. 개발 환경의 템플릿 파일
    
    Returns:
        str: 템플릿 파일의 절대 경로
        
    Raises:
        FileNotFoundError: 모든 경로에서 파일을 찾을 수 없는 경우
    """
    paths_to_try = []
    
    # 템플릿 파일명 매핑
    template_mapping = {
        'template_sample1.xlsx': '급여명세서_template.xlsx',
        'template_sample2.xlsx': '임금명세서양식_template3.xlsx'
    }
    
    # 실제 템플릿 파일명 가져오기
    actual_filename = template_mapping.get(
        self.template_filename, 
        self.template_filename
    )
    
    # 1. sample 폴더 경로 (우선순위 1)
    try:
        # 현재 파일의 위치에서 프로젝트 루트 찾기
        current_file = Path(__file__).resolve()
        # template_design.py -> designs/ -> templates/ -> payroll_generator/ -> 프로젝트 루트
        project_root = current_file.parent.parent.parent.parent
        sample_path = project_root / 'sample' / actual_filename
        
        if sample_path.exists():
            logger.info(f"[템플릿 경로] sample 폴더에서 찾음: {sample_path}")
            return str(sample_path)
        else:
            logger.debug(f"[템플릿 경로] sample 폴더에 없음: {sample_path}")
            paths_to_try.append(str(sample_path))
    except Exception as e:
        logger.warning(f"[템플릿 경로] sample 폴더 경로 해결 실패: {e}")
    
    # 2. PyInstaller 환경 (우선순위 2)
    try:
        from ..utils import resource_path
        pyinstaller_path = resource_path(
            f'templates/designs/{self.template_filename}'
        )
        if os.path.exists(pyinstaller_path):
            logger.info(f"[템플릿 경로] PyInstaller 리소스에서 찾음: {pyinstaller_path}")
            return pyinstaller_path
        paths_to_try.append(pyinstaller_path)
    except ImportError:
        try:
            from payroll_generator.utils import resource_path
            pyinstaller_path = resource_path(
                f'templates/designs/{self.template_filename}'
            )
            if os.path.exists(pyinstaller_path):
                logger.info(f"[템플릿 경로] PyInstaller 리소스에서 찾음: {pyinstaller_path}")
                return pyinstaller_path
            paths_to_try.append(pyinstaller_path)
        except ImportError:
            logger.debug("[템플릿 경로] resource_path 유틸리티를 찾을 수 없음")
    
    # 3. 개발 환경 (우선순위 3)
    dev_path = os.path.join(
        os.path.dirname(__file__), self.template_filename
    )
    if os.path.exists(dev_path):
        logger.info(f"[템플릿 경로] 개발 환경에서 찾음: {dev_path}")
        return dev_path
    paths_to_try.append(dev_path)
    
    # 모든 경로 실패
    error_msg = (
        f"템플릿 파일을 찾을 수 없습니다: {self.template_filename}\n"
        f"시도한 경로:\n" + "\n".join(f"  - {p}" for p in paths_to_try) + "\n"
        f"해결 방법:\n"
        f"  1. sample 폴더에 '{actual_filename}' 파일이 있는지 확인하세요.\n"
        f"  2. 또는 payroll_generator/templates/designs/ 폴더에 '{self.template_filename}' 파일이 있는지 확인하세요."
    )
    logger.error(error_msg)
    raise FileNotFoundError(error_msg)
```

#### 2.2 테스트 및 검증

**단위 테스트**:
```python
# tests/test_template_path.py (신규 생성)
import unittest
import os
import tempfile
from pathlib import Path
from payroll_generator.templates.designs.template_sample1 import TemplateSample1

class TestTemplatePath(unittest.TestCase):
    def test_template_path_resolution(self):
        """템플릿 경로 해결 테스트"""
        design = TemplateSample1()
        template_path = design._get_template_path()
        
        self.assertTrue(os.path.exists(template_path), 
                       f"템플릿 파일이 존재하지 않습니다: {template_path}")
        self.assertTrue(template_path.endswith('.xlsx'),
                       f"템플릿 파일 확장자가 올바르지 않습니다: {template_path}")
    
    def test_sample_folder_priority(self):
        """sample 폴더 우선순위 테스트"""
        design = TemplateSample1()
        template_path = design._get_template_path()
        
        # sample 폴더에서 찾았는지 확인
        self.assertIn('sample', template_path.lower() or '', 
                     "sample 폴더에서 템플릿을 찾지 못했습니다.")
```

**수동 테스트**:
- [x] 개발 환경에서 템플릿 경로 찾기 테스트 ✅
- [ ] PyInstaller 빌드 후 템플릿 경로 찾기 테스트 (추후 테스트 필요)
- [x] sample 폴더에 파일이 없을 때 폴백 경로 테스트 ✅
- [x] 모든 경로에 파일이 없을 때 에러 메시지 확인 ✅

---

### Phase 4: PDF 생성 개선 (2-3시간)

#### 3.1 엑셀→PDF 변환 방법 선택

**옵션 1: 엑셀 파일을 PDF로 직접 변환** (권장)
- **장점**: 템플릿의 모든 스타일, 레이아웃 유지
- **단점**: 외부 라이브러리 필요 (예: `xlsx2pdf`, `LibreOffice`, `COM 객체`)

**옵션 2: 엑셀 스타일을 reportlab으로 재현**
- **장점**: 순수 Python, 외부 의존성 없음
- **단점**: 복잡한 레이아웃 재현 어려움

**권장 방법**: 옵션 1 (엑셀→PDF 직접 변환)

#### 3.2 PDF 변환 라이브러리 선택 및 검증

**후보 라이브러리 분석**:

1. **`xlsx2pdf`** ⚠️
   - **장점**: 크로스 플랫폼, pip 설치 가능
   - **단점**: 문서화 부족, 최근 업데이트 제한적, 모든 Excel 기능 미지원 가능성
   - **검증 필요**: 실제 설치 및 테스트 필수

2. **`LibreOffice` (명령줄)** ✅ 권장
   - **장점**: 무료, 오픈소스, Excel 기능 대부분 지원, 안정적
   - **단점**: 시스템에 LibreOffice 설치 필요
   - **사용법**: `subprocess`로 명령줄 호출

3. **`win32com` (Windows만)**
   - **장점**: Excel 설치 시 완벽한 호환성
   - **단점**: Windows 전용, Excel 설치 필수

4. **`exc-to-pdf`** (대안)
   - **장점**: 최근 라이브러리, AI 분석 최적화
   - **단점**: 상대적으로 덜 알려짐

**권장 접근법**: 다중 폴백 전략
1. **1차 시도**: LibreOffice (가장 안정적)
2. **2차 시도**: xlsx2pdf (설치되어 있는 경우)
3. **3차 시도**: Windows 환경에서 win32com
4. **최종 폴백**: 기본 PDF 생성 (reportlab)

**검증 절차**:
```bash
# 1. xlsx2pdf 설치 및 테스트
pip install xlsx2pdf
python -c "from xlsx2pdf import convert_xlsx_to_pdf; print('OK')"

# 2. LibreOffice 설치 확인
libreoffice --version  # Linux/Mac
# Windows: C:\Program Files\LibreOffice\program\soffice.exe --version
```

#### 3.3 TemplateDesign.generate_pdf() 메서드 구현

**파일**: `payroll_generator/templates/designs/template_design.py`

**주의사항**:
- 현재 코드에 이미 `generate_pdf()` 메서드가 구현되어 있음
- 기존 구현을 확인하고 개선하는 방식으로 접근
- 다중 폴백 전략 적용

**구현 전략**:

**1단계: 기존 코드 확인**
```bash
# 현재 구현 확인
grep -A 50 "def generate_pdf" payroll_generator/templates/designs/template_design.py
```

**2단계: 개선된 구현** (다중 폴백 전략)
```python
def generate_pdf(self, payroll_data, employee_data, output_path, period):
    """템플릿 기반 PDF 생성 (엑셀→PDF 변환)
    
    다중 폴백 전략:
    1. LibreOffice (가장 안정적)
    2. xlsx2pdf (설치되어 있는 경우)
    3. win32com (Windows만)
    4. 기본 PDF 생성 (최종 폴백)
    """
    import tempfile
    import os
    import shutil
    import platform
    
    # 1. 임시 엑셀 파일 생성
    temp_excel_path = None
    temp_dir = None
    
    try:
        # 임시 디렉토리 생성 (LibreOffice 출력용)
        temp_dir = tempfile.mkdtemp()
        temp_excel_path = os.path.join(temp_dir, 'temp_payroll.xlsx')
        
        # 2. 템플릿 기반 엑셀 생성
        logger.info(f"[템플릿 PDF] 엑셀 파일 생성 중: {temp_excel_path}")
        self.generate_excel(payroll_data, employee_data, temp_excel_path, period)
        
        if not os.path.exists(temp_excel_path):
            raise FileNotFoundError(f"엑셀 파일 생성 실패: {temp_excel_path}")
        
        # 3. 엑셀→PDF 변환 (다중 폴백)
        
        # 방법 1: LibreOffice (권장)
        if self._convert_with_libreoffice(temp_excel_path, output_path, temp_dir):
            logger.info(f"[템플릿 PDF] LibreOffice로 PDF 생성 완료: {output_path}")
            return output_path
        
        # 방법 2: xlsx2pdf
        if self._convert_with_xlsx2pdf(temp_excel_path, output_path):
            logger.info(f"[템플릿 PDF] xlsx2pdf로 PDF 생성 완료: {output_path}")
            return output_path
        
        # 방법 3: win32com (Windows만)
        if platform.system() == 'Windows':
            if self._convert_with_win32com(temp_excel_path, output_path):
                logger.info(f"[템플릿 PDF] win32com으로 PDF 생성 완료: {output_path}")
                return output_path
        
        # 방법 4: 폴백 - 기본 PDF 생성
        logger.warning("[템플릿 PDF] 모든 변환 방법 실패. 기본 PDF 생성 방식 사용")
        return self._fallback_to_default_pdf(payroll_data, employee_data, output_path, period)
        
    except Exception as e:
        logger.error(f"[템플릿 PDF] PDF 생성 실패: {e}", exc_info=True)
        return self._fallback_to_default_pdf(payroll_data, employee_data, output_path, period)
    
    finally:
        # 임시 파일 정리
        if temp_excel_path and os.path.exists(temp_excel_path):
            try:
                os.remove(temp_excel_path)
            except Exception as e:
                logger.warning(f"임시 엑셀 파일 삭제 실패: {e}")
        
        if temp_dir and os.path.exists(temp_dir):
            try:
                shutil.rmtree(temp_dir)
            except Exception as e:
                logger.warning(f"임시 디렉토리 삭제 실패: {e}")

def _convert_with_libreoffice(self, excel_path, pdf_path, output_dir):
    """LibreOffice를 사용한 엑셀→PDF 변환"""
    import subprocess
    import platform
    
    try:
        # LibreOffice 실행 파일 경로 찾기
        if platform.system() == 'Windows':
            libreoffice_cmd = r'C:\Program Files\LibreOffice\program\soffice.exe'
        elif platform.system() == 'Darwin':  # macOS
            libreoffice_cmd = '/Applications/LibreOffice.app/Contents/MacOS/soffice'
        else:  # Linux
            libreoffice_cmd = 'libreoffice'
        
        # 명령 실행
        result = subprocess.run(
            [
                libreoffice_cmd,
                '--headless',
                '--convert-to', 'pdf',
                '--outdir', output_dir,
                excel_path
            ],
            capture_output=True,
            timeout=30,
            check=False
        )
        
        if result.returncode == 0:
            # 출력 파일 이름은 입력 파일과 동일하지만 확장자만 .pdf
            expected_pdf = os.path.join(output_dir, 'temp_payroll.pdf')
            if os.path.exists(expected_pdf):
                shutil.move(expected_pdf, pdf_path)
                return True
        
        return False
    except (subprocess.TimeoutExpired, FileNotFoundError, Exception) as e:
        logger.debug(f"LibreOffice 변환 실패: {e}")
        return False

def _convert_with_xlsx2pdf(self, excel_path, pdf_path):
    """xlsx2pdf를 사용한 엑셀→PDF 변환"""
    try:
        # xlsx2pdf의 실제 API 확인 필요
        # 버전에 따라 API가 다를 수 있음
        try:
            from xlsx2pdf import convert_xlsx_to_pdf
            convert_xlsx_to_pdf(excel_path, pdf_path)
            return os.path.exists(pdf_path)
        except ImportError:
            try:
                # 다른 버전의 API 시도
                from xlsx2pdf import convert
                convert(excel_path, pdf_path)
                return os.path.exists(pdf_path)
            except ImportError:
                return False
    except Exception as e:
        logger.debug(f"xlsx2pdf 변환 실패: {e}")
        return False

def _convert_with_win32com(self, excel_path, pdf_path):
    """win32com을 사용한 엑셀→PDF 변환 (Windows만)"""
    try:
        import win32com.client
        excel = win32com.client.Dispatch("Excel.Application")
        excel.Visible = False
        excel.DisplayAlerts = False
        
        workbook = excel.Workbooks.Open(os.path.abspath(excel_path))
        workbook.ExportAsFixedFormat(0, os.path.abspath(pdf_path))  # 0 = PDF
        workbook.Close(False)
        excel.Quit()
        
        return os.path.exists(pdf_path)
    except Exception as e:
        logger.debug(f"win32com 변환 실패: {e}")
        return False

def _fallback_to_default_pdf(self, payroll_data, employee_data, output_path, period):
    """기본 PDF 생성 방식으로 폴백"""
    try:
        from ...pdf_generator import PDFGenerator
        pdf_gen = PDFGenerator()
        return pdf_gen.generate_payslip(
            payroll_data, employee_data, output_path, period,
            use_template=False, design_name=None
        )
    except Exception as e:
        logger.error(f"기본 PDF 생성도 실패: {e}", exc_info=True)
        raise
```

#### 3.4 의존성 추가 및 관리

**파일**: `requirements.txt`, `requirements-web.txt`

**선택적 의존성 추가** (폴백 전략으로 필수 아님):
```txt
# 엑셀→PDF 변환 (선택사항, 폴백 전략 사용)
# xlsx2pdf>=0.1.0  # 주석 처리: 안정성 검증 후 활성화
```

**주의사항**:
- `xlsx2pdf`는 선택적 의존성으로 관리 (폴백 전략 사용)
- LibreOffice는 시스템 레벨 설치 필요 (requirements.txt에 포함 불가)
- `win32com`은 Windows 전용 (requirements.txt에 조건부 추가 가능)

**의존성 관리 전략**:
```python
# payroll_generator/templates/designs/template_design.py 상단에 추가
try:
    import xlsx2pdf
    HAS_XLSX2PDF = True
except ImportError:
    HAS_XLSX2PDF = False

try:
    import win32com.client
    HAS_WIN32COM = True
except ImportError:
    HAS_WIN32COM = False
```

**설치 가이드 문서화**:
- README에 LibreOffice 설치 방법 추가
- xlsx2pdf는 선택사항으로 명시

#### 3.5 테스트 및 검증

**단위 테스트**:
```python
# tests/test_template_pdf_generation.py (신규 생성)
import unittest
import tempfile
import os
from payroll_generator.templates.designs.template_sample1 import TemplateSample1

class TestTemplatePDFGeneration(unittest.TestCase):
    def setUp(self):
        self.design = TemplateSample1()
        self.sample_payroll_data = {
            '기본급': 3000000,
            '총지급액': 3000000,
            '국민연금': 135000,
            '건강보험': 106350,
            '총공제액': 300000,
            '실수령액': 2700000
        }
        self.sample_employee_data = {
            '이름': '홍길동',
            '주민번호': '123456-1234567',
            '입사일': '2020-01-01'
        }
    
    def test_pdf_generation_with_libreoffice(self):
        """LibreOffice를 사용한 PDF 생성 테스트"""
        with tempfile.NamedTemporaryFile(suffix='.pdf', delete=False) as tmp:
            pdf_path = tmp.name
        
        try:
            result = self.design.generate_pdf(
                self.sample_payroll_data,
                self.sample_employee_data,
                pdf_path,
                '2025-01'
            )
            
            self.assertTrue(os.path.exists(pdf_path), 
                           "PDF 파일이 생성되지 않았습니다.")
            self.assertGreater(os.path.getsize(pdf_path), 0,
                             "PDF 파일이 비어있습니다.")
        finally:
            if os.path.exists(pdf_path):
                os.remove(pdf_path)
    
    def test_pdf_generation_fallback(self):
        """폴백 메커니즘 테스트"""
        # 변환 라이브러리가 없는 환경 시뮬레이션
        # (실제로는 모든 변환 방법이 실패할 때)
        # 기본 PDF 생성으로 폴백되는지 확인
        pass
```

**통합 테스트**:
- [ ] LibreOffice 설치 환경에서 PDF 생성 테스트
- [ ] xlsx2pdf만 설치된 환경에서 PDF 생성 테스트
- [ ] 변환 라이브러리가 없는 환경에서 폴백 테스트
- [ ] 생성된 PDF 파일 열기 및 내용 확인
- [ ] 여러 직원 데이터로 일괄 PDF 생성 테스트
- [ ] 메모리 누수 확인 (임시 파일 정리)

**성능 테스트**:
- [ ] PDF 생성 시간 측정 (목표: 5초 이내)
- [ ] 동시 다중 PDF 생성 테스트
- [ ] 대용량 템플릿 파일 처리 테스트

---

### Phase 5: 사용자 인터페이스 개선 (1-2시간)

#### 5.1 웹 인터페이스

**파일**: `web/templates/payroll/input_form.html`, `web/templates/payroll/multiple_input.html`

**변경사항**:
- 템플릿 디자인 선택 옵션 확인 (Phase 0에서 이미 제거됨)
- 디자인 설명 업데이트

**구현 예시**:
```html
<!-- Phase 0에서 이미 design_1, design_2 제거됨 -->
<!-- template_sample1, template_sample2만 남아있음 -->
<div class="card design-card h-100" data-design="template_sample1" ...>
    <div class="card-body">
        <h5 class="card-title">급여명세서 템플릿</h5>
        <p class="card-text">sample 폴더의 엑셀 템플릿을 사용합니다.</p>
    </div>
</div>
<div class="card design-card h-100" data-design="template_sample2" ...>
    <div class="card-body">
        <h5 class="card-title">임금명세서 템플릿</h5>
        <p class="card-text">sample 폴더의 엑셀 템플릿을 사용합니다.</p>
    </div>
</div>
```

#### 5.2 데스크톱 인터페이스

**파일**: `main.py`

**변경사항**:
- 디자인 선택 Combobox 확인 (Phase 0에서 이미 수정됨)
- 디자인 설명 업데이트

**구현 예시**:
```python
# Phase 0에서 이미 수정됨
design_options = ['default', 'template_sample1', 'template_sample2']
design_combobox = ttk.Combobox(..., values=design_options, state="readonly")
```

#### 5.3 테스트
- [ ] 웹 인터페이스에서 템플릿 선택 테스트
- [ ] 데스크톱 인터페이스에서 템플릿 선택 테스트
- [ ] design_1, design_2 옵션이 완전히 제거되었는지 확인

---

### Phase 6: 통합 테스트 및 검증 (2-3시간)

#### 5.1 기능 테스트
- [ ] 템플릿 1 엑셀 생성 테스트
- [ ] 템플릿 2 엑셀 생성 테스트
- [ ] 템플릿 1 PDF 생성 테스트
- [ ] 템플릿 2 PDF 생성 테스트
- [ ] 웹 인터페이스 통합 테스트
- [ ] 데스크톱 인터페이스 통합 테스트

#### 5.2 에러 처리 테스트
- [ ] 템플릿 파일 없을 때 폴백 테스트
- [ ] 매핑 파일 없을 때 폴백 테스트
- [ ] xlsx2pdf 미설치 시 폴백 테스트

#### 5.3 출력 파일 검증
- [ ] 생성된 엑셀 파일 구조 검증
- [ ] 생성된 PDF 파일 구조 검증
- [ ] 데이터 정확성 검증

---

### Phase 7: 문서화 및 정리 (1시간)

#### 6.1 문서 업데이트
- [ ] README.md 업데이트 (템플릿 디자인 설명 추가)
- [ ] 사용자 매뉴얼 업데이트
- [ ] 개발자 문서 업데이트

#### 6.2 코드 정리
- [ ] 불필요한 코드 제거
- [ ] 주석 추가
- [ ] 로깅 개선

---

## 🛠️ 기술적 구현 상세

### 1. 템플릿 경로 매핑

**매핑 테이블**:
```python
TEMPLATE_MAPPING = {
    'template_sample1': {
        'filename': '급여명세서_template.xlsx',
        'description': '급여명세서 템플릿'
    },
    'template_sample2': {
        'filename': '임금명세서양식_template3.xlsx',
        'description': '임금명세서 템플릿'
    }
}
```

### 2. 엑셀→PDF 변환

**다중 폴백 전략 구현**:

**LibreOffice 사용 예시** (1차, 권장):
```python
import subprocess
import platform
import os

def convert_with_libreoffice(excel_path, pdf_path, output_dir):
    """LibreOffice를 사용한 엑셀→PDF 변환"""
    # 플랫폼별 실행 파일 경로
    if platform.system() == 'Windows':
        cmd = r'C:\Program Files\LibreOffice\program\soffice.exe'
    elif platform.system() == 'Darwin':  # macOS
        cmd = '/Applications/LibreOffice.app/Contents/MacOS/soffice'
    else:  # Linux
        cmd = 'libreoffice'
    
    # 변환 실행
    result = subprocess.run(
        [cmd, '--headless', '--convert-to', 'pdf', 
         '--outdir', output_dir, excel_path],
        capture_output=True,
        timeout=30,
        check=False
    )
    
    return result.returncode == 0
```

**xlsx2pdf 사용 예시** (2차, 선택사항):
```python
# 주의: xlsx2pdf의 API는 버전에 따라 다를 수 있음
try:
    from xlsx2pdf import convert_xlsx_to_pdf
    convert_xlsx_to_pdf('input.xlsx', 'output.pdf')
except ImportError:
    try:
        from xlsx2pdf import convert
        convert('input.xlsx', 'output.pdf')
    except ImportError:
        # 폴백
        pass
```

**win32com 사용 예시** (3차, Windows만):
```python
import win32com.client

excel = win32com.client.Dispatch("Excel.Application")
excel.Visible = False
workbook = excel.Workbooks.Open(excel_path)
workbook.ExportAsFixedFormat(0, pdf_path)  # 0 = PDF
workbook.Close(False)
excel.Quit()
```

### 3. 에러 처리 및 폴백

**폴백 순서**:
1. 템플릿 파일 찾기 실패 → 기본 디자인 사용
2. 매핑 파일 없음 → 기본 매핑 사용
3. 엑셀 생성 실패 → 기본 엑셀 생성
4. PDF 변환 실패 → 기본 PDF 생성

---

## 🧪 테스트 계획

### 단위 테스트

1. **템플릿 경로 찾기 테스트**
   - `sample` 폴더에서 템플릿 찾기
   - 폴백 경로 테스트

2. **셀 매핑 테스트**
   - 매핑 파일 로드 테스트
   - 데이터 채우기 테스트

3. **엑셀 생성 테스트**
   - 템플릿 기반 엑셀 생성
   - 데이터 정확성 검증

4. **PDF 생성 테스트**
   - 엑셀→PDF 변환 테스트
   - 폴백 메커니즘 테스트

### 통합 테스트

1. **웹 인터페이스 통합 테스트**
   - 템플릿 선택 → 엑셀 생성
   - 템플릿 선택 → PDF 생성

2. **데스크톱 인터페이스 통합 테스트**
   - 템플릿 선택 → 엑셀 생성
   - 템플릿 선택 → PDF 생성

### 사용자 시나리오 테스트

1. **시나리오 1: 급여명세서 템플릿 사용**
   - 웹에서 `template_sample1` 선택
   - 엑셀/PDF 생성 확인
   - 출력 파일 구조 검증

2. **시나리오 2: 임금명세서 템플릿 사용**
   - 웹에서 `template_sample2` 선택
   - 엑셀/PDF 생성 확인
   - 출력 파일 구조 검증

---

## ⏱️ 예상 소요 시간

| Phase | 작업 내용 | 예상 시간 |
|-------|----------|----------|
| Phase 0 | YAML 기반 디자인 삭제 및 코드 정리 | 2-3시간 | ✅ **완료** |
| Phase 1 | 준비 작업 | 1-2시간 | ✅ **완료** |
| Phase 2 | 템플릿 분석 및 매핑 업데이트 | 2-3시간 | ✅ **완료** |
| Phase 3 | 템플릿 경로 변경 | 1-2시간 | ✅ **완료** |
| Phase 4 | PDF 생성 개선 | 2-3시간 |
| Phase 5 | 사용자 인터페이스 개선 | 1-2시간 |
| Phase 6 | 통합 테스트 및 검증 | 2-3시간 |
| Phase 7 | 문서화 및 정리 | 1시간 |
| **총계** | | **12-19시간** |

---

## 📋 체크리스트

### Phase 0: YAML 기반 디자인 삭제 및 코드 정리 ✅ **완료**
- [x] DesignFactory에서 design_1, design_2 제거 ✅
- [x] 웹 인터페이스에서 design_1, design_2 제거 (input_form.html, multiple_input.html) ✅
- [x] 데스크톱 인터페이스에서 design_1, design_2 제거 (main.py) ✅
- [x] 관련 파일 삭제 (design_1.py, design_2.py, design_1.yaml, design_2.yaml) ✅
- [x] 코드 문서 및 주석 업데이트 (excel_handler.py, pdf_generator.py) ✅
- [x] 에러 처리 및 폴백 로직 추가 ✅
- [x] 웹 라우트에서 design_1, design_2 검증 제거 ✅
- [x] 테스트 파일 정리 (test_template_design.py 등) ✅
- [ ] README 및 문서 업데이트 (선택사항)
- [x] 테스트 및 검증 ✅

### Phase 1: 준비 작업 ✅ **완료**
- [x] 템플릿 파일 확인 ✅
- [x] 템플릿 분석 스크립트 확인 ✅
- [x] Git 브랜치 생성 ✅

### Phase 2: 템플릿 분석 및 매핑 업데이트 ✅ **완료**
- [x] 템플릿 1 분석 실행 ✅
- [x] 템플릿 2 분석 실행 ✅
- [x] 매핑 파일 검증 및 수정 ✅
- [x] 추가 필드 매핑 (template1 헤더 필드 추가) ✅

### Phase 3: 템플릿 경로 변경 ✅ **완료**
- [x] TemplateDesign._get_template_path() 수정 ✅
- [x] 템플릿 경로 찾기 테스트 ✅
- [x] 템플릿 로드 테스트 ✅

### Phase 4: PDF 생성 개선 ✅ **완료**
- [x] PDF 변환 라이브러리 선택 및 설치 ✅ (LibreOffice 설치 확인 완료)
- [x] TemplateDesign.generate_pdf() 구현 ✅ (xlsx2pdf 제거, LibreOffice 우선 사용)
- [x] 의존성 추가 ✅ (LibreOffice 사용, xlsx2pdf 제거)
- [x] 엑셀→PDF 변환 테스트 ✅ (Template1, Template2 모두 성공)
- [x] 폴백 메커니즘 테스트 ✅ (에러 처리 개선 완료)

### Phase 5: 사용자 인터페이스 개선 ✅ **완료**
- [x] 웹 인터페이스 확인 ✅ (Phase 0에서 이미 수정됨)
- [x] 데스크톱 인터페이스 확인 ✅ (Phase 0에서 이미 수정됨)
- [x] 템플릿 선택 테스트 ✅
- [x] 소속/직급 필드 입력 지원 ✅ (웹 인터페이스)

### Phase 6: 통합 테스트 및 검증 ✅ **완료**
- [x] 기능 테스트 ✅ (Template1/Template2 엑셀/PDF 생성 테스트 통과)
- [x] 에러 처리 테스트 ✅ (잘못된 디자인, design_1/2 폴백 테스트 통과)
- [x] 출력 파일 검증 ✅ (파일 생성 및 크기 확인)
- [x] design_1, design_2 제거 확인 ✅ (DesignFactory 테스트 통과)

### Phase 7: 문서화 및 정리 ✅ **완료**
- [x] README.md 업데이트 ✅ (템플릿 디자인 사용 방법, LibreOffice 설치 가이드 추가)
- [ ] 사용자 매뉴얼 업데이트 (선택사항)
- [ ] 코드 정리 (선택사항)

---

## 🔧 추가 개선 작업 (Phase 7 이후)

### Template1 UI/UX 개선 ✅ **완료**

#### 주민번호 표시 형식 수정 ✅
- [x] 주민번호를 "주민번호 : 123456-*******" 형식으로 표시하도록 수정 ✅
- [x] 지급내역, 공제내역과 동일한 형식으로 통일 ✅
- [x] 테스트 및 검증 ✅
- [x] 보고서 작성 ✅ (`Template1_주민번호_표시_형식_수정_보고서.md`)

#### 합계 섹션 수정 ✅
- [x] 지급합계, 공제합계, 실지급액이 음영 박스에 올바르게 표시되도록 수정 ✅
- [x] 매핑 파일 수정 (G23→H23, G24→H24) ✅
- [x] 병합 셀 처리 로직에서 합계 항목 제외 ✅
- [x] 테스트 및 검증 ✅
- [x] 보고서 작성 ✅ (`Template1_합계_섹션_수정_보고서.md`)

#### 페이지 레이아웃 수정 ✅
- [x] 한 페이지에 맞추도록 페이지 설정 추가 ✅
- [x] 여백 최소화 (0.2인치) ✅
- [x] fitToWidth=1, fitToHeight=1 설정 ✅
- [x] 인쇄 영역 설정 (B1:H28) ✅
- [x] 테스트 및 검증 ✅
- [x] 보고서 작성 ✅ (`Template1_페이지_레이아웃_수정_보고서.md`)

---

## 🚨 주의사항

### 1. 하위 호환성 유지
- `design_1`, `design_2`는 완전히 제거됨 (더 이상 사용 불가)
- 기본 디자인(`default`)은 계속 작동해야 함
- 템플릿 디자인(`template_sample1`, `template_sample2`)만 사용 가능
- 기존 코드에서 `design_1`, `design_2`를 참조하는 경우:
  - 경고 메시지 로깅
  - 기본 디자인으로 자동 폴백
  - 사용자에게 친화적인 에러 메시지 표시 (선택사항)

### 2. 에러 처리
- `design_1`, `design_2` 선택 시:
  - 경고 메시지 로깅 (`logger.warning()`)
  - 기본 디자인으로 자동 폴백
  - 사용자에게 친화적인 메시지 표시 (선택사항)
- 템플릿 파일을 찾을 수 없을 때 폴백
- PDF 변환 실패 시 폴백
- 매핑 파일 없을 때 기본 매핑 사용
- 모든 에러는 로깅하고 사용자에게 친화적인 메시지 표시

### 3. 성능 및 리소스 관리
- 템플릿 파일은 한 번만 로드하고 캐싱 (싱글톤 패턴 사용 중)
- PDF 변환 시 임시 파일 즉시 삭제 (메모리 누수 방지)
- LibreOffice 프로세스 타임아웃 설정 (30초)
- 대용량 파일 처리 시 메모리 사용량 모니터링
- PDF 변환은 비동기 처리 고려 (선택사항, 향후 개선)

### 4. 롤백 계획
- 각 Phase별로 Git 커밋하여 롤백 가능하도록 유지
- Phase 0 완료 후 기본 기능 테스트 필수
- 문제 발생 시 `git reset --hard <이전_커밋>`으로 롤백
- 주요 변경사항은 별도 브랜치에서 작업

### 5. 코드 리뷰 체크리스트
- [ ] 에러 처리: 모든 예외 상황 처리
- [ ] 로깅: 충분한 로그 메시지 (DEBUG, INFO, WARNING, ERROR)
- [ ] 타입 힌트: 함수 시그니처에 타입 힌트 추가
- [ ] docstring: 모든 public 메서드에 docstring 추가
- [ ] 테스트 커버리지: 핵심 로직 80% 이상 커버리지
- [ ] 코드 스타일: PEP 8 준수, linter 통과

---

## 📚 참고 자료

### 관련 문서
- `plan/2025-12-12/sample_엑셀_템플릿_분석_보고서.md`: 템플릿 분석 보고서
- `plan/2025-12-12/템플릿_디자인_근본_원인_분석.md`: 템플릿 디자인 문제 분석
- `scripts/analyze_template_cells.py`: 템플릿 분석 스크립트

### 외부 라이브러리
- `xlsx2pdf`: https://pypi.org/project/xlsx2pdf/
- `openpyxl`: https://openpyxl.readthedocs.io/

---

---

## 🔧 프로 개발자 체크리스트

### 코드 품질
- [ ] 모든 함수에 타입 힌트 추가
- [ ] 모든 public 메서드에 docstring 추가
- [ ] 에러 메시지가 명확하고 사용자 친화적인지 확인
- [ ] 로깅 레벨이 적절한지 확인 (DEBUG, INFO, WARNING, ERROR)
- [ ] 코드 중복 제거 (DRY 원칙)
- [ ] 매직 넘버/문자열 상수로 추출

### 테스트
- [ ] 단위 테스트 작성 (핵심 로직)
- [ ] 통합 테스트 작성 (전체 플로우)
- [ ] 엣지 케이스 테스트 (에러 상황)
- [ ] 테스트 커버리지 80% 이상 목표

### 성능
- [ ] 불필요한 파일 I/O 최소화
- [ ] 메모리 누수 확인 (임시 파일 정리)
- [ ] 대용량 파일 처리 테스트
- [ ] 동시 요청 처리 테스트

### 보안
- [ ] 파일 경로 검증 (경로 탐색 공격 방지)
- [ ] 사용자 입력 검증
- [ ] 임시 파일 권한 설정

### 문서화
- [ ] README 업데이트
- [ ] API 문서 업데이트
- [ ] 변경 로그 작성
- [ ] 마이그레이션 가이드 작성 (필요 시)

---

**작성자**: AI Assistant  
**작성일**: 2025-12-15  
**업데이트일**: 2025-12-15 (프로 개발자 관점 개선)  
**상태**: ✅ 실행계획 작성 완료 (프로 개발자 검증 완료)
