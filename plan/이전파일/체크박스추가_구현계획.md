# 📋 미리보기 체크박스 추가 구현 계획

**작성일**: 2025-11-11  
**요청 사항**: 미리보기 파일에서 이름 앞에 체크박스를 넣어서 체크를 더 직관적으로 할 수 있게 하기

---

## 📊 현재 상태 분석

### ✅ 현재 구현된 기능

1. **미리보기 트리뷰**
   - `ttk.Treeview`로 구현됨
   - 이름, 주민번호, 입사일, 기본급 컬럼 표시
   - `selectmode='extended'`로 다중 선택 가능
   - Treeview의 기본 선택 기능 사용 (파란색 하이라이트)

2. **선택 기능**
   - 개별 선택 (마우스 클릭)
   - 다중 선택 (Ctrl+클릭, Shift+클릭)
   - 전체 선택/해제 버튼
   - 선택 상태 표시 라벨

### ❌ 현재 미구현 기능

1. **체크박스 시각적 표시**
   - 이름 앞에 체크박스 아이콘 없음
   - 선택 상태를 체크박스로 표시하지 않음

---

## 🎯 구현 목표

### 주요 목표

1. **체크박스 아이콘 추가**
   - 이름 컬럼 앞에 체크박스 컬럼 추가
   - 체크박스 아이콘: ☐ (체크 안됨), ☒ (체크됨)
   - 선택 상태에 따라 체크박스 아이콘 자동 업데이트

2. **체크박스 클릭 기능**
   - 체크박스 클릭 시 선택/해제 토글
   - 체크박스 상태와 Treeview 선택 상태 동기화

3. **기존 기능 유지**
   - 기존 선택 기능 (개별/다중/전체 선택) 유지
   - 체크박스와 선택 상태 완전 동기화

---

## 📋 구현 계획

### 1. Treeview 컬럼 구조 변경

#### 1.1 체크박스 컬럼 추가

**현재 코드**:
```python
columns = ('이름', '주민번호', '입사일', '기본급')
```

**변경 후**:
```python
columns = ('체크', '이름', '주민번호', '입사일', '기본급')
```

#### 1.2 체크박스 컬럼 설정

```python
# 체크박스 컬럼 설정
self.preview_tree.heading('체크', text='')
self.preview_tree.column('체크', width=30, anchor='center')
```

**설정 사항**:
- 컬럼 너비: 30px (체크박스 아이콘만 표시)
- 정렬: 중앙 정렬
- 헤더 텍스트: 빈 문자열 (체크박스만 표시)

---

### 2. 데이터 삽입 시 체크박스 아이콘 추가

#### 2.1 체크박스 아이콘 상수 정의

```python
# 체크박스 아이콘
CHECKBOX_UNCHECKED = '☐'  # 체크 안됨
CHECKBOX_CHECKED = '☒'    # 체크됨
```

#### 2.2 load_preview 메서드 수정

**현재 코드**:
```python
for row in preview_data:
    values = (
        str(row.get('이름', '')),
        mask_resident_number(str(row.get('주민번호', ''))),
        str(row.get('입사일', '')),
        f"{row.get('기본급', 0):,}"
    )
    self.preview_tree.insert('', tk.END, values=values)
```

**변경 후**:
```python
for row in preview_data:
    values = (
        CHECKBOX_UNCHECKED,  # 체크박스 아이콘 (초기값: 체크 안됨)
        str(row.get('이름', '')),
        mask_resident_number(str(row.get('주민번호', ''))),
        str(row.get('입사일', '')),
        f"{row.get('기본급', 0):,}"
    )
    self.preview_tree.insert('', tk.END, values=values)
```

---

### 3. 체크박스 클릭 이벤트 처리

#### 3.1 클릭 이벤트 바인딩

```python
# 체크박스 클릭 이벤트 바인딩
self.preview_tree.bind('<Button-1>', self.on_treeview_click)
```

#### 3.2 클릭 이벤트 핸들러 구현

```python
def on_treeview_click(self, event):
    """Treeview 클릭 이벤트 처리 (체크박스 클릭 감지)"""
    region = self.preview_tree.identify_region(event.x, event.y)
    
    # 클릭한 영역이 셀인 경우
    if region == 'cell':
        column = self.preview_tree.identify_column(event.x)
        item = self.preview_tree.identify_row(event.y)
        
        # 체크박스 컬럼(첫 번째 컬럼)을 클릭한 경우
        if column == '#1' and item:
            # 현재 선택 상태 확인
            is_selected = item in self.preview_tree.selection()
            
            if is_selected:
                # 선택 해제
                self.preview_tree.selection_remove(item)
                # 체크박스 아이콘 업데이트
                self.update_checkbox(item, False)
            else:
                # 선택 추가
                self.preview_tree.selection_add(item)
                # 체크박스 아이콘 업데이트
                self.update_checkbox(item, True)
            
            # 선택 상태 라벨 업데이트
            self.on_selection_change()
```

---

### 4. 체크박스 아이콘 업데이트 메서드

#### 4.1 update_checkbox 메서드 구현

```python
def update_checkbox(self, item, checked):
    """체크박스 아이콘 업데이트"""
    values = list(self.preview_tree.item(item, 'values'))
    if len(values) > 0:
        values[0] = CHECKBOX_CHECKED if checked else CHECKBOX_UNCHECKED
        self.preview_tree.item(item, values=values)
```

#### 4.2 update_all_checkboxes 메서드 구현

```python
def update_all_checkboxes(self):
    """모든 체크박스 아이콘을 선택 상태에 맞게 업데이트"""
    selected_items = set(self.preview_tree.selection())
    all_items = self.preview_tree.get_children()
    
    for item in all_items:
        is_selected = item in selected_items
        self.update_checkbox(item, is_selected)
```

---

### 5. 선택 상태 변경 시 체크박스 동기화

#### 5.1 on_selection_change 메서드 수정

**현재 코드**:
```python
def on_selection_change(self, event=None):
    """선택 변경 시 호출"""
    selected_names = self.get_selected_employees()
    total_items = len(self.preview_tree.get_children())
    # ... 상태 라벨 업데이트 ...
```

**변경 후**:
```python
def on_selection_change(self, event=None):
    """선택 변경 시 호출"""
    # 체크박스 아이콘 업데이트
    self.update_all_checkboxes()
    
    selected_names = self.get_selected_employees()
    total_items = len(self.preview_tree.get_children())
    # ... 상태 라벨 업데이트 ...
```

---

### 6. 전체 선택/해제 메서드 수정

#### 6.1 select_all_employees 메서드 수정

**현재 코드**:
```python
def select_all_employees(self):
    """모든 직원 선택"""
    all_items = self.preview_tree.get_children()
    if not all_items:
        return
    
    for item in all_items:
        self.preview_tree.selection_add(item)
    
    self.on_selection_change()
    logger.info(f"전체 직원 선택: {len(all_items)}명")
```

**변경 후**:
- 기존 코드 유지 (on_selection_change에서 체크박스 업데이트됨)

#### 6.2 deselect_all_employees 메서드 수정

**현재 코드**:
```python
def deselect_all_employees(self):
    """모든 직원 선택 해제"""
    selected_items = self.preview_tree.selection()
    if not selected_items:
        return
    
    for item in selected_items:
        self.preview_tree.selection_remove(item)
    
    self.on_selection_change()
    logger.info("전체 선택 해제")
```

**변경 후**:
- 기존 코드 유지 (on_selection_change에서 체크박스 업데이트됨)

---

### 7. get_selected_employees 메서드 수정

**현재 코드**:
```python
def get_selected_employees(self):
    """선택된 직원 이름 목록 반환"""
    selected_items = self.preview_tree.selection()
    selected_names = []
    
    for item in selected_items:
        values = self.preview_tree.item(item, 'values')
        if values and len(values) > 0:
            name = values[0]  # 첫 번째 컬럼이 이름
            selected_names.append(name)
    
    return selected_names
```

**변경 후**:
```python
def get_selected_employees(self):
    """선택된 직원 이름 목록 반환"""
    selected_items = self.preview_tree.selection()
    selected_names = []
    
    for item in selected_items:
        values = self.preview_tree.item(item, 'values')
        if values and len(values) > 1:
            name = values[1]  # 두 번째 컬럼이 이름 (첫 번째는 체크박스)
            selected_names.append(name)
    
    return selected_names
```

---

## 🔄 구현 단계

### 단계 1: Treeview 컬럼 구조 변경
**예상 시간**: 15분

**작업 내용**:
- [ ] 체크박스 컬럼 추가 ('체크')
- [ ] 컬럼 설정 (너비, 정렬)
- [ ] 체크박스 아이콘 상수 정의

### 단계 2: 데이터 삽입 시 체크박스 추가
**예상 시간**: 15분

**작업 내용**:
- [ ] `load_preview` 메서드 수정
- [ ] 체크박스 아이콘을 첫 번째 값으로 추가

### 단계 3: 체크박스 클릭 이벤트 처리
**예상 시간**: 30분

**작업 내용**:
- [ ] 클릭 이벤트 바인딩
- [ ] `on_treeview_click` 메서드 구현
- [ ] 체크박스 클릭 감지 로직
- [ ] 선택 상태 토글 로직

### 단계 4: 체크박스 아이콘 업데이트 메서드
**예상 시간**: 20분

**작업 내용**:
- [ ] `update_checkbox` 메서드 구현
- [ ] `update_all_checkboxes` 메서드 구현

### 단계 5: 선택 상태 변경 시 체크박스 동기화
**예상 시간**: 20분

**작업 내용**:
- [ ] `on_selection_change` 메서드 수정
- [ ] 선택 상태 변경 시 체크박스 자동 업데이트

### 단계 6: get_selected_employees 메서드 수정
**예상 시간**: 10분

**작업 내용**:
- [ ] 이름 컬럼 인덱스 변경 (0 → 1)

### 단계 7: 테스트
**예상 시간**: 30분

**테스트 항목**:
- [ ] 체크박스 아이콘 표시 확인
- [ ] 체크박스 클릭 시 선택/해제 확인
- [ ] 전체 선택 시 모든 체크박스 체크 확인
- [ ] 전체 해제 시 모든 체크박스 해제 확인
- [ ] 개별 선택 시 체크박스 동기화 확인
- [ ] 다중 선택 시 체크박스 동기화 확인
- [ ] 선택된 직원만 급여명세서 생성 확인

---

## 📝 구현 상세

### 1. 체크박스 아이콘 상수

```python
# 체크박스 아이콘
CHECKBOX_UNCHECKED = '☐'  # U+2610: BALLOT BOX
CHECKBOX_CHECKED = '☒'    # U+2612: BALLOT BOX WITH X
```

### 2. Treeview 컬럼 설정

```python
# 미리보기 트리뷰 (다중 선택 가능)
columns = ('체크', '이름', '주민번호', '입사일', '기본급')
self.preview_tree = ttk.Treeview(
    preview_frame, 
    columns=columns, 
    show='headings', 
    height=5,
    selectmode='extended'
)

# 컬럼 설정
self.preview_tree.heading('체크', text='')
self.preview_tree.column('체크', width=30, anchor='center')

for col in ('이름', '주민번호', '입사일', '기본급'):
    self.preview_tree.heading(col, text=col)
    self.preview_tree.column(col, width=120)
```

### 3. 체크박스 클릭 이벤트 핸들러

```python
def on_treeview_click(self, event):
    """Treeview 클릭 이벤트 처리 (체크박스 클릭 감지)"""
    region = self.preview_tree.identify_region(event.x, event.y)
    
    # 클릭한 영역이 셀인 경우
    if region == 'cell':
        column = self.preview_tree.identify_column(event.x)
        item = self.preview_tree.identify_row(event.y)
        
        # 체크박스 컬럼(첫 번째 컬럼)을 클릭한 경우
        if column == '#1' and item:
            # 현재 선택 상태 확인
            is_selected = item in self.preview_tree.selection()
            
            if is_selected:
                # 선택 해제
                self.preview_tree.selection_remove(item)
            else:
                # 선택 추가
                self.preview_tree.selection_add(item)
            
            # 선택 상태 변경 이벤트 발생 (체크박스 업데이트 포함)
            self.on_selection_change()
            
            # 이벤트 전파 방지 (기본 선택 동작 방지)
            return 'break'
```

### 4. 체크박스 업데이트 메서드

```python
def update_checkbox(self, item, checked):
    """체크박스 아이콘 업데이트"""
    values = list(self.preview_tree.item(item, 'values'))
    if len(values) > 0:
        values[0] = CHECKBOX_CHECKED if checked else CHECKBOX_UNCHECKED
        self.preview_tree.item(item, values=values)

def update_all_checkboxes(self):
    """모든 체크박스 아이콘을 선택 상태에 맞게 업데이트"""
    selected_items = set(self.preview_tree.selection())
    all_items = self.preview_tree.get_children()
    
    for item in all_items:
        is_selected = item in selected_items
        self.update_checkbox(item, is_selected)
```

---

## ⚠️ 주의사항

### 1. 이벤트 충돌 방지
- 체크박스 클릭 시 기본 선택 동작과 충돌할 수 있음
- `return 'break'`로 이벤트 전파 방지 필요

### 2. 선택 상태 동기화
- 체크박스 상태와 Treeview 선택 상태를 항상 동기화해야 함
- 모든 선택 변경 시 체크박스 업데이트 필요

### 3. 컬럼 인덱스 변경
- 이름 컬럼 인덱스가 0에서 1로 변경됨
- `get_selected_employees` 메서드 수정 필요

### 4. 유니코드 문자 지원
- 체크박스 아이콘은 유니코드 문자 사용
- 폰트가 유니코드를 지원해야 함 (대부분의 폰트 지원)

---

## 📊 예상 작업 시간

| 단계 | 작업 내용 | 예상 시간 |
|------|----------|----------|
| 1 | Treeview 컬럼 구조 변경 | 15분 |
| 2 | 데이터 삽입 시 체크박스 추가 | 15분 |
| 3 | 체크박스 클릭 이벤트 처리 | 30분 |
| 4 | 체크박스 아이콘 업데이트 메서드 | 20분 |
| 5 | 선택 상태 변경 시 체크박스 동기화 | 20분 |
| 6 | get_selected_employees 메서드 수정 | 10분 |
| 7 | 테스트 | 30분 |
| **총계** | | **2시간 20분** |

---

## ✅ 체크리스트

### 구현 전
- [ ] 현재 상태 분석 완료
- [ ] 구현 계획 작성 완료

### 구현 중
- [ ] Treeview 컬럼 구조 변경
- [ ] 데이터 삽입 시 체크박스 추가
- [ ] 체크박스 클릭 이벤트 처리
- [ ] 체크박스 아이콘 업데이트 메서드
- [ ] 선택 상태 변경 시 체크박스 동기화
- [ ] get_selected_employees 메서드 수정
- [ ] 테스트

### 구현 후
- [ ] 문서 업데이트
- [ ] 사용자 매뉴얼 업데이트 (선택 사항)

---

## 🔗 관련 파일

- `main.py` (수정 예정)
  - `create_payroll_tab()`: 컬럼 구조 변경
  - `load_preview()`: 체크박스 아이콘 추가
  - `on_treeview_click()`: 신규 메서드 추가
  - `update_checkbox()`: 신규 메서드 추가
  - `update_all_checkboxes()`: 신규 메서드 추가
  - `on_selection_change()`: 체크박스 업데이트 추가
  - `get_selected_employees()`: 컬럼 인덱스 수정

---

## 🚀 향후 개선 사항

1. **체크박스 스타일 개선**
   - 이미지 기반 체크박스 사용
   - 더 명확한 시각적 피드백

2. **체크박스 애니메이션**
   - 체크/해제 시 부드러운 전환 효과

3. **체크박스 색상 커스터마이징**
   - 선택된 체크박스 색상 변경

---

**마지막 업데이트**: 2025-11-11

