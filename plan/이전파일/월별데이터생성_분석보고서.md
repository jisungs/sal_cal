# 📊 월별 급여 데이터 생성 분석 보고서

**작성일**: 2025-11-11  
**문제**: employee_template.xlsx에는 월간 급여 데이터가 없는데 그래프에 1년간 데이터가 표시됨

---

## 🔍 문제 분석

### 현재 상황

1. **employee_template.xlsx 파일 구조**
   - 직원 기본 정보만 포함 (이름, 주민번호, 입사일, 기본급 등)
   - 월별 급여 이력 데이터 없음

2. **그래프에 표시되는 데이터**
   - "월별 급여 지출 현황" 그래프에 12개월 데이터가 표시됨
   - 11월부터 12월까지 역순으로 표시

---

## 📋 월별 데이터 생성 로직 분석

### 위치
- **파일**: `payroll_generator/dashboard.py`
- **메서드**: `_generate_monthly_data(self, df, work_status)`
- **라인**: 104-247

### 현재 구현 방식

```python
def _generate_monthly_data(self, df, work_status):
    """월별 급여 지출 현황 데이터 생성 (임시 - 향후 실제 월별 데이터로 대체)"""
    # ... 현재 직원 데이터로 평균 급여 계산 ...
    
    # 현재 월 총 급여 지출
    current_regular_payment = avg_regular_payment * current_regular
    current_contract_payment = avg_contract_payment * current_contract
    
    # 최근 12개월 데이터 생성 (역순: 현재 월이 첫 번째)
    for i in range(12):
        if i == 0:
            # 현재 월: 실제 데이터
            regular_payments.append(int(current_regular_payment))
            contract_payments.append(int(current_contract_payment))
        elif i == 1:
            # 1개월 전: 현재의 95% 수준
            regular_payments.append(int(current_regular_payment * 0.95))
        elif i == 2:
            # 2개월 전: 현재의 90% 수준
            regular_payments.append(int(current_regular_payment * 0.9))
        # ... 계속해서 점진적으로 감소 ...
```

### 데이터 생성 방식

1. **현재 월 데이터**: 실제 직원 데이터 기반 계산
   - 현재 직원들의 평균 급여 계산
   - 정규직/계약직 구분 (입사일 기준: 1년 이상 = 정규직)
   - 현재 월 총 급여 지출 = 평균 급여 × 직원 수

2. **과거 월 데이터**: 가상 데이터 생성
   - 현재 월 기준으로 점진적으로 감소하는 추세
   - 1개월 전: 현재의 95%
   - 2개월 전: 현재의 90%
   - 3개월 전: 현재의 85%
   - ... (계속 감소)
   - 12개월 전: 현재의 약 50% 수준

### 문제점

1. **실제 데이터 없음**
   - employee_template.xlsx에는 월별 이력 데이터가 없음
   - 과거 12개월 데이터는 모두 가상으로 생성됨

2. **부정확한 데이터**
   - 실제 과거 급여 지출과 다를 수 있음
   - 직원 수 변동, 급여 변동 등을 반영하지 못함

3. **임시 구현**
   - 코드 주석에 "임시 - 향후 실제 월별 데이터로 대체" 명시
   - 실제 데이터가 없어서 임시로 구현된 상태

---

## 📊 데이터 흐름

```
employee_template.xlsx (직원 기본 정보)
    ↓
load_dashboard_file() → read_employee_data()
    ↓
Dashboard.analyze_employee_data(df)
    ↓
_generate_monthly_data(df, work_status)
    ↓
[현재 직원 데이터로 평균 급여 계산]
    ↓
[현재 월: 실제 계산]
[과거 11개월: 가상 데이터 생성 (95%, 90%, 85% ...)]
    ↓
monthly_data 반환
    ↓
create_monthly_workforce_chart(monthly_data)
    ↓
그래프 표시
```

---

## 🎯 해결 방안

### 방안 1: 실제 월별 데이터 저장 및 로드 (권장)

**구현 방법**:
1. 월별 급여 이력 데이터를 별도 파일로 저장
   - 예: `monthly_payroll_history.xlsx`
   - 컬럼: 년월, 정규직_급여, 계약직_급여 등

2. 대시보드 로드 시 월별 이력 데이터 읽기
   - 파일이 있으면 실제 데이터 사용
   - 파일이 없으면 현재 방식 유지 (또는 빈 데이터)

3. 급여명세서 생성 시 월별 이력 업데이트
   - 매월 급여명세서 생성 후 이력 파일 업데이트

**장점**:
- 실제 데이터 기반 정확한 그래프
- 월별 추이 분석 가능

**단점**:
- 추가 파일 관리 필요
- 초기 데이터 구축 필요

---

### 방안 2: 현재 월만 표시

**구현 방법**:
1. 월별 데이터가 없으면 현재 월만 표시
2. 또는 "데이터 없음" 메시지 표시

**장점**:
- 가상 데이터 표시 방지
- 명확한 데이터 상태 표시

**단점**:
- 그래프의 유용성 감소

---

### 방안 3: 가상 데이터 표시 명시

**구현 방법**:
1. 그래프 제목에 "(임시 데이터)" 표시
2. 툴팁에 "실제 월별 데이터가 없어 추정 데이터를 표시합니다" 메시지

**장점**:
- 사용자에게 명확한 정보 제공
- 빠른 구현

**단점**:
- 여전히 부정확한 데이터 표시

---

## 📝 권장 사항

### 단기 해결책
1. 그래프 제목에 "(추정 데이터)" 표시
2. 툴팁 또는 범례에 설명 추가

### 장기 해결책
1. 월별 급여 이력 데이터 저장 기능 구현
2. 급여명세서 생성 시 자동으로 이력 업데이트
3. 대시보드에서 실제 월별 데이터 로드 및 표시

---

## 🔗 관련 파일

- `payroll_generator/dashboard.py`: 월별 데이터 생성 로직
- `payroll_generator/templates/employee_template.xlsx`: 직원 기본 정보 템플릿
- `main.py`: 대시보드 데이터 로드 및 표시

---

## 📌 결론

**현재 월별 데이터는 실제 데이터가 아닌 가상 데이터입니다.**

- 현재 월: 실제 직원 데이터 기반 계산
- 과거 11개월: 현재 월 기준으로 점진적으로 감소하는 추세로 가상 생성

이것은 임시 구현이며, 실제 월별 급여 이력 데이터가 없기 때문에 이렇게 구현되었습니다.

---

**마지막 업데이트**: 2025-11-11

