# 📋 대시보드 파일 급여명세서 탭 연동 구현 계획

**작성일**: 2025-11-12  
**목표**: 대시보드 탭에서 로드한 엑셀 파일을 급여명세서 생성 탭에서도 자동으로 활용

---

## 🔍 현재 상황 분석

### 문제점

1. **대시보드 탭**:
   - `load_dashboard_file()` 메서드로 파일 로드
   - `self.df`에 데이터 저장
   - `self.employee_file_path`는 업데이트되지 않음

2. **급여명세서 생성 탭**:
   - `self.employee_file_path` StringVar를 사용하여 파일 경로 관리
   - `select_employee_file()` 메서드로 파일 선택
   - 대시보드에서 로드한 파일 정보를 활용할 수 없음

3. **사용자 경험 문제**:
   - 대시보드에서 파일을 로드한 후 급여명세서 탭으로 이동하면
   - 파일 경로가 비어있어서 다시 파일을 선택해야 함
   - 불필요한 중복 작업 발생

---

## 🎯 목표

### 기능 목표
- 대시보드 탭에서 파일을 로드하면 급여명세서 생성 탭에서도 자동으로 활용 가능
- 탭 전환 시 대시보드에서 로드한 파일이 있으면 자동으로 설정
- 사용자가 수동으로 파일을 다시 선택할 필요 없음

### 사용자 경험 개선
- 파일을 한 번만 선택하면 두 탭 모두에서 사용 가능
- 직관적이고 편리한 워크플로우 제공

---

## 📋 구현 계획

### 1단계: 파일 경로 동기화

#### 1.1 `load_dashboard_file()` 메서드 수정
**위치**: `main.py` - `load_dashboard_file()` 메서드

**변경 사항**:
- 파일 로드 시 `self.employee_file_path`도 함께 업데이트
- `self.current_df`도 업데이트하여 급여명세서 탭에서 사용 가능하도록 함

**코드 변경**:
```python
def load_dashboard_file(self, file_path, show_message=True):
    """파일 로드 및 대시보드 업데이트"""
    try:
        # 엑셀 파일 읽기
        self.df = self.excel_handler.read_employee_data(file_path)
        self.dashboard_data = self.dashboard.analyze_employee_data(self.df)
        
        # 급여명세서 탭에서도 사용할 수 있도록 동기화
        self.employee_file_path.set(file_path)  # 파일 경로 동기화
        self.current_df = self.df  # 데이터 동기화
        
        # 대시보드 업데이트
        self.update_cards()
        self.update_charts()
        
        if show_message:
            messagebox.showinfo("성공", f"{len(self.df)}명의 직원 정보를 불러왔습니다.")
        logger.info(f"대시보드 데이터 로드 완료: {len(self.df)}명")
    except Exception as e:
        messagebox.showerror("오류", f"파일을 읽는 중 오류가 발생했습니다:\n{str(e)}")
        logger.exception(f"대시보드 파일 로드 오류: {str(e)}")
```

#### 1.2 `load_file_for_dashboard()` 메서드 확인
**위치**: `main.py` - `load_file_for_dashboard()` 메서드

**확인 사항**:
- `load_dashboard_file()`을 호출하므로 자동으로 동기화됨
- 추가 변경 불필요

---

### 2단계: 탭 전환 시 자동 동기화

#### 2.1 탭 전환 이벤트 바인딩
**위치**: `main.py` - `create_widgets()` 메서드

**변경 사항**:
- `notebook`에 탭 전환 이벤트 바인딩 추가
- 급여명세서 탭으로 전환 시 대시보드에서 로드한 파일이 있으면 자동으로 설정

**코드 추가**:
```python
def create_widgets(self):
    """위젯 생성"""
    # 메뉴바 생성
    self.create_menu_bar()
    
    # 탭 노트북 생성
    self.notebook = ttk.Notebook(self.root)
    self.notebook.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)
    
    # 탭 전환 이벤트 바인딩
    self.notebook.bind('<<NotebookTabChanged>>', self.on_tab_changed)
    
    # 탭 1: 대시보드
    self.dashboard_frame = ttk.Frame(self.notebook)
    self.notebook.add(self.dashboard_frame, text="📊 대시보드")
    self.create_dashboard_tab()
    
    # 탭 2: 급여명세서 생성
    self.payroll_frame = ttk.Frame(self.notebook)
    self.notebook.add(self.payroll_frame, text="📄 급여명세서 생성")
    self.create_payroll_tab()
    
    # 기본 탭을 대시보드로 설정
    self.notebook.select(0)
```

#### 2.2 탭 전환 이벤트 핸들러 추가
**위치**: `main.py` - 새로운 메서드 추가

**기능**:
- 급여명세서 탭으로 전환 시 대시보드에서 로드한 파일이 있으면 자동으로 설정
- 미리보기도 자동으로 업데이트

**코드 추가**:
```python
def on_tab_changed(self, event):
    """탭 전환 이벤트 핸들러"""
    selected_tab = self.notebook.index(self.notebook.select())
    
    # 급여명세서 탭으로 전환 시
    if selected_tab == 1:  # 급여명세서 탭 인덱스
        # 대시보드에서 로드한 파일이 있고, 급여명세서 탭의 파일 경로가 비어있으면
        if self.df is not None and not self.employee_file_path.get():
            # 대시보드에서 로드한 파일 경로를 사용
            # 파일 경로는 이미 load_dashboard_file()에서 동기화되었으므로
            # 미리보기만 업데이트하면 됨
            if self.current_df is not None:
                self.update_preview()
                logger.info("대시보드에서 로드한 파일을 급여명세서 탭에 자동 적용")
```

---

### 3단계: 미리보기 자동 업데이트

#### 3.1 `update_preview()` 메서드 확인 및 개선
**위치**: `main.py` - `update_preview()` 메서드

**확인 사항**:
- `self.current_df`를 사용하여 미리보기 업데이트
- 대시보드에서 로드한 데이터(`self.df`)를 `self.current_df`에 동기화했으므로 자동으로 작동

**개선 사항** (필요 시):
- 파일 경로가 설정되어 있지만 미리보기가 비어있을 때 자동으로 업데이트

---

### 4단계: 사용자 피드백 개선

#### 4.1 파일 경로 표시 개선
**위치**: `main.py` - `create_payroll_tab()` 메서드

**개선 사항**:
- 파일 경로가 대시보드에서 자동으로 설정되었을 때 사용자에게 알림
- 상태 표시 라벨 추가 (선택사항)

**코드 추가** (선택사항):
```python
# 파일 선택 프레임에 상태 표시 라벨 추가
self.file_status_label = ttk.Label(
    file_frame, 
    text="", 
    font=("맑은 고딕", 8),
    foreground="green"
)
self.file_status_label.pack(pady=(5, 0))
```

#### 4.2 탭 전환 시 상태 메시지 표시
**위치**: `main.py` - `on_tab_changed()` 메서드

**개선 사항**:
- 대시보드에서 로드한 파일을 자동으로 적용했다는 메시지 표시 (선택사항)
- 또는 조용히 자동 적용 (권장)

---

## 🔧 구현 상세

### 변경 파일 목록
1. `main.py`
   - `load_dashboard_file()` 메서드 수정
   - `create_widgets()` 메서드 수정 (탭 전환 이벤트 바인딩)
   - `on_tab_changed()` 메서드 추가

### 변경 사항 요약

#### 1. `load_dashboard_file()` 메서드 수정
```python
def load_dashboard_file(self, file_path, show_message=True):
    """파일 로드 및 대시보드 업데이트"""
    try:
        # 엑셀 파일 읽기
        self.df = self.excel_handler.read_employee_data(file_path)
        self.dashboard_data = self.dashboard.analyze_employee_data(self.df)
        
        # ✨ 추가: 급여명세서 탭에서도 사용할 수 있도록 동기화
        self.employee_file_path.set(file_path)
        self.current_df = self.df
        
        # 대시보드 업데이트
        self.update_cards()
        self.update_charts()
        
        if show_message:
            messagebox.showinfo("성공", f"{len(self.df)}명의 직원 정보를 불러왔습니다.")
        logger.info(f"대시보드 데이터 로드 완료: {len(self.df)}명")
    except Exception as e:
        messagebox.showerror("오류", f"파일을 읽는 중 오류가 발생했습니다:\n{str(e)}")
        logger.exception(f"대시보드 파일 로드 오류: {str(e)}")
```

#### 2. `create_widgets()` 메서드 수정
```python
def create_widgets(self):
    """위젯 생성"""
    # 메뉴바 생성
    self.create_menu_bar()
    
    # 탭 노트북 생성
    self.notebook = ttk.Notebook(self.root)
    self.notebook.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)
    
    # ✨ 추가: 탭 전환 이벤트 바인딩
    self.notebook.bind('<<NotebookTabChanged>>', self.on_tab_changed)
    
    # 탭 1: 대시보드
    self.dashboard_frame = ttk.Frame(self.notebook)
    self.notebook.add(self.dashboard_frame, text="📊 대시보드")
    self.create_dashboard_tab()
    
    # 탭 2: 급여명세서 생성
    self.payroll_frame = ttk.Frame(self.notebook)
    self.notebook.add(self.payroll_frame, text="📄 급여명세서 생성")
    self.create_payroll_tab()
    
    # 기본 탭을 대시보드로 설정
    self.notebook.select(0)
```

#### 3. `on_tab_changed()` 메서드 추가
```python
def on_tab_changed(self, event):
    """탭 전환 이벤트 핸들러"""
    selected_tab = self.notebook.index(self.notebook.select())
    
    # 급여명세서 탭으로 전환 시
    if selected_tab == 1:  # 급여명세서 탭 인덱스 (0: 대시보드, 1: 급여명세서)
        # 대시보드에서 로드한 파일이 있고, 급여명세서 탭의 파일 경로가 비어있으면
        if self.df is not None and not self.employee_file_path.get():
            # 파일 경로는 이미 load_dashboard_file()에서 동기화되었으므로
            # 미리보기만 업데이트하면 됨
            if self.current_df is not None:
                self.update_preview()
                logger.info("대시보드에서 로드한 파일을 급여명세서 탭에 자동 적용")
        # 파일 경로가 설정되어 있지만 미리보기가 비어있을 때도 업데이트
        elif self.employee_file_path.get() and self.current_df is not None:
            # 미리보기가 비어있으면 업데이트
            if not self.preview_tree.get_children():
                self.update_preview()
```

---

## 🧪 테스트 계획

### 테스트 시나리오

#### 시나리오 1: 대시보드에서 파일 로드 후 급여명세서 탭 이동
1. **준비**: 프로그램 실행
2. **실행**: 
   - 대시보드 탭에서 "📁 파일 선택" 버튼 클릭
   - 엑셀 파일 선택
   - 급여명세서 생성 탭으로 이동
3. **예상 결과**:
   - 파일 경로가 자동으로 입력되어 있음
   - 미리보기가 자동으로 표시됨
   - 급여명세서 생성 가능

#### 시나리오 2: 급여명세서 탭에서 직접 파일 선택
1. **준비**: 프로그램 실행
2. **실행**:
   - 급여명세서 생성 탭으로 이동
   - "찾아보기" 버튼 클릭
   - 엑셀 파일 선택
3. **예상 결과**:
   - 파일 경로가 입력됨
   - 미리보기가 표시됨
   - 기존 동작과 동일하게 작동

#### 시나리오 3: 대시보드에서 파일 로드 후 급여명세서 탭에서 다른 파일 선택
1. **준비**: 프로그램 실행
2. **실행**:
   - 대시보드 탭에서 파일 선택
   - 급여명세서 생성 탭으로 이동
   - "찾아보기" 버튼 클릭하여 다른 파일 선택
3. **예상 결과**:
   - 새로 선택한 파일로 업데이트됨
   - 미리보기가 새 파일로 업데이트됨
   - 사용자가 선택한 파일이 우선됨

#### 시나리오 4: 대시보드에서 파일 로드 후 급여명세서 탭에서 파일 변경 후 대시보드로 복귀
1. **준비**: 프로그램 실행
2. **실행**:
   - 대시보드 탭에서 파일 A 선택
   - 급여명세서 생성 탭으로 이동
   - 파일 B 선택
   - 대시보드 탭으로 복귀
3. **예상 결과**:
   - 대시보드는 파일 A 유지
   - 급여명세서 탭은 파일 B 유지
   - 각 탭이 독립적으로 작동

---

## 📊 작업 우선순위

### P0: 필수 작업
1. ✅ `load_dashboard_file()` 메서드 수정 (파일 경로 동기화)
2. ✅ `create_widgets()` 메서드 수정 (탭 전환 이벤트 바인딩)
3. ✅ `on_tab_changed()` 메서드 추가

### P1: 개선 작업 (선택사항)
1. 파일 상태 표시 라벨 추가
2. 탭 전환 시 사용자 피드백 메시지

---

## ⏰ 예상 작업 시간

- **1단계: 파일 경로 동기화**: 30분
- **2단계: 탭 전환 시 자동 동기화**: 1시간
- **3단계: 미리보기 자동 업데이트**: 30분
- **4단계: 사용자 피드백 개선**: 30분 (선택사항)
- **테스트**: 1시간

**총 예상 시간**: 약 3시간 (선택사항 포함 시 3.5시간)

---

## ✅ 완료 체크리스트

### 구현
- [ ] `load_dashboard_file()` 메서드 수정 완료
- [ ] `create_widgets()` 메서드 수정 완료
- [ ] `on_tab_changed()` 메서드 추가 완료
- [ ] 파일 상태 표시 라벨 추가 (선택사항)

### 테스트
- [ ] 시나리오 1 테스트 통과
- [ ] 시나리오 2 테스트 통과
- [ ] 시나리오 3 테스트 통과
- [ ] 시나리오 4 테스트 통과

### 문서화
- [ ] 코드 주석 추가
- [ ] 구현 보고서 작성

---

## 🔗 관련 파일

- `main.py`: 메인 GUI 애플리케이션 파일
- `plan/파일경로저장기능_구현계획.md`: 파일 경로 저장 기능 구현 계획 (참고)

---

## 📝 참고 사항

1. **데이터 동기화**:
   - `self.df`: 대시보드용 데이터
   - `self.current_df`: 급여명세서 탭용 데이터
   - 두 변수를 동기화하여 두 탭에서 동일한 데이터 사용

2. **파일 경로 관리**:
   - `self.employee_file_path`: 급여명세서 탭의 파일 경로
   - 대시보드에서 파일 로드 시 자동으로 업데이트

3. **사용자 경험**:
   - 사용자가 파일을 한 번만 선택하면 두 탭 모두에서 사용 가능
   - 각 탭에서 독립적으로 파일을 변경할 수도 있음

---

**작성자**: AI Assistant  
**작성일**: 2025-11-12  
**상태**: 📋 계획 완료, 구현 대기

