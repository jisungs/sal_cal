# ğŸ“‹ ì›”ë³„ ê¸‰ì—¬ ì´ë ¥ ë°ì´í„° ì €ì¥ ê¸°ëŠ¥ êµ¬í˜„ ê³„íš

**ì‘ì„±ì¼**: 2025-11-11  
**ëª©í‘œ**: ì‹¤ì œ ì›”ë³„ ê¸‰ì—¬ ì´ë ¥ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ë¡œë“œí•˜ì—¬ ì •í™•í•œ ê·¸ë˜í”„ í‘œì‹œ

---

## ğŸ“Š í˜„ì¬ ìƒíƒœ ë¶„ì„

### âœ… í˜„ì¬ êµ¬í˜„ëœ ê¸°ëŠ¥

1. **ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„±**
   - ì—‘ì…€/PDF íŒŒì¼ë¡œ ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„±
   - ì¶œë ¥ í´ë”ì— ì €ì¥

2. **ëŒ€ì‹œë³´ë“œ ì›”ë³„ ê·¸ë˜í”„**
   - 12ê°œì›” ë°ì´í„° í‘œì‹œ
   - í˜„ì¬ëŠ” ê°€ìƒ ë°ì´í„° ì‚¬ìš© (í˜„ì¬ ì›” ê¸°ì¤€ ì ì§„ì  ê°ì†Œ)

### âŒ í˜„ì¬ ë¯¸êµ¬í˜„ ê¸°ëŠ¥

1. **ì›”ë³„ ê¸‰ì—¬ ì´ë ¥ ë°ì´í„° ì €ì¥**
   - ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„± ì‹œ ì›”ë³„ ì´ë ¥ ë°ì´í„° ì €ì¥ ê¸°ëŠ¥ ì—†ìŒ
   - ë³„ë„ì˜ ì´ë ¥ ë°ì´í„° íŒŒì¼ ì—†ìŒ

2. **ì›”ë³„ ê¸‰ì—¬ ì´ë ¥ ë°ì´í„° ë¡œë“œ**
   - ëŒ€ì‹œë³´ë“œì—ì„œ ì‹¤ì œ ì´ë ¥ ë°ì´í„° ë¡œë“œ ê¸°ëŠ¥ ì—†ìŒ
   - ê°€ìƒ ë°ì´í„°ë§Œ ì‚¬ìš©

---

## ğŸ¯ êµ¬í˜„ ëª©í‘œ

### ì£¼ìš” ëª©í‘œ

1. **ì›”ë³„ ê¸‰ì—¬ ì´ë ¥ ë°ì´í„° ì €ì¥**
   - ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„± ì‹œ ì›”ë³„ ì´ë ¥ ë°ì´í„° ìë™ ì €ì¥
   - ì—‘ì…€ íŒŒì¼ í˜•ì‹ìœ¼ë¡œ ì €ì¥ (ì½ê¸°/ì“°ê¸° ìš©ì´)
   - íšŒì‚¬ë³„, ì›”ë³„ë¡œ ë°ì´í„° ê´€ë¦¬

2. **ì›”ë³„ ê¸‰ì—¬ ì´ë ¥ ë°ì´í„° ë¡œë“œ**
   - ëŒ€ì‹œë³´ë“œì—ì„œ ì‹¤ì œ ì´ë ¥ ë°ì´í„° ë¡œë“œ
   - ì´ë ¥ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‹¤ì œ ë°ì´í„° ì‚¬ìš©
   - ì´ë ¥ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ 0ìœ¼ë¡œ í‘œì‹œ

3. **ë°ì´í„° ê´€ë¦¬**
   - ì´ë ¥ ë°ì´í„° íŒŒì¼ ìƒì„±/ì—…ë°ì´íŠ¸
   - ê¸°ì¡´ ë°ì´í„°ì™€ ìƒˆ ë°ì´í„° ë³‘í•©
   - ë°ì´í„° ë¬´ê²°ì„± ë³´ì¥

---

## ğŸ“‹ êµ¬í˜„ ê³„íš

### 1. ë°ì´í„° êµ¬ì¡° ì„¤ê³„

#### 1.1 ì›”ë³„ ê¸‰ì—¬ ì´ë ¥ ë°ì´í„° íŒŒì¼ êµ¬ì¡°

**íŒŒì¼ëª…**: `monthly_payroll_history.xlsx`  
**ì €ì¥ ìœ„ì¹˜**: `payroll_generator/data/monthly_payroll_history.xlsx`

**ì‹œíŠ¸ êµ¬ì¡°**:

**ì‹œíŠ¸ 1: ì›”ë³„_ì´ë ¥**
| ë…„ì›” | ì •ê·œì§_ê¸‰ì—¬ | ê³„ì•½ì§_ê¸‰ì—¬ | ì´_ê¸‰ì—¬ | ì •ê·œì§_ì¸ì› | ê³„ì•½ì§_ì¸ì› | ì´_ì¸ì› | ìƒì„±ì¼ì‹œ |
|------|------------|------------|---------|------------|------------|---------|----------|
| 2024-01 | 5000000 | 500000 | 5500000 | 3 | 1 | 4 | 2024-01-15 10:30:00 |
| 2024-02 | 5100000 | 500000 | 5600000 | 3 | 1 | 4 | 2024-02-15 10:30:00 |
| ... | ... | ... | ... | ... | ... | ... | ... |

**ë°ì´í„° íƒ€ì…**:
- `ë…„ì›”`: ë¬¸ìì—´ (YYYY-MM í˜•ì‹)
- `ì •ê·œì§_ê¸‰ì—¬`: ì •ìˆ˜ (ì› ë‹¨ìœ„)
- `ê³„ì•½ì§_ê¸‰ì—¬`: ì •ìˆ˜ (ì› ë‹¨ìœ„)
- `ì´_ê¸‰ì—¬`: ì •ìˆ˜ (ì› ë‹¨ìœ„)
- `ì •ê·œì§_ì¸ì›`: ì •ìˆ˜
- `ê³„ì•½ì§_ì¸ì›`: ì •ìˆ˜
- `ì´_ì¸ì›`: ì •ìˆ˜
- `ìƒì„±ì¼ì‹œ`: ë¬¸ìì—´ (YYYY-MM-DD HH:MM:SS í˜•ì‹)

#### 1.2 ë°ì´í„° ì €ì¥ ë¡œì§

```python
# ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„± ì‹œ
- í˜„ì¬ ë…„ì›” í™•ì¸ (ì˜ˆ: 2025-11)
- ì •ê·œì§/ê³„ì•½ì§ë³„ ê¸‰ì—¬ í•©ê³„ ê³„ì‚°
- ì •ê·œì§/ê³„ì•½ì§ë³„ ì¸ì› ìˆ˜ ê³„ì‚°
- ì´ë ¥ íŒŒì¼ì— í•´ë‹¹ ë…„ì›” ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
  - ìˆìœ¼ë©´: ì—…ë°ì´íŠ¸ (ìµœì‹  ë°ì´í„°ë¡œ ë®ì–´ì“°ê¸°)
  - ì—†ìœ¼ë©´: ì¶”ê°€
```

---

### 2. ì›”ë³„ ê¸‰ì—¬ ì´ë ¥ ë°ì´í„° ì €ì¥ ê¸°ëŠ¥ êµ¬í˜„

#### 2.1 HistoryManager í´ë˜ìŠ¤ ìƒì„±

**íŒŒì¼**: `payroll_generator/history_manager.py` (ì‹ ê·œ)

**ì£¼ìš” ë©”ì„œë“œ**:
- `__init__()`: ì´ë ¥ íŒŒì¼ ê²½ë¡œ ì´ˆê¸°í™”
- `save_monthly_data(year_month, data)`: ì›”ë³„ ë°ì´í„° ì €ì¥
- `load_monthly_data(start_month, end_month)`: ì›”ë³„ ë°ì´í„° ë¡œë“œ
- `get_latest_12_months()`: ìµœê·¼ 12ê°œì›” ë°ì´í„° ë¡œë“œ
- `update_monthly_data(year_month, data)`: ì›”ë³„ ë°ì´í„° ì—…ë°ì´íŠ¸
- `_ensure_file_exists()`: ì´ë ¥ íŒŒì¼ ì¡´ì¬ í™•ì¸ ë° ìƒì„±

#### 2.2 ë°ì´í„° ì €ì¥ ë©”ì„œë“œ

```python
def save_monthly_data(self, year_month, data):
    """
    ì›”ë³„ ê¸‰ì—¬ ì´ë ¥ ë°ì´í„° ì €ì¥
    
    Args:
        year_month: 'YYYY-MM' í˜•ì‹ì˜ ë…„ì›” ë¬¸ìì—´
        data: {
            'regular_payment': ì •ê·œì§ ê¸‰ì—¬ í•©ê³„,
            'contract_payment': ê³„ì•½ì§ ê¸‰ì—¬ í•©ê³„,
            'regular_count': ì •ê·œì§ ì¸ì› ìˆ˜,
            'contract_count': ê³„ì•½ì§ ì¸ì› ìˆ˜
        }
    """
    # 1. ì´ë ¥ íŒŒì¼ ì¡´ì¬ í™•ì¸ (ì—†ìœ¼ë©´ ìƒì„±)
    # 2. ê¸°ì¡´ ë°ì´í„° ë¡œë“œ
    # 3. í•´ë‹¹ ë…„ì›” ë°ì´í„° í™•ì¸
    # 4. ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸, ì—†ìœ¼ë©´ ì¶”ê°€
    # 5. íŒŒì¼ ì €ì¥
```

---

### 3. ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„± ì‹œ ì´ë ¥ ë°ì´í„° ì €ì¥ í†µí•©

#### 3.1 generate_payroll ë©”ì„œë“œ ìˆ˜ì •

**íŒŒì¼**: `main.py`  
**ìœ„ì¹˜**: `generate_payroll()` ë©”ì„œë“œ

**ë³€ê²½ ì‚¬í•­**:
- ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„± ì™„ë£Œ í›„ ì´ë ¥ ë°ì´í„° ì €ì¥
- ì •ê·œì§/ê³„ì•½ì§ë³„ ê¸‰ì—¬ í•©ê³„ ê³„ì‚°
- ì •ê·œì§/ê³„ì•½ì§ë³„ ì¸ì› ìˆ˜ ê³„ì‚°
- HistoryManagerë¥¼ í†µí•´ ì´ë ¥ ë°ì´í„° ì €ì¥

```python
def generate_payroll(self):
    """ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„± (ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œ)"""
    try:
        # ... ê¸°ì¡´ ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„± ë¡œì§ ...
        
        # ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„± ì™„ë£Œ í›„
        # ì›”ë³„ ì´ë ¥ ë°ì´í„° ì €ì¥
        self.save_monthly_history(df, period)
        
    except Exception as e:
        # ... ì—ëŸ¬ ì²˜ë¦¬ ...
```

#### 3.2 save_monthly_history ë©”ì„œë“œ ì¶”ê°€

**íŒŒì¼**: `main.py`  
**ë©”ì„œë“œ**: `save_monthly_history(df, period)`

```python
def save_monthly_history(self, df, period):
    """ì›”ë³„ ê¸‰ì—¬ ì´ë ¥ ë°ì´í„° ì €ì¥"""
    from payroll_generator.history_manager import HistoryManager
    
    history_manager = HistoryManager()
    
    # ì •ê·œì§/ê³„ì•½ì§ë³„ ê¸‰ì—¬ í•©ê³„ ê³„ì‚°
    regular_payment = 0
    contract_payment = 0
    regular_count = 0
    contract_count = 0
    
    for idx, row in df.iterrows():
        payroll_data = self.calculator.calculate_deductions(row.to_dict())
        total_payment = payroll_data['ì´ì§€ê¸‰ì•¡']
        
        # ì •ê·œì§/ê³„ì•½ì§ êµ¬ë¶„
        is_regular = self._is_regular_employee(row)
        
        if is_regular:
            regular_payment += total_payment
            regular_count += 1
        else:
            contract_payment += total_payment
            contract_count += 1
    
    # ì´ë ¥ ë°ì´í„° ì €ì¥
    data = {
        'regular_payment': regular_payment,
        'contract_payment': contract_payment,
        'regular_count': regular_count,
        'contract_count': contract_count
    }
    
    history_manager.save_monthly_data(period, data)
    logger.info(f"ì›”ë³„ ì´ë ¥ ë°ì´í„° ì €ì¥ ì™„ë£Œ: {period}")
```

---

### 4. ëŒ€ì‹œë³´ë“œì—ì„œ ì´ë ¥ ë°ì´í„° ë¡œë“œ ê¸°ëŠ¥ êµ¬í˜„

#### 4.1 _generate_monthly_data ë©”ì„œë“œ ìˆ˜ì •

**íŒŒì¼**: `payroll_generator/dashboard.py`  
**ë©”ì„œë“œ**: `_generate_monthly_data()`

**ë³€ê²½ ì‚¬í•­**:
- ë¨¼ì € ì´ë ¥ ë°ì´í„° íŒŒì¼ì—ì„œ ë°ì´í„° ë¡œë“œ ì‹œë„
- ì´ë ¥ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‹¤ì œ ë°ì´í„° ì‚¬ìš©
- ì´ë ¥ ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ë¶€ì¡±í•œ ì›”ì€ 0ìœ¼ë¡œ í‘œì‹œ

```python
def _generate_monthly_data(self, df, work_status):
    """ì›”ë³„ ê¸‰ì—¬ ì§€ì¶œ í˜„í™© ë°ì´í„° ìƒì„±"""
    from .history_manager import HistoryManager
    
    history_manager = HistoryManager()
    
    # ìµœê·¼ 12ê°œì›” ì´ë ¥ ë°ì´í„° ë¡œë“œ ì‹œë„
    history_data = history_manager.get_latest_12_months()
    
    if history_data and len(history_data) > 0:
        # ì‹¤ì œ ì´ë ¥ ë°ì´í„° ì‚¬ìš©
        return self._format_history_data(history_data)
    else:
        # ì´ë ¥ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ 0ìœ¼ë¡œ í‘œì‹œ
        return self._generate_empty_data()
```

#### 4.2 _format_history_data ë©”ì„œë“œ ì¶”ê°€

```python
def _format_history_data(self, history_data):
    """ì´ë ¥ ë°ì´í„°ë¥¼ ê·¸ë˜í”„ í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (ìµœê·¼ 12ê°œì›” ê¸°ì¤€)"""
    from datetime import datetime
    
    # í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ìµœê·¼ 12ê°œì›” ëª©ë¡ ìƒì„±
    today = datetime.now()
    current_month = today.month
    current_year = today.year
    
    # ì´ë ¥ ë°ì´í„°ë¥¼ ë”•ì…”ë„ˆë¦¬ë¡œ ë³€í™˜ (ë…„ì›”ì„ í‚¤ë¡œ)
    history_dict = {row['ë…„ì›”']: row for row in history_data}
    
    months = []
    regular_payments = []
    contract_payments = []
    
    # ìµœê·¼ 12ê°œì›” ë°ì´í„° ìƒì„± (ì—­ìˆœ: í˜„ì¬ ì›”ì´ ì²« ë²ˆì§¸)
    for i in range(12):
        # ì›” ê³„ì‚°
        month_offset = i
        target_month = current_month - month_offset
        target_year = current_year
        
        # ì—°ë„ ì¡°ì •
        while target_month <= 0:
            target_month += 12
            target_year -= 1
        
        year_month = f"{target_year}-{target_month:02d}"
        month_label = f"{target_month}ì›”"
        
        months.append(month_label)
        
        # ì´ë ¥ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ 0
        if year_month in history_dict:
            regular_payments.append(int(history_dict[year_month]['ì •ê·œì§_ê¸‰ì—¬']))
            contract_payments.append(int(history_dict[year_month]['ê³„ì•½ì§_ê¸‰ì—¬']))
        else:
            regular_payments.append(0)
            contract_payments.append(0)
    
    return {
        'months': months,
        'regular': regular_payments,
        'contract': contract_payments
    }
```

#### 4.3 _generate_empty_data ë©”ì„œë“œ ì¶”ê°€

```python
def _generate_empty_data(self):
    """ì´ë ¥ ë°ì´í„°ê°€ ì—†ì„ ë•Œ ë¹ˆ ë°ì´í„° ìƒì„± (ëª¨ë‘ 0)"""
    from datetime import datetime
    
    today = datetime.now()
    current_month = today.month
    current_year = today.year
    
    months = []
    regular_payments = []
    contract_payments = []
    
    # ìµœê·¼ 12ê°œì›” ë°ì´í„° ìƒì„± (ëª¨ë‘ 0)
    for i in range(12):
        month_offset = i
        target_month = current_month - month_offset
        target_year = current_year
        
        while target_month <= 0:
            target_month += 12
            target_year -= 1
        
        months.append(f"{target_month}ì›”")
        regular_payments.append(0)
        contract_payments.append(0)
    
    return {
        'months': months,
        'regular': regular_payments,
        'contract': contract_payments
    }
```

---

### 5. ë°ì´í„° ê´€ë¦¬ ê¸°ëŠ¥

#### 5.1 ì´ë ¥ íŒŒì¼ ì´ˆê¸°í™”

**íŒŒì¼**: `payroll_generator/history_manager.py`

```python
def _ensure_file_exists(self):
    """ì´ë ¥ íŒŒì¼ ì¡´ì¬ í™•ì¸ ë° ìƒì„±"""
    if not self.history_file.exists():
        # ìƒˆ íŒŒì¼ ìƒì„±
        self._create_empty_history_file()
```

#### 5.2 ë°ì´í„° ì—…ë°ì´íŠ¸ ë¡œì§

```python
def update_monthly_data(self, year_month, data):
    """ì›”ë³„ ë°ì´í„° ì—…ë°ì´íŠ¸ (ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸, ì—†ìœ¼ë©´ ì¶”ê°€)"""
    # 1. ê¸°ì¡´ ë°ì´í„° ë¡œë“œ
    # 2. í•´ë‹¹ ë…„ì›” ë°ì´í„° í™•ì¸
    # 3. ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸, ì—†ìœ¼ë©´ ì¶”ê°€
    # 4. íŒŒì¼ ì €ì¥
```

#### 5.3 ë°ì´í„° ê²€ì¦

```python
def _validate_data(self, data):
    """ë°ì´í„° ìœ íš¨ì„± ê²€ì¦"""
    # í•„ìˆ˜ í•„ë“œ í™•ì¸
    # ë°ì´í„° íƒ€ì… í™•ì¸
    # ê°’ ë²”ìœ„ í™•ì¸
```

---

## ğŸ”„ êµ¬í˜„ ë‹¨ê³„

### ë‹¨ê³„ 1: HistoryManager í´ë˜ìŠ¤ êµ¬í˜„
**ì˜ˆìƒ ì‹œê°„**: 2ì‹œê°„

**ì‘ì—… ë‚´ìš©**:
- [ ] `payroll_generator/history_manager.py` íŒŒì¼ ìƒì„±
- [ ] `HistoryManager` í´ë˜ìŠ¤ êµ¬í˜„
- [ ] `_ensure_file_exists()` ë©”ì„œë“œ êµ¬í˜„
- [ ] `save_monthly_data()` ë©”ì„œë“œ êµ¬í˜„
- [ ] `load_monthly_data()` ë©”ì„œë“œ êµ¬í˜„
- [ ] `get_latest_12_months()` ë©”ì„œë“œ êµ¬í˜„
- [ ] `update_monthly_data()` ë©”ì„œë“œ êµ¬í˜„
- [ ] ë°ì´í„° ê²€ì¦ ë¡œì§ êµ¬í˜„

### ë‹¨ê³„ 2: ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„± ì‹œ ì´ë ¥ ë°ì´í„° ì €ì¥ í†µí•©
**ì˜ˆìƒ ì‹œê°„**: 1ì‹œê°„ 30ë¶„

**ì‘ì—… ë‚´ìš©**:
- [ ] `main.py`ì— `HistoryManager` import
- [ ] `save_monthly_history()` ë©”ì„œë“œ êµ¬í˜„
- [ ] `_is_regular_employee()` ë©”ì„œë“œ êµ¬í˜„ (ë˜ëŠ” ê¸°ì¡´ ë¡œì§ í™œìš©)
- [ ] `generate_payroll()` ë©”ì„œë“œì— ì´ë ¥ ì €ì¥ ë¡œì§ ì¶”ê°€
- [ ] ì •ê·œì§/ê³„ì•½ì§ êµ¬ë¶„ ë¡œì§ êµ¬í˜„

### ë‹¨ê³„ 3: ëŒ€ì‹œë³´ë“œì—ì„œ ì´ë ¥ ë°ì´í„° ë¡œë“œ ê¸°ëŠ¥ êµ¬í˜„
**ì˜ˆìƒ ì‹œê°„**: 1ì‹œê°„ 30ë¶„

**ì‘ì—… ë‚´ìš©**:
- [ ] `dashboard.py`ì— `HistoryManager` import
- [ ] `_generate_monthly_data()` ë©”ì„œë“œ ìˆ˜ì •
- [ ] `_format_history_data()` ë©”ì„œë“œ êµ¬í˜„ (ìµœê·¼ 12ê°œì›” ê¸°ì¤€, ì—†ëŠ” ì›”ì€ 0)
- [ ] `_generate_empty_data()` ë©”ì„œë“œ êµ¬í˜„ (ëª¨ë‘ 0ìœ¼ë¡œ í‘œì‹œ)
- [ ] ì´ë ¥ ë°ì´í„°ê°€ ì—†ì„ ë•Œ 0ìœ¼ë¡œ í‘œì‹œí•˜ëŠ” ë¡œì§

### ë‹¨ê³„ 4: í…ŒìŠ¤íŠ¸
**ì˜ˆìƒ ì‹œê°„**: 1ì‹œê°„ 30ë¶„

**í…ŒìŠ¤íŠ¸ í•­ëª©**:
- [ ] ì´ë ¥ ë°ì´í„° ì €ì¥ í…ŒìŠ¤íŠ¸
- [ ] ì´ë ¥ ë°ì´í„° ë¡œë“œ í…ŒìŠ¤íŠ¸
- [ ] ì´ë ¥ ë°ì´í„° ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸
- [ ] ìµœê·¼ 12ê°œì›” ë°ì´í„° ë¡œë“œ í…ŒìŠ¤íŠ¸
- [ ] ì´ë ¥ ë°ì´í„°ê°€ ì—†ì„ ë•Œ 0ìœ¼ë¡œ í‘œì‹œë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸
- [ ] ì´ë ¥ ë°ì´í„°ê°€ ì¼ë¶€ë§Œ ìˆì„ ë•Œ ì—†ëŠ” ì›”ì€ 0ìœ¼ë¡œ í‘œì‹œë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸
- [ ] ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„± ì‹œ ì´ë ¥ ì €ì¥ í…ŒìŠ¤íŠ¸
- [ ] ëŒ€ì‹œë³´ë“œì—ì„œ ì´ë ¥ ë°ì´í„° í‘œì‹œ í…ŒìŠ¤íŠ¸

### ë‹¨ê³„ 5: ì—ëŸ¬ ì²˜ë¦¬ ë° ì˜ˆì™¸ ìƒí™©
**ì˜ˆìƒ ì‹œê°„**: 30ë¶„

**ì‘ì—… ë‚´ìš©**:
- [ ] íŒŒì¼ ì½ê¸°/ì“°ê¸° ì—ëŸ¬ ì²˜ë¦¬
- [ ] ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜ ì²˜ë¦¬
- [ ] ì´ë ¥ íŒŒì¼ ì†ìƒ ì‹œ ì²˜ë¦¬
- [ ] ë¡œê¹… ì¶”ê°€

### ë‹¨ê³„ 6: ë¬¸ì„œí™” ë° ì‚¬ìš©ì ê°€ì´ë“œ
**ì˜ˆìƒ ì‹œê°„**: 30ë¶„

**ì‘ì—… ë‚´ìš©**:
- [ ] ì½”ë“œ ì£¼ì„ ì¶”ê°€
- [ ] ì‚¬ìš©ì ë§¤ë‰´ì–¼ ì—…ë°ì´íŠ¸
- [ ] ì´ë ¥ ë°ì´í„° íŒŒì¼ ê´€ë¦¬ ê°€ì´ë“œ ì‘ì„±

---

## ğŸ“ êµ¬í˜„ ìƒì„¸

### 1. HistoryManager í´ë˜ìŠ¤ êµ¬ì¡°

```python
# payroll_generator/history_manager.py
import pandas as pd
from pathlib import Path
from datetime import datetime
import logging

logger = logging.getLogger(__name__)

class HistoryManager:
    def __init__(self):
        """ì›”ë³„ ê¸‰ì—¬ ì´ë ¥ ë°ì´í„° ê´€ë¦¬ì ì´ˆê¸°í™”"""
        # ì´ë ¥ íŒŒì¼ ê²½ë¡œ
        data_dir = Path(__file__).parent / 'data'
        data_dir.mkdir(exist_ok=True)
        self.history_file = data_dir / 'monthly_payroll_history.xlsx'
        
        # íŒŒì¼ ì¡´ì¬ í™•ì¸ ë° ìƒì„±
        self._ensure_file_exists()
    
    def _ensure_file_exists(self):
        """ì´ë ¥ íŒŒì¼ ì¡´ì¬ í™•ì¸ ë° ìƒì„±"""
        if not self.history_file.exists():
            self._create_empty_history_file()
    
    def _create_empty_history_file(self):
        """ë¹ˆ ì´ë ¥ íŒŒì¼ ìƒì„±"""
        df = pd.DataFrame(columns=[
            'ë…„ì›”', 'ì •ê·œì§_ê¸‰ì—¬', 'ê³„ì•½ì§_ê¸‰ì—¬', 'ì´_ê¸‰ì—¬',
            'ì •ê·œì§_ì¸ì›', 'ê³„ì•½ì§_ì¸ì›', 'ì´_ì¸ì›', 'ìƒì„±ì¼ì‹œ'
        ])
        df.to_excel(self.history_file, index=False, sheet_name='ì›”ë³„_ì´ë ¥')
        logger.info(f"ì´ë ¥ íŒŒì¼ ìƒì„±: {self.history_file}")
    
    def save_monthly_data(self, year_month, data):
        """ì›”ë³„ ê¸‰ì—¬ ì´ë ¥ ë°ì´í„° ì €ì¥"""
        # êµ¬í˜„ ë‚´ìš©...
    
    def load_monthly_data(self, start_month=None, end_month=None):
        """ì›”ë³„ ë°ì´í„° ë¡œë“œ"""
        # êµ¬í˜„ ë‚´ìš©...
    
    def get_latest_12_months(self):
        """ìµœê·¼ 12ê°œì›” ë°ì´í„° ë¡œë“œ"""
        # êµ¬í˜„ ë‚´ìš©...
    
    def update_monthly_data(self, year_month, data):
        """ì›”ë³„ ë°ì´í„° ì—…ë°ì´íŠ¸"""
        # êµ¬í˜„ ë‚´ìš©...
```

### 2. ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„± ì‹œ ì´ë ¥ ì €ì¥

```python
# main.py
def save_monthly_history(self, df, period):
    """ì›”ë³„ ê¸‰ì—¬ ì´ë ¥ ë°ì´í„° ì €ì¥"""
    from payroll_generator.history_manager import HistoryManager
    
    history_manager = HistoryManager()
    
    # ì •ê·œì§/ê³„ì•½ì§ë³„ ê¸‰ì—¬ í•©ê³„ ê³„ì‚°
    regular_payment = 0
    contract_payment = 0
    regular_count = 0
    contract_count = 0
    
    for idx, row in df.iterrows():
        payroll_data = self.calculator.calculate_deductions(row.to_dict())
        total_payment = payroll_data['ì´ì§€ê¸‰ì•¡']
        
        # ì •ê·œì§/ê³„ì•½ì§ êµ¬ë¶„
        is_regular = self._is_regular_employee(row)
        
        if is_regular:
            regular_payment += total_payment
            regular_count += 1
        else:
            contract_payment += total_payment
            contract_count += 1
    
    # ì´ë ¥ ë°ì´í„° ì €ì¥
    data = {
        'regular_payment': regular_payment,
        'contract_payment': contract_payment,
        'regular_count': regular_count,
        'contract_count': contract_count
    }
    
    try:
        history_manager.save_monthly_data(period, data)
        logger.info(f"ì›”ë³„ ì´ë ¥ ë°ì´í„° ì €ì¥ ì™„ë£Œ: {period}")
    except Exception as e:
        logger.error(f"ì›”ë³„ ì´ë ¥ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨: {e}")
        # ì´ë ¥ ì €ì¥ ì‹¤íŒ¨í•´ë„ ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„±ì€ ê³„ì† ì§„í–‰

def _is_regular_employee(self, row):
    """ì •ê·œì§ ì—¬ë¶€ íŒë‹¨"""
    from datetime import datetime
    
    join_date_str = row.get('ì…ì‚¬ì¼', '')
    if not join_date_str:
        return True  # ê¸°ë³¸ê°’: ì •ê·œì§
    
    try:
        if isinstance(join_date_str, str):
            join_date = datetime.strptime(join_date_str, '%Y-%m-%d')
        else:
            join_date = join_date_str
        # 1ë…„ ì´ìƒ ê·¼ë¬´í•˜ë©´ ì •ê·œì§ìœ¼ë¡œ ê°„ì£¼
        return (datetime.now() - join_date).days >= 365
    except:
        return True  # ê¸°ë³¸ê°’: ì •ê·œì§
```

### 3. ëŒ€ì‹œë³´ë“œì—ì„œ ì´ë ¥ ë°ì´í„° ë¡œë“œ

```python
# payroll_generator/dashboard.py
def _generate_monthly_data(self, df, work_status):
    """ì›”ë³„ ê¸‰ì—¬ ì§€ì¶œ í˜„í™© ë°ì´í„° ìƒì„±"""
    from .history_manager import HistoryManager
    
    try:
        history_manager = HistoryManager()
        
        # ìµœê·¼ 12ê°œì›” ì´ë ¥ ë°ì´í„° ë¡œë“œ ì‹œë„
        history_data = history_manager.get_latest_12_months()
        
        if history_data and len(history_data) > 0:
            # ì‹¤ì œ ì´ë ¥ ë°ì´í„° ì‚¬ìš© (ì—†ëŠ” ì›”ì€ 0ìœ¼ë¡œ í‘œì‹œ)
            logger.info(f"ì‹¤ì œ ì´ë ¥ ë°ì´í„° ì‚¬ìš©: {len(history_data)}ê°œì›”")
            return self._format_history_data(history_data)
        else:
            # ì´ë ¥ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ëª¨ë‘ 0ìœ¼ë¡œ í‘œì‹œ
            logger.info("ì´ë ¥ ë°ì´í„° ì—†ìŒ, ë¹ˆ ë°ì´í„°(0) ì‚¬ìš©")
            return self._generate_empty_data()
    except Exception as e:
        logger.warning(f"ì´ë ¥ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: {e}. ë¹ˆ ë°ì´í„°(0) ì‚¬ìš©")
        return self._generate_empty_data()

def _format_history_data(self, history_data):
    """ì´ë ¥ ë°ì´í„°ë¥¼ ê·¸ë˜í”„ í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (ìµœê·¼ 12ê°œì›” ê¸°ì¤€, ì—†ëŠ” ì›”ì€ 0)"""
    from datetime import datetime
    
    # í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ìµœê·¼ 12ê°œì›” ëª©ë¡ ìƒì„±
    today = datetime.now()
    current_month = today.month
    current_year = today.year
    
    # ì´ë ¥ ë°ì´í„°ë¥¼ ë”•ì…”ë„ˆë¦¬ë¡œ ë³€í™˜ (ë…„ì›”ì„ í‚¤ë¡œ)
    history_dict = {row['ë…„ì›”']: row for row in history_data}
    
    months = []
    regular_payments = []
    contract_payments = []
    
    # ìµœê·¼ 12ê°œì›” ë°ì´í„° ìƒì„± (ì—­ìˆœ: í˜„ì¬ ì›”ì´ ì²« ë²ˆì§¸)
    for i in range(12):
        # ì›” ê³„ì‚°
        month_offset = i
        target_month = current_month - month_offset
        target_year = current_year
        
        # ì—°ë„ ì¡°ì •
        while target_month <= 0:
            target_month += 12
            target_year -= 1
        
        year_month = f"{target_year}-{target_month:02d}"
        month_label = f"{target_month}ì›”"
        
        months.append(month_label)
        
        # ì´ë ¥ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ 0
        if year_month in history_dict:
            regular_payments.append(int(history_dict[year_month]['ì •ê·œì§_ê¸‰ì—¬']))
            contract_payments.append(int(history_dict[year_month]['ê³„ì•½ì§_ê¸‰ì—¬']))
        else:
            regular_payments.append(0)
            contract_payments.append(0)
    
    return {
        'months': months,
        'regular': regular_payments,
        'contract': contract_payments
    }

def _generate_empty_data(self):
    """ì´ë ¥ ë°ì´í„°ê°€ ì—†ì„ ë•Œ ë¹ˆ ë°ì´í„° ìƒì„± (ëª¨ë‘ 0)"""
    from datetime import datetime
    
    today = datetime.now()
    current_month = today.month
    current_year = today.year
    
    months = []
    regular_payments = []
    contract_payments = []
    
    # ìµœê·¼ 12ê°œì›” ë°ì´í„° ìƒì„± (ëª¨ë‘ 0)
    for i in range(12):
        month_offset = i
        target_month = current_month - month_offset
        target_year = current_year
        
        while target_month <= 0:
            target_month += 12
            target_year -= 1
        
        months.append(f"{target_month}ì›”")
        regular_payments.append(0)
        contract_payments.append(0)
    
    return {
        'months': months,
        'regular': regular_payments,
        'contract': contract_payments
    }
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. ë°ì´í„° ë¬´ê²°ì„±
- ê°™ì€ ë…„ì›”ì˜ ë°ì´í„°ê°€ ì¤‘ë³µ ì €ì¥ë˜ì§€ ì•Šë„ë¡ ì£¼ì˜
- ì—…ë°ì´íŠ¸ ì‹œ ê¸°ì¡´ ë°ì´í„° ë®ì–´ì“°ê¸°

### 2. íŒŒì¼ ê²½ë¡œ
- ì´ë ¥ íŒŒì¼ì€ `payroll_generator/data/` ë””ë ‰í† ë¦¬ì— ì €ì¥
- `.gitignore`ì— ì¶”ê°€í•˜ì—¬ ë²„ì „ ê´€ë¦¬ì—ì„œ ì œì™¸ (ì„ íƒì‚¬í•­)

### 3. ì„±ëŠ¥ ê³ ë ¤
- ëŒ€ëŸ‰ì˜ ì´ë ¥ ë°ì´í„° ì²˜ë¦¬ ì‹œ ì„±ëŠ¥ ê³ ë ¤
- í•„ìš”ì‹œ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ì „í™˜ ê³ ë ¤

### 4. ë°±ì—…
- ì´ë ¥ ë°ì´í„°ëŠ” ì¤‘ìš”í•œ ë°ì´í„°ì´ë¯€ë¡œ ì •ê¸°ì  ë°±ì—… ê¶Œì¥
- ì‚¬ìš©ìì—ê²Œ ë°±ì—… ê°€ì´ë“œ ì œê³µ

### 5. ë§ˆì´ê·¸ë ˆì´ì…˜
- ê¸°ì¡´ ì‚¬ìš©ì ëŒ€ì‘: ì´ë ¥ ë°ì´í„°ê°€ ì—†ì–´ë„ ì •ìƒ ë™ì‘
- ì´ë ¥ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ 0ìœ¼ë¡œ í‘œì‹œ (ê°€ìƒ ë°ì´í„° ìƒì„±í•˜ì§€ ì•ŠìŒ)

---

## ğŸ“Š ì˜ˆìƒ ì‘ì—… ì‹œê°„

| ë‹¨ê³„ | ì‘ì—… ë‚´ìš© | ì˜ˆìƒ ì‹œê°„ |
|------|----------|----------|
| 1 | HistoryManager í´ë˜ìŠ¤ êµ¬í˜„ | 2ì‹œê°„ |
| 2 | ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„± ì‹œ ì´ë ¥ ì €ì¥ í†µí•© | 1ì‹œê°„ 30ë¶„ |
| 3 | ëŒ€ì‹œë³´ë“œì—ì„œ ì´ë ¥ ë°ì´í„° ë¡œë“œ | 1ì‹œê°„ 30ë¶„ |
| 4 | í…ŒìŠ¤íŠ¸ | 1ì‹œê°„ 30ë¶„ |
| 5 | ì—ëŸ¬ ì²˜ë¦¬ ë° ì˜ˆì™¸ ìƒí™© | 30ë¶„ |
| 6 | ë¬¸ì„œí™” ë° ì‚¬ìš©ì ê°€ì´ë“œ | 30ë¶„ |
| **ì´ê³„** | | **7ì‹œê°„ 30ë¶„** |

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### êµ¬í˜„ ì „
- [ ] í˜„ì¬ ìƒíƒœ ë¶„ì„ ì™„ë£Œ
- [ ] êµ¬í˜„ ê³„íš ì‘ì„± ì™„ë£Œ

### êµ¬í˜„ ì¤‘
- [ ] HistoryManager í´ë˜ìŠ¤ êµ¬í˜„
- [ ] ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„± ì‹œ ì´ë ¥ ì €ì¥ í†µí•©
- [ ] ëŒ€ì‹œë³´ë“œì—ì„œ ì´ë ¥ ë°ì´í„° ë¡œë“œ
- [ ] í…ŒìŠ¤íŠ¸
- [ ] ì—ëŸ¬ ì²˜ë¦¬
- [ ] ë¬¸ì„œí™”

### êµ¬í˜„ í›„
- [ ] ì‚¬ìš©ì ë§¤ë‰´ì–¼ ì—…ë°ì´íŠ¸
- [ ] ì´ë ¥ ë°ì´í„° íŒŒì¼ ê´€ë¦¬ ê°€ì´ë“œ ì‘ì„±

---

## ğŸ”— ê´€ë ¨ íŒŒì¼

- `payroll_generator/history_manager.py` (ì‹ ê·œ)
- `main.py` (ìˆ˜ì •)
- `payroll_generator/dashboard.py` (ìˆ˜ì •)
- `payroll_generator/data/monthly_payroll_history.xlsx` (ì‹ ê·œ, ìë™ ìƒì„±)

---

## ğŸš€ í–¥í›„ ê°œì„  ì‚¬í•­

1. **ë°ì´í„°ë² ì´ìŠ¤ ì „í™˜**
   - ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì‹œ SQLite ë“± ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©

2. **ë°ì´í„° ë¶„ì„ ê¸°ëŠ¥**
   - ì›”ë³„ ì¶”ì´ ë¶„ì„
   - ì˜ˆì‚° ëŒ€ë¹„ ì‹¤ì  ë¹„êµ

3. **ë°ì´í„° ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸°**
   - ì—‘ì…€ íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°
   - ë‹¤ë¥¸ ì‹œìŠ¤í…œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

4. **ìë™ ë°±ì—…**
   - ì •ê¸°ì  ìë™ ë°±ì—… ê¸°ëŠ¥

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-11-11

