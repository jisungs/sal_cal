# 📋 파일 경로 저장 기능 구현 보고서

**작성일**: 2025-11-11  
**작업자**: AI Assistant  
**작업 시간**: 약 2시간

---

## 📊 작업 개요

프로그램 첫 실행 시 직원 정보 엑셀 파일을 입력받고, 선택한 파일 경로를 저장하여 다음 실행 시 자동으로 로드하는 기능을 구현했습니다.

---

## ✅ 구현 완료 항목

### 1. SettingsManager 클래스 생성

**파일**: `payroll_generator/settings.py`

**주요 기능**:
- JSON 형식의 설정 파일 관리
- 파일 경로 저장/로드
- 첫 실행 여부 확인
- 출력 폴더, 기간, 출력 형식 저장/로드

**구현된 메서드**:
- `load_settings()`: 설정 파일 로드
- `save_settings()`: 설정 파일 저장
- `get_last_employee_file()`: 마지막 직원 파일 경로 반환
- `set_last_employee_file()`: 마지막 직원 파일 경로 저장
- `is_first_run()`: 첫 실행 여부 확인
- `set_first_run_complete()`: 첫 실행 완료 표시
- `get_last_output_folder()` / `set_last_output_folder()`: 출력 폴더 관리
- `get_last_period()` / `set_last_period()`: 기간 관리
- `get_last_output_format()` / `set_last_output_format()`: 출력 형식 관리

**특징**:
- 절대 경로로 저장 (상대 경로 문제 방지)
- 에러 처리 (JSON 파싱 오류, 권한 오류 등)
- 기본값 병합 (새로운 키 추가 대응)

### 2. main.py 통합

**주요 변경사항**:

#### 2.1 SettingsManager 인스턴스 생성
```python
self.settings_manager = SettingsManager()
```

#### 2.2 초기값 설정에서 로드
```python
self.output_folder_path = tk.StringVar(value=self.settings_manager.get_last_output_folder())
self.period = tk.StringVar(value=self.settings_manager.get_last_period())
self.output_format = tk.StringVar(value=self.settings_manager.get_last_output_format())
```

#### 2.3 첫 실행 처리 로직
- `load_default_dashboard_file()` 메서드 수정
  - 첫 실행 시 파일 선택 다이얼로그 표시
  - 저장된 파일 경로가 있으면 자동 로드
  - 저장된 파일이 없거나 삭제된 경우 파일 선택 다이얼로그 표시

#### 2.4 파일 선택 시 저장
- `load_file_for_dashboard()`: 대시보드 파일 선택 시 저장
- `select_employee_file()`: 급여명세서 생성 탭 파일 선택 시 저장
- `select_output_folder()`: 출력 폴더 선택 시 저장
- `start_generation()`: 급여명세서 생성 시 기간, 출력 형식 저장

### 3. .gitignore 업데이트

**추가된 항목**:
```
# 사용자 설정 파일 (개인별 설정이므로 제외)
payroll_generator/data/settings.json
```

---

## 🧪 테스트 결과

### 테스트 파일
- `test_settings.py`: SettingsManager 클래스 단위 테스트

### 테스트 항목 (10개)

1. ✅ **첫 실행 확인**: `is_first_run()` 메서드 정상 동작
2. ✅ **파일 경로 저장 및 로드**: 경로 저장 후 정확히 로드됨
3. ✅ **첫 실행 완료 표시**: `set_first_run_complete()` 정상 동작
4. ✅ **출력 폴더 저장 및 로드**: 폴더 경로 저장 및 로드 정상
5. ✅ **기간 저장 및 로드**: 기간 정보 저장 및 로드 정상
6. ✅ **출력 형식 저장 및 로드**: 출력 형식 저장 및 로드 정상
7. ✅ **설정 파일 존재 확인**: 설정 파일이 정상적으로 생성됨
8. ✅ **설정 파일 내용 확인**: JSON 형식으로 올바르게 저장됨
9. ✅ **새 인스턴스로 설정 로드**: 재시작 시 설정이 유지됨
10. ✅ **빈 경로 처리**: 빈 경로 처리 정상

**테스트 결과**: 모든 테스트 통과 ✓

---

## 📁 생성/수정된 파일

### 신규 생성 파일
1. `payroll_generator/settings.py` (147줄)
   - SettingsManager 클래스 구현

2. `test_settings.py` (155줄)
   - SettingsManager 단위 테스트

3. `payroll_generator/data/settings.json` (실행 시 자동 생성)
   - 사용자 설정 저장 파일

### 수정된 파일
1. `main.py`
   - SettingsManager import 추가
   - SettingsManager 인스턴스 생성
   - 초기값 설정에서 로드
   - `load_default_dashboard_file()` 수정 (첫 실행 처리)
   - `load_file_for_dashboard()` 수정 (파일 선택 시 저장)
   - `select_employee_file()` 수정 (파일 선택 시 저장)
   - `select_output_folder()` 수정 (폴더 선택 시 저장)
   - `start_generation()` 수정 (기간, 출력 형식 저장)

2. `.gitignore`
   - `payroll_generator/data/settings.json` 추가

---

## 🔄 동작 흐름

### 첫 실행 시
1. 프로그램 시작
2. `SettingsManager` 초기화 → `is_first_run()` = `True`
3. `load_default_dashboard_file()` 호출
4. 파일 선택 다이얼로그 표시
5. 사용자가 파일 선택
6. 파일 경로 저장 (`set_last_employee_file()`)
7. 첫 실행 완료 표시 (`set_first_run_complete()`)
8. 파일 로드 및 대시보드 업데이트

### 두 번째 실행 이후
1. 프로그램 시작
2. `SettingsManager` 초기화 → `is_first_run()` = `False`
3. `load_default_dashboard_file()` 호출
4. 저장된 파일 경로 확인
5. 파일이 존재하면 자동 로드
6. 파일이 없으면 파일 선택 다이얼로그 표시

### 파일 선택 시
1. 사용자가 파일 선택
2. 파일 경로 저장 (`set_last_employee_file()`)
3. 첫 실행 완료 표시 (`set_first_run_complete()`)
4. 파일 로드 및 대시보드 업데이트

---

## 📝 설정 파일 구조

**위치**: `payroll_generator/data/settings.json`

**형식**:
```json
{
  "last_employee_file": "/absolute/path/to/employee.xlsx",
  "last_output_folder": "/absolute/path/to/output",
  "last_period": "2025-11",
  "last_output_format": "both",
  "is_first_run": false
}
```

**특징**:
- 절대 경로로 저장
- UTF-8 인코딩
- 들여쓰기 2칸 (가독성)

---

## ⚠️ 주의사항

### 1. 파일 경로 저장
- 모든 경로는 절대 경로로 변환하여 저장
- `os.path.abspath()` 및 `os.path.normpath()` 사용

### 2. 파일 존재 확인
- 저장된 파일 경로를 로드하기 전에 파일 존재 여부 확인
- 파일이 없으면 파일 선택 다이얼로그 표시

### 3. 에러 처리
- JSON 파싱 오류: 기본값 사용
- 권한 오류: 로깅 후 예외 발생
- 파일 경로 오류: 빈 문자열 반환

### 4. 버전 관리
- `settings.json`은 `.gitignore`에 추가
- 사용자별 설정이므로 버전 관리에서 제외

---

## 🎯 구현 목표 달성 여부

| 목표 | 달성 여부 | 비고 |
|------|----------|------|
| 첫 실행 시 파일 입력 | ✅ | 파일 선택 다이얼로그 표시 |
| 파일 경로 저장 | ✅ | JSON 형식으로 저장 |
| 저장된 경로 자동 로드 | ✅ | 다음 실행 시 자동 로드 |
| 출력 폴더 저장 | ✅ | 추가 구현 |
| 기간/출력 형식 저장 | ✅ | 추가 구현 |

---

## 📊 작업 시간

| 단계 | 작업 내용 | 예상 시간 | 실제 시간 |
|------|----------|----------|----------|
| 1 | SettingsManager 클래스 생성 | 30분 | 25분 |
| 2 | main.py 통합 | 1시간 | 45분 |
| 3 | 급여명세서 생성 탭 연동 | 30분 | 20분 |
| 4 | .gitignore 업데이트 | 5분 | 5분 |
| 5 | 테스트 작성 및 실행 | 30분 | 25분 |
| **총계** | | **2시간 35분** | **2시간** |

---

## 🔍 검증 항목

### 기능 검증
- [x] 첫 실행 시 파일 선택 다이얼로그 표시
- [x] 파일 선택 후 경로 저장
- [x] 다음 실행 시 저장된 파일 자동 로드
- [x] 저장된 파일이 없을 때 처리
- [x] 저장된 파일 경로가 유효하지 않을 때 처리
- [x] 출력 폴더 저장 및 로드
- [x] 기간/출력 형식 저장 및 로드

### 코드 품질
- [x] 에러 처리 구현
- [x] 로깅 구현
- [x] 코드 주석 작성
- [x] 단위 테스트 작성

### 문서화
- [x] 구현 계획 작성
- [x] 구현 보고서 작성
- [x] .gitignore 업데이트

---

## 🚀 향후 개선 사항

1. **설정 초기화 기능**
   - 설정 파일 삭제 또는 초기화 버튼 추가
   - 첫 실행 상태로 되돌리기

2. **최근 파일 목록**
   - 여러 파일 경로 저장 (최근 5개 등)
   - 파일 메뉴에서 최근 파일 선택

3. **설정 UI**
   - 설정 탭 추가
   - 사용자가 직접 설정 변경 가능

4. **설정 백업/복원**
   - 설정 파일 백업 기능
   - 다른 컴퓨터로 설정 이전

---

## 📌 결론

파일 경로 저장 기능이 성공적으로 구현되었습니다. 프로그램 첫 실행 시 파일을 선택하고, 선택한 파일 경로가 자동으로 저장되어 다음 실행 시 자동으로 로드됩니다. 또한 출력 폴더, 기간, 출력 형식도 함께 저장되어 사용자 편의성이 향상되었습니다.

모든 테스트를 통과했으며, 에러 처리 및 로깅도 적절히 구현되어 있습니다.

---

**마지막 업데이트**: 2025-11-11

